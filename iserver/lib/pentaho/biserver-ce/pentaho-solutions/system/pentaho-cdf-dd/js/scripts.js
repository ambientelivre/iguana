
(function($){$.fn.bgIframe=$.fn.bgiframe=function(s){if($.browser.msie&&parseInt($.browser.version)<=6){s=$.extend({top:'auto',left:'auto',width:'auto',height:'auto',opacity:true,src:'javascript:false;'},s||{});var prop=function(n){return n&&n.constructor==Number?n+'px':n;},html='<iframe class="bgiframe"frameborder="0"tabindex="-1"src="'+s.src+'"'+'style="display:block;position:absolute;z-index:-1;'+
(s.opacity!==false?'filter:Alpha(Opacity=\'0\');':'')+'top:'+(s.top=='auto'?'expression(((parseInt(this.parentNode.currentStyle.borderTopWidth)||0)*-1)+\'px\')':prop(s.top))+';'+'left:'+(s.left=='auto'?'expression(((parseInt(this.parentNode.currentStyle.borderLeftWidth)||0)*-1)+\'px\')':prop(s.left))+';'+'width:'+(s.width=='auto'?'expression(this.parentNode.offsetWidth+\'px\')':prop(s.width))+';'+'height:'+(s.height=='auto'?'expression(this.parentNode.offsetHeight+\'px\')':prop(s.height))+';'+'"/>';return this.each(function(){if($('> iframe.bgiframe',this).length==0)
this.insertBefore(document.createElement(html),this.firstChild);});}
return this;};if(!$.browser.version)
$.browser.version=navigator.userAgent.toLowerCase().match(/.+(?:rv|it|ra|ie)[\/: ]([\d.]+)/)[1];})(jQuery);(function($){var ColorPicker=function(){var
ids={},inAction,charMin=65,visible,tpl='<div class="colorpicker"><div class="colorpicker_color"><div><div></div></div></div><div class="colorpicker_hue"><div></div></div><div class="colorpicker_new_color"></div><div class="colorpicker_current_color"></div><div class="colorpicker_hex"><input type="text" maxlength="6" size="6" /></div><div class="colorpicker_rgb_r colorpicker_field"><input type="text" maxlength="3" size="3" /><span></span></div><div class="colorpicker_rgb_g colorpicker_field"><input type="text" maxlength="3" size="3" /><span></span></div><div class="colorpicker_rgb_b colorpicker_field"><input type="text" maxlength="3" size="3" /><span></span></div><div class="colorpicker_hsb_h colorpicker_field"><input type="text" maxlength="3" size="3" /><span></span></div><div class="colorpicker_hsb_s colorpicker_field"><input type="text" maxlength="3" size="3" /><span></span></div><div class="colorpicker_hsb_b colorpicker_field"><input type="text" maxlength="3" size="3" /><span></span></div><div class="colorpicker_submit"></div></div>',defaults={eventName:'click',onShow:function(){},onBeforeShow:function(){},onHide:function(){},onChange:function(){},onSubmit:function(){},color:'ff0000',livePreview:true,flat:false},fillRGBFields=function(hsb,cal){var rgb=HSBToRGB(hsb);$(cal).data('colorpicker').fields.eq(1).val(rgb.r).end().eq(2).val(rgb.g).end().eq(3).val(rgb.b).end();},fillHSBFields=function(hsb,cal){$(cal).data('colorpicker').fields.eq(4).val(hsb.h).end().eq(5).val(hsb.s).end().eq(6).val(hsb.b).end();},fillHexFields=function(hsb,cal){$(cal).data('colorpicker').fields.eq(0).val(HSBToHex(hsb)).end();},setSelector=function(hsb,cal){$(cal).data('colorpicker').selector.css('backgroundColor','#'+HSBToHex({h:hsb.h,s:100,b:100}));$(cal).data('colorpicker').selectorIndic.css({left:parseInt(150*hsb.s/100,10),top:parseInt(150*(100-hsb.b)/100,10)});},setHue=function(hsb,cal){$(cal).data('colorpicker').hue.css('top',parseInt(150-150*hsb.h/360,10));},setCurrentColor=function(hsb,cal){$(cal).data('colorpicker').currentColor.css('backgroundColor','#'+HSBToHex(hsb));},setNewColor=function(hsb,cal){$(cal).data('colorpicker').newColor.css('backgroundColor','#'+HSBToHex(hsb));},keyDown=function(ev){var pressedKey=ev.charCode||ev.keyCode||-1;if((pressedKey>charMin&&pressedKey<=90)||pressedKey==32){return false;}
var cal=$(this).parent().parent();if(cal.data('colorpicker').livePreview===true){change.apply(this);}},change=function(ev){var cal=$(this).parent().parent(),col;if(this.parentNode.className.indexOf('_hex')>0){cal.data('colorpicker').color=col=HexToHSB(fixHex(this.value));}else if(this.parentNode.className.indexOf('_hsb')>0){cal.data('colorpicker').color=col=fixHSB({h:parseInt(cal.data('colorpicker').fields.eq(4).val(),10),s:parseInt(cal.data('colorpicker').fields.eq(5).val(),10),b:parseInt(cal.data('colorpicker').fields.eq(6).val(),10)});}else{cal.data('colorpicker').color=col=RGBToHSB(fixRGB({r:parseInt(cal.data('colorpicker').fields.eq(1).val(),10),g:parseInt(cal.data('colorpicker').fields.eq(2).val(),10),b:parseInt(cal.data('colorpicker').fields.eq(3).val(),10)}));}
if(ev){fillRGBFields(col,cal.get(0));fillHexFields(col,cal.get(0));fillHSBFields(col,cal.get(0));}
setSelector(col,cal.get(0));setHue(col,cal.get(0));setNewColor(col,cal.get(0));cal.data('colorpicker').onChange.apply(cal,[col,HSBToHex(col),HSBToRGB(col)]);},blur=function(ev){var cal=$(this).parent().parent();cal.data('colorpicker').fields.parent().removeClass('colorpicker_focus');},focus=function(){charMin=this.parentNode.className.indexOf('_hex')>0?70:65;$(this).parent().parent().data('colorpicker').fields.parent().removeClass('colorpicker_focus');$(this).parent().addClass('colorpicker_focus');},downIncrement=function(ev){var field=$(this).parent().find('input').focus();var current={el:$(this).parent().addClass('colorpicker_slider'),max:this.parentNode.className.indexOf('_hsb_h')>0?360:(this.parentNode.className.indexOf('_hsb')>0?100:255),y:ev.pageY,field:field,val:parseInt(field.val(),10),preview:$(this).parent().parent().data('colorpicker').livePreview};$(document).bind('mouseup',current,upIncrement);$(document).bind('mousemove',current,moveIncrement);},moveIncrement=function(ev){ev.data.field.val(Math.max(0,Math.min(ev.data.max,parseInt(ev.data.val+ev.pageY-ev.data.y,10))));if(ev.data.preview){change.apply(ev.data.field.get(0),[true]);}
return false;},upIncrement=function(ev){change.apply(ev.data.field.get(0),[true]);ev.data.el.removeClass('colorpicker_slider').find('input').focus();$(document).unbind('mouseup',upIncrement);$(document).unbind('mousemove',moveIncrement);return false;},downHue=function(ev){var current={cal:$(this).parent(),y:$(this).offset().top};current.preview=current.cal.data('colorpicker').livePreview;$(document).bind('mouseup',current,upHue);$(document).bind('mousemove',current,moveHue);},moveHue=function(ev){change.apply(ev.data.cal.data('colorpicker').fields.eq(4).val(parseInt(360*(150-Math.max(0,Math.min(150,(ev.pageY-ev.data.y))))/150,10)).get(0),[ev.data.preview]);return false;},upHue=function(ev){fillRGBFields(ev.data.cal.data('colorpicker').color,ev.data.cal.get(0));fillHexFields(ev.data.cal.data('colorpicker').color,ev.data.cal.get(0));$(document).unbind('mouseup',upHue);$(document).unbind('mousemove',moveHue);return false;},downSelector=function(ev){var current={cal:$(this).parent(),pos:$(this).offset()};current.preview=current.cal.data('colorpicker').livePreview;$(document).bind('mouseup',current,upSelector);$(document).bind('mousemove',current,moveSelector);},moveSelector=function(ev){change.apply(ev.data.cal.data('colorpicker').fields.eq(6).val(parseInt(100*(150-Math.max(0,Math.min(150,(ev.pageY-ev.data.pos.top))))/150,10)).end().eq(5).val(parseInt(100*(Math.max(0,Math.min(150,(ev.pageX-ev.data.pos.left))))/150,10)).get(0),[ev.data.preview]);return false;},upSelector=function(ev){fillRGBFields(ev.data.cal.data('colorpicker').color,ev.data.cal.get(0));fillHexFields(ev.data.cal.data('colorpicker').color,ev.data.cal.get(0));$(document).unbind('mouseup',upSelector);$(document).unbind('mousemove',moveSelector);return false;},enterSubmit=function(ev){$(this).addClass('colorpicker_focus');},leaveSubmit=function(ev){$(this).removeClass('colorpicker_focus');},clickSubmit=function(ev){var cal=$(this).parent();var col=cal.data('colorpicker').color;cal.data('colorpicker').origColor=col;setCurrentColor(col,cal.get(0));cal.data('colorpicker').onSubmit(col,HSBToHex(col),HSBToRGB(col),cal.data('colorpicker').el);},show=function(ev){var cal=$('#'+$(this).data('colorpickerId'));cal.data('colorpicker').onBeforeShow.apply(this,[cal.get(0)]);var pos=$(this).offset();var viewPort=getViewport();var top=pos.top+this.offsetHeight;var left=pos.left;if(top+176>viewPort.t+viewPort.h){top-=this.offsetHeight+176;}
if(left+356>viewPort.l+viewPort.w){left-=356;}
cal.css({left:left+'px',top:top+'px'});if(cal.data('colorpicker').onShow.apply(this,[cal.get(0)])!=false){cal.show();}
$(document).bind('mousedown',{cal:cal},hide);return false;},hide=function(ev){if(!isChildOf(ev.data.cal.get(0),ev.target,ev.data.cal.get(0))){if(ev.data.cal.data('colorpicker').onHide.apply(this,[ev.data.cal.get(0)])!=false){ev.data.cal.hide();}
$(document).unbind('mousedown',hide);}},isChildOf=function(parentEl,el,container){if(parentEl==el){return true;}
if(parentEl.contains){return parentEl.contains(el);}
if(parentEl.compareDocumentPosition){return!!(parentEl.compareDocumentPosition(el)&16);}
var prEl=el.parentNode;while(prEl&&prEl!=container){if(prEl==parentEl)
return true;prEl=prEl.parentNode;}
return false;},getViewport=function(){var m=document.compatMode=='CSS1Compat';return{l:window.pageXOffset||(m?document.documentElement.scrollLeft:document.body.scrollLeft),t:window.pageYOffset||(m?document.documentElement.scrollTop:document.body.scrollTop),w:window.innerWidth||(m?document.documentElement.clientWidth:document.body.clientWidth),h:window.innerHeight||(m?document.documentElement.clientHeight:document.body.clientHeight)};},fixHSB=function(hsb){return{h:Math.min(360,Math.max(0,hsb.h)),s:Math.min(100,Math.max(0,hsb.s)),b:Math.min(100,Math.max(0,hsb.b))};},fixRGB=function(rgb){return{r:Math.min(255,Math.max(0,rgb.r)),g:Math.min(255,Math.max(0,rgb.g)),b:Math.min(255,Math.max(0,rgb.b))};},fixHex=function(hex){var len=6-hex.length;if(len>0){var o=[];for(var i=0;i<len;i++){o.push('0');}
o.push(hex);hex=o.join('');}
return hex;},HexToRGB=function(hex){var hex=parseInt(((hex.indexOf('#')>-1)?hex.substring(1):hex),16);return{r:hex>>16,g:(hex&0x00FF00)>>8,b:(hex&0x0000FF)};},HexToHSB=function(hex){return RGBToHSB(HexToRGB(hex));},RGBToHSB=function(rgb){var hsb={h:0,s:0,b:0};var min=Math.min(rgb.r,rgb.g,rgb.b);var max=Math.max(rgb.r,rgb.g,rgb.b);var delta=max-min;hsb.b=max;if(max!=0){}
hsb.s=max!=0?255*delta/max:0;if(hsb.s!=0){if(rgb.r==max){hsb.h=(rgb.g-rgb.b)/delta;}else if(rgb.g==max){hsb.h=2+(rgb.b-rgb.r)/delta;}else{hsb.h=4+(rgb.r-rgb.g)/delta;}}else{hsb.h=-1;}
hsb.h*=60;if(hsb.h<0){hsb.h+=360;}
hsb.s*=100/255;hsb.b*=100/255;return hsb;},HSBToRGB=function(hsb){var rgb={};var h=Math.round(hsb.h);var s=Math.round(hsb.s*255/100);var v=Math.round(hsb.b*255/100);if(s==0){rgb.r=rgb.g=rgb.b=v;}else{var t1=v;var t2=(255-s)*v/255;var t3=(t1-t2)*(h%60)/60;if(h==360)h=0;if(h<60){rgb.r=t1;rgb.b=t2;rgb.g=t2+t3}
else if(h<120){rgb.g=t1;rgb.b=t2;rgb.r=t1-t3}
else if(h<180){rgb.g=t1;rgb.r=t2;rgb.b=t2+t3}
else if(h<240){rgb.b=t1;rgb.r=t2;rgb.g=t1-t3}
else if(h<300){rgb.b=t1;rgb.g=t2;rgb.r=t2+t3}
else if(h<360){rgb.r=t1;rgb.g=t2;rgb.b=t1-t3}
else{rgb.r=0;rgb.g=0;rgb.b=0}}
return{r:Math.round(rgb.r),g:Math.round(rgb.g),b:Math.round(rgb.b)};},RGBToHex=function(rgb){var hex=[rgb.r.toString(16),rgb.g.toString(16),rgb.b.toString(16)];$.each(hex,function(nr,val){if(val.length==1){hex[nr]='0'+val;}});return hex.join('');},HSBToHex=function(hsb){return RGBToHex(HSBToRGB(hsb));},restoreOriginal=function(){var cal=$(this).parent();var col=cal.data('colorpicker').origColor;cal.data('colorpicker').color=col;fillRGBFields(col,cal.get(0));fillHexFields(col,cal.get(0));fillHSBFields(col,cal.get(0));setSelector(col,cal.get(0));setHue(col,cal.get(0));setNewColor(col,cal.get(0));};return{init:function(opt){opt=$.extend({},defaults,opt||{});if(typeof opt.color=='string'){opt.color=HexToHSB(opt.color);}else if(opt.color.r!=undefined&&opt.color.g!=undefined&&opt.color.b!=undefined){opt.color=RGBToHSB(opt.color);}else if(opt.color.h!=undefined&&opt.color.s!=undefined&&opt.color.b!=undefined){opt.color=fixHSB(opt.color);}else{return this;}
return this.each(function(){if(!$(this).data('colorpickerId')){var options=$.extend({},opt);options.origColor=opt.color;var id='collorpicker_'+parseInt(Math.random()*1000);$(this).data('colorpickerId',id);var cal=$(tpl).attr('id',id);if(options.flat){cal.appendTo(this).show();}else{cal.appendTo(document.body);}
options.fields=cal.find('input').bind('keyup',keyDown).bind('change',change).bind('blur',blur).bind('focus',focus);cal.find('span').bind('mousedown',downIncrement).end().find('>div.colorpicker_current_color').bind('click',restoreOriginal);options.selector=cal.find('div.colorpicker_color').bind('mousedown',downSelector);options.selectorIndic=options.selector.find('div div');options.el=this;options.hue=cal.find('div.colorpicker_hue div');cal.find('div.colorpicker_hue').bind('mousedown',downHue);options.newColor=cal.find('div.colorpicker_new_color');options.currentColor=cal.find('div.colorpicker_current_color');cal.data('colorpicker',options);cal.find('div.colorpicker_submit').bind('mouseenter',enterSubmit).bind('mouseleave',leaveSubmit).bind('click',clickSubmit);fillRGBFields(options.color,cal.get(0));fillHSBFields(options.color,cal.get(0));fillHexFields(options.color,cal.get(0));setHue(options.color,cal.get(0));setSelector(options.color,cal.get(0));setCurrentColor(options.color,cal.get(0));setNewColor(options.color,cal.get(0));if(options.flat){cal.css({position:'relative',display:'block'});}else{$(this).bind(options.eventName,show);}}});},showPicker:function(){return this.each(function(){if($(this).data('colorpickerId')){show.apply(this);}});},hidePicker:function(){return this.each(function(){if($(this).data('colorpickerId')){$('#'+$(this).data('colorpickerId')).hide();}});},setColor:function(col){if(typeof col=='string'){col=HexToHSB(col);}else if(col.r!=undefined&&col.g!=undefined&&col.b!=undefined){col=RGBToHSB(col);}else if(col.h!=undefined&&col.s!=undefined&&col.b!=undefined){col=fixHSB(col);}else{return this;}
return this.each(function(){if($(this).data('colorpickerId')){var cal=$('#'+$(this).data('colorpickerId'));cal.data('colorpicker').color=col;cal.data('colorpicker').origColor=col;fillRGBFields(col,cal.get(0));fillHSBFields(col,cal.get(0));fillHexFields(col,cal.get(0));setHue(col,cal.get(0));setSelector(col,cal.get(0));setCurrentColor(col,cal.get(0));setNewColor(col,cal.get(0));}});}};}();$.fn.extend({ColorPicker:ColorPicker.init,ColorPickerHide:ColorPicker.hidePicker,ColorPickerShow:ColorPicker.showPicker,ColorPickerSetColor:ColorPicker.setColor});})(jQuery);(function($){var expr=(function(){if(!$.browser.msie)return false;var div=document.createElement('div');try{div.style.setExpression('width','0+0');}
catch(e){return false;}
return true;})();function sz(el,p){return parseInt($.css(el,p))||0;};function hex2(s){var s=parseInt(s).toString(16);return(s.length<2)?'0'+s:s;};function gpc(node){for(;node&&node.nodeName.toLowerCase()!='html';node=node.parentNode){var v=$.css(node,'backgroundColor');if(v=='rgba(0, 0, 0, 0)')
continue;if(v.indexOf('rgb')>=0){var rgb=v.match(/\d+/g);return'#'+hex2(rgb[0])+hex2(rgb[1])+hex2(rgb[2]);}
if(v&&v!='transparent')
return v;}
return'#ffffff';};function getWidth(fx,i,width){switch(fx){case'round':return Math.round(width*(1-Math.cos(Math.asin(i/width))));case'cool':return Math.round(width*(1+Math.cos(Math.asin(i/width))));case'sharp':return Math.round(width*(1-Math.cos(Math.acos(i/width))));case'bite':return Math.round(width*(Math.cos(Math.asin((width-i-1)/width))));case'slide':return Math.round(width*(Math.atan2(i,width/i)));case'jut':return Math.round(width*(Math.atan2(width,(width-i-1))));case'curl':return Math.round(width*(Math.atan(i)));case'tear':return Math.round(width*(Math.cos(i)));case'wicked':return Math.round(width*(Math.tan(i)));case'long':return Math.round(width*(Math.sqrt(i)));case'sculpt':return Math.round(width*(Math.log((width-i-1),width)));case'dog':return(i&1)?(i+1):width;case'dog2':return(i&2)?(i+1):width;case'dog3':return(i&3)?(i+1):width;case'fray':return(i%2)*width;case'notch':return width;case'bevel':return i+1;}};$.fn.corner=function(o){if(this.length==0){if(!$.isReady&&this.selector){var s=this.selector,c=this.context;$(function(){$(s,c).corner(o);});}
return this;}
o=(o||"").toLowerCase();var keep=/keep/.test(o);var cc=((o.match(/cc:(#[0-9a-f]+)/)||[])[1]);var sc=((o.match(/sc:(#[0-9a-f]+)/)||[])[1]);var width=parseInt((o.match(/(\d+)px/)||[])[1])||10;var re=/round|bevel|notch|bite|cool|sharp|slide|jut|curl|tear|fray|wicked|sculpt|long|dog3|dog2|dog/;var fx=((o.match(re)||['round'])[0]);var edges={T:0,B:1};var opts={TL:/top|tl/.test(o),TR:/top|tr/.test(o),BL:/bottom|bl/.test(o),BR:/bottom|br/.test(o)};if(!opts.TL&&!opts.TR&&!opts.BL&&!opts.BR)
opts={TL:1,TR:1,BL:1,BR:1};var strip=document.createElement('div');strip.style.overflow='hidden';strip.style.height='1px';strip.style.backgroundColor=sc||'transparent';strip.style.borderStyle='solid';return this.each(function(index){var pad={T:parseInt($.css(this,'paddingTop'))||0,R:parseInt($.css(this,'paddingRight'))||0,B:parseInt($.css(this,'paddingBottom'))||0,L:parseInt($.css(this,'paddingLeft'))||0};if(typeof this.style.zoom!=undefined)this.style.zoom=1;if(!keep)this.style.border='none';strip.style.borderColor=cc||gpc(this.parentNode);var cssHeight=$.curCSS(this,'height');for(var j in edges){var bot=edges[j];if((bot&&(opts.BL||opts.BR))||(!bot&&(opts.TL||opts.TR))){strip.style.borderStyle='none '+(opts[j+'R']?'solid':'none')+' none '+(opts[j+'L']?'solid':'none');var d=document.createElement('div');$(d).addClass('jquery-corner');var ds=d.style;bot?this.appendChild(d):this.insertBefore(d,this.firstChild);if(bot&&cssHeight!='auto'){if($.css(this,'position')=='static')
this.style.position='relative';ds.position='absolute';ds.bottom=ds.left=ds.padding=ds.margin='0';if(expr)
ds.setExpression('width','this.parentNode.offsetWidth');else
ds.width='100%';}
else if(!bot&&$.browser.msie){if($.css(this,'position')=='static')
this.style.position='relative';ds.position='absolute';ds.top=ds.left=ds.right=ds.padding=ds.margin='0';if(expr){var bw=sz(this,'borderLeftWidth')+sz(this,'borderRightWidth');ds.setExpression('width','this.parentNode.offsetWidth - '+bw+'+ "px"');}
else
ds.width='100%';}
else{ds.margin=!bot?'-'+pad.T+'px -'+pad.R+'px '+(pad.T-width)+'px -'+pad.L+'px':(pad.B-width)+'px -'+pad.R+'px -'+pad.B+'px -'+pad.L+'px';}
for(var i=0;i<width;i++){var w=Math.max(0,getWidth(fx,i,width));var e=strip.cloneNode(false);e.style.borderWidth='0 '+(opts[j+'R']?w:0)+'px 0 '+(opts[j+'L']?w:0)+'px';bot?d.appendChild(e):d.insertBefore(e,d.firstChild);}}}});};$.fn.uncorner=function(){$('div.jquery-corner',this).remove();return this;};})(jQuery);(function($){$.prompt=function(message,options){options=$.extend({},$.prompt.defaults,options);$.prompt.currentPrefix=options.prefix;var ie6=($.browser.msie&&$.browser.version<7);var $body=$(document.body);var $window=$(window);var msgbox='<div class="'+options.prefix+'box" id="'+options.prefix+'box">';if(options.useiframe&&(($('object, applet').length>0)||ie6)){msgbox+='<iframe src="javascript:false;" style="display:block;position:absolute;z-index:-1;" class="'+options.prefix+'fade" id="'+options.prefix+'fade"></iframe>';}else{if(ie6){$('select').css('visibility','hidden');}
msgbox+='<div class="'+options.prefix+'fade" id="'+options.prefix+'fade"></div>';}
msgbox+='<div class="'+options.prefix+'" id="'+options.prefix+'"><div class="'+options.prefix+'container"><div class="';msgbox+=options.prefix+'close">X</div><div id="'+options.prefix+'states"></div>';msgbox+='</div></div></div>';var $jqib=$(msgbox).appendTo($body);var $jqi=$jqib.children('#'+options.prefix);var $jqif=$jqib.children('#'+options.prefix+'fade');if(message.constructor==String){message={state0:{html:message,buttons:options.buttons,focus:options.focus,submit:options.submit}};}
var states="";$.each(message,function(statename,stateobj){stateobj=$.extend({},$.prompt.defaults.state,stateobj);message[statename]=stateobj;states+='<div id="'+options.prefix+'_state_'+statename+'" class="'+options.prefix+'_state" style="display:none;"><div class="'+options.prefix+'message">'+stateobj.html+'</div><div class="'+options.prefix+'buttons">';$.each(stateobj.buttons,function(k,v){states+='<button name="'+options.prefix+'_'+statename+'_button'+k+'" id="'+options.prefix+'_'+statename+'_button'+k+'" value="'+v+'">'+k+'</button>';});states+='</div></div>';});$jqi.find('#'+options.prefix+'states').html(states).children('.'+options.prefix+'_state:first').css('display','block');$jqi.find('.'+options.prefix+'buttons:empty').css('display','none');$.each(message,function(statename,stateobj){var $state=$jqi.find('#'+options.prefix+'_state_'+statename);$state.children('.'+options.prefix+'buttons').children('button').click(function(){var msg=$state.children('.'+options.prefix+'message');var clicked=stateobj.buttons[$(this).text()];var forminputs={};$.each($jqi.find('#'+options.prefix+'states :input').serializeArray(),function(i,obj){if(forminputs[obj.name]===undefined){forminputs[obj.name]=obj.value;}else if(typeof forminputs[obj.name]==Array){forminputs[obj.name].push(obj.value);}else{forminputs[obj.name]=[forminputs[obj.name],obj.value];}});var close=stateobj.submit(clicked,msg,forminputs);if(close===undefined||close){removePrompt(true,clicked,msg,forminputs);}});$state.find('.'+options.prefix+'buttons button:eq('+stateobj.focus+')').addClass(options.prefix+'defaultbutton');});var ie6scroll=function(){$jqib.css({top:$window.scrollTop()});};var fadeClicked=function(){if(options.persistent){var i=0;$jqib.addClass(options.prefix+'warning');var intervalid=setInterval(function(){$jqib.toggleClass(options.prefix+'warning');if(i++>1){clearInterval(intervalid);$jqib.removeClass(options.prefix+'warning');}},100);}
else{removePrompt();}};var keyPressEventHandler=function(e){var key=(window.event)?event.keyCode:e.keyCode;if(key==27){removePrompt();}
if(key==9){var $inputels=$(':input:enabled:visible',$jqib);var fwd=!e.shiftKey&&e.target==$inputels[$inputels.length-1];var back=e.shiftKey&&e.target==$inputels[0];if(fwd||back){setTimeout(function(){if(!$inputels)
return;var el=$inputels[back===true?$inputels.length-1:0];if(el)
el.focus();},10);return false;}}};var positionPrompt=function(){$jqib.css({position:(ie6)?"absolute":"fixed",height:$window.height(),width:"100%",top:(ie6)?$window.scrollTop():0,left:0,right:0,bottom:0});$jqif.css({position:"absolute",height:$window.height(),width:"100%",top:0,left:0,right:0,bottom:0});$jqi.css({position:"absolute",top:options.top,left:"50%",marginLeft:(($jqi.outerWidth()/2)*-1)});};var stylePrompt=function(){$jqif.css({zIndex:options.zIndex,display:"none",opacity:options.opacity});$jqi.css({zIndex:options.zIndex+1,display:"none"});$jqib.css({zIndex:options.zIndex});};var removePrompt=function(callCallback,clicked,msg,formvals){$jqi.remove();if(ie6){$body.unbind('scroll',ie6scroll);}
$window.unbind('resize',positionPrompt);$jqif.fadeOut(options.overlayspeed,function(){$jqif.unbind('click',fadeClicked);$jqif.remove();if(callCallback){options.callback(clicked,msg,formvals);}
$jqib.unbind('keypress',keyPressEventHandler);$jqib.remove();if(ie6&&!options.useiframe){$('select').css('visibility','visible');}});};positionPrompt();stylePrompt();if(ie6){$window.scroll(ie6scroll);}
$jqif.click(fadeClicked);$window.resize(positionPrompt);$jqib.bind("keydown keypress",keyPressEventHandler);$jqi.find('.'+options.prefix+'close').click(removePrompt);$jqif.fadeIn(options.overlayspeed);$jqi[options.show](options.promptspeed,options.loaded);$jqi.find('#'+options.prefix+'states .'+options.prefix+'_state:first .'+options.prefix+'defaultbutton').focus();if(options.timeout>0)
setTimeout($.prompt.close,options.timeout);return $jqib;};$.prompt.defaults={prefix:'jqi',buttons:{Ok:true},loaded:function(){},submit:function(){return true;},callback:function(){},opacity:0.6,zIndex:999,overlayspeed:'slow',promptspeed:'fast',show:'fadeIn',focus:0,useiframe:false,top:"15%",persistent:true,timeout:0,state:{html:'',buttons:{Ok:true},focus:0,submit:function(){return true;}}};$.prompt.currentPrefix=$.prompt.defaults.prefix;$.prompt.setDefaults=function(o){$.prompt.defaults=$.extend({},$.prompt.defaults,o);};$.prompt.setStateDefaults=function(o){$.prompt.defaults.state=$.extend({},$.prompt.defaults.state,o);};$.prompt.getStateContent=function(state){return $('#'+$.prompt.currentPrefix+'_state_'+state);};$.prompt.getCurrentState=function(){return $('.'+$.prompt.currentPrefix+'_state:visible');};$.prompt.getCurrentStateName=function(){var stateid=$.prompt.getCurrentState().attr('id');return stateid.replace($.prompt.currentPrefix+'_state_','');};$.prompt.goToState=function(state){$('.'+$.prompt.currentPrefix+'_state').slideUp('slow');$('#'+$.prompt.currentPrefix+'_state_'+state).slideDown('slow',function(){$(this).find('.'+$.prompt.currentPrefix+'defaultbutton').focus();});};$.prompt.nextState=function(){var $next=$('.'+$.prompt.currentPrefix+'_state:visible').next();$('.'+$.prompt.currentPrefix+'_state').slideUp('slow');$next.slideDown('slow',function(){$next.find('.'+$.prompt.currentPrefix+'defaultbutton').focus();});};$.prompt.prevState=function(){var $next=$('.'+$.prompt.currentPrefix+'_state:visible').prev();$('.'+$.prompt.currentPrefix+'_state').slideUp('slow');$next.slideDown('slow',function(){$next.find('.'+$.prompt.currentPrefix+'defaultbutton').focus();});};$.prompt.close=function(){$('#'+$.prompt.currentPrefix+'box').fadeOut('fast',function(){$(this).remove();});};})(jQuery);(function($){$.fn.editable=function(target,options){if('disable'==target){$(this).data('disabled.editable',true);return;}
if('enable'==target){$(this).data('disabled.editable',false);return;}
if('destroy'==target){$(this).unbind($(this).data('event.editable')).removeData('disabled.editable').removeData('event.editable');return;}
var settings=$.extend({},$.fn.editable.defaults,{target:target},options);var plugin=$.editable.types[settings.type].plugin||function(){};var submit=$.editable.types[settings.type].submit||function(){};var buttons=$.editable.types[settings.type].buttons||$.editable.types['defaults'].buttons;var content=$.editable.types[settings.type].content||$.editable.types['defaults'].content;var element=$.editable.types[settings.type].element||$.editable.types['defaults'].element;var reset=$.editable.types[settings.type].reset||$.editable.types['defaults'].reset;var callback=settings.callback||function(){};var onedit=settings.onedit||function(){};var onsubmit=settings.onsubmit||function(){};var onreset=settings.onreset||function(){};var onerror=settings.onerror||reset;if(settings.tooltip){$(this).attr('title',settings.tooltip);}
settings.autowidth='auto'==settings.width;settings.autoheight='auto'==settings.height;return this.each(function(){var self=this;var savedwidth=$(self).width();var savedheight=$(self).height();$(this).data('event.editable',settings.event);if(!$.trim($(this).html())){$(this).html(settings.placeholder);}
$(this).bind(settings.event,function(e){if(true===$(this).data('disabled.editable')){return;}
if(self.editing){return;}
if(false===onedit.apply(this,[settings,self])){return;}
e.preventDefault();e.stopPropagation();if(settings.tooltip){$(self).removeAttr('title');}
if(0==$(self).width()){settings.width=savedwidth;settings.height=savedheight;}else{if(settings.width!='none'){settings.width=settings.autowidth?$(self).width():settings.width;}
if(settings.height!='none'){settings.height=settings.autoheight?$(self).height():settings.height;}}
if($(this).html().toLowerCase().replace(/(;|"|\/)/g,'')==settings.placeholder.toLowerCase().replace(/(;|"|\/)/g,'')){$(this).html('');}
self.editing=true;self.revert=$(self).html();$(self).html('');var form=$('<form />');if(settings.cssclass){if('inherit'==settings.cssclass){form.attr('class',$(self).attr('class'));}else{form.attr('class',settings.cssclass);}}
if(settings.style){if('inherit'==settings.style){form.attr('style',$(self).attr('style'));form.css('display',$(self).css('display'));}else{form.attr('style',settings.style);}}
var input=element.apply(form,[settings,self]);var input_content;if(settings.loadurl){var t=setTimeout(function(){input.disabled=true;content.apply(form,[settings.loadtext,settings,self]);},100);var loaddata={};loaddata[settings.id]=self.id;if($.isFunction(settings.loaddata)){$.extend(loaddata,settings.loaddata.apply(self,[self.revert,settings]));}else{$.extend(loaddata,settings.loaddata);}
$.ajax({type:settings.loadtype,url:settings.loadurl,data:loaddata,async:false,success:function(result){window.clearTimeout(t);input_content=result;input.disabled=false;}});}else if(settings.data){input_content=settings.data;if($.isFunction(settings.data)){input_content=settings.data.apply(self,[self.revert,settings]);}}else{input_content=self.revert;}
content.apply(form,[input_content,settings,self]);input.attr('name',settings.name);buttons.apply(form,[settings,self]);$(self).append(form);plugin.apply(form,[settings,self]);$(':input:visible:enabled:first',form).focus();if(settings.select){input.select();}
input.keydown(function(e){if(e.keyCode==27){e.preventDefault();reset.apply(form,[settings,self]);}});var t;if('cancel'==settings.onblur){input.blur(function(e){t=setTimeout(function(){reset.apply(form,[settings,self]);},500);});}else if('submit'==settings.onblur){input.blur(function(e){form.submit();});}else if($.isFunction(settings.onblur)){input.blur(function(e){settings.onblur.apply(self,[input.val(),settings]);});}else{input.blur(function(e){});}
form.submit(function(e){if(t){clearTimeout(t);}
e.preventDefault();if(false!==onsubmit.apply(form,[settings,self])){if(false!==submit.apply(form,[settings,self])){if($.isFunction(settings.target)){var str=settings.target.apply(self,[input.val(),settings]);$(self).html(str);self.editing=false;callback.apply(self,[self.innerHTML,settings]);if(!$.trim($(self).html())){$(self).html(settings.placeholder);}}else{var submitdata={};submitdata[settings.name]=input.val();submitdata[settings.id]=self.id;if($.isFunction(settings.submitdata)){$.extend(submitdata,settings.submitdata.apply(self,[self.revert,settings]));}else{$.extend(submitdata,settings.submitdata);}
if('PUT'==settings.method){submitdata['_method']='put';}
$(self).html(settings.indicator);var ajaxoptions={type:'POST',data:submitdata,dataType:'html',url:settings.target,success:function(result,status){if(ajaxoptions.dataType=='html'){$(self).html(result);}
self.editing=false;callback.apply(self,[result,settings]);if(!$.trim($(self).html())){$(self).html(settings.placeholder);}},error:function(xhr,status,error){onerror.apply(form,[settings,self,xhr]);}};$.extend(ajaxoptions,settings.ajaxoptions);$.ajax(ajaxoptions);}}}
$(self).attr('title',settings.tooltip);return false;});});this.reset=function(form){if(this.editing){if(false!==onreset.apply(form,[settings,self])){$(self).html(self.revert);self.editing=false;if(!$.trim($(self).html())){$(self).html(settings.placeholder);}
if(settings.tooltip){$(self).attr('title',settings.tooltip);}}}};});};$.editable={types:{defaults:{element:function(settings,original){var input=$('<input type="hidden"></input>');$(this).append(input);return(input);},content:function(string,settings,original){$(':input:first',this).val(string);},reset:function(settings,original){original.reset(this);},buttons:function(settings,original){var form=this;if(settings.submit){if(settings.submit.match(/>$/)){var submit=$(settings.submit).click(function(){if(submit.attr("type")!="submit"){form.submit();}});}else{var submit=$('<button type="submit" />');submit.html(settings.submit);}
$(this).append(submit);}
if(settings.cancel){if(settings.cancel.match(/>$/)){var cancel=$(settings.cancel);}else{var cancel=$('<button type="cancel" />');cancel.html(settings.cancel);}
$(this).append(cancel);$(cancel).click(function(event){if($.isFunction($.editable.types[settings.type].reset)){var reset=$.editable.types[settings.type].reset;}else{var reset=$.editable.types['defaults'].reset;}
reset.apply(form,[settings,original]);return false;});}}},text:{element:function(settings,original){var input=$('<input />');if(settings.width!='none'){input.attr('width',settings.width);}
if(settings.height!='none'){input.attr('height',settings.height);}
input.attr('autocomplete','off');$(this).append(input);return(input);}},textarea:{element:function(settings,original){var textarea=$('<textarea />');if(settings.rows){textarea.attr('rows',settings.rows);}else if(settings.height!="none"){textarea.height(settings.height);}
if(settings.cols){textarea.attr('cols',settings.cols);}else if(settings.width!="none"){textarea.width(settings.width);}
$(this).append(textarea);return(textarea);}},select:{element:function(settings,original){var select=$('<select />');$(this).append(select);return(select);},content:function(data,settings,original){if(String==data.constructor){eval('var json = '+data);}else{var json=data;}
for(var key in json){if(!json.hasOwnProperty(key)){continue;}
if('selected'==key){continue;}
var option=$('<option />').val(key).append(json[key]);$('select',this).append(option);}
$('select',this).children().each(function(){if($(this).val()==json['selected']||$(this).text()==$.trim(original.revert)){$(this).attr('selected','selected');}});if(!settings.submit){var form=this;$('select',this).change(function(){form.submit();});}}}},addInputType:function(name,input){$.editable.types[name]=input;}};$.fn.editable.defaults={name:'value',id:'id',type:'text',width:'auto',height:'auto',event:'click.editable',onblur:'cancel',loadtype:'GET',loadtext:'Loading...',placeholder:'Click to edit',loaddata:{},submitdata:{},ajaxoptions:{}};})(jQuery);function json2dom(je){var tag,content;for(var key in je){if(tag)
throw"dictionary must have a single item";tag=key;content=je[key];}
var element=$(document.createElement(tag));if(typeof content=="string"){element.text(content);}
else if(content instanceof Array){for(var i=0,max=content.length;i<max;i++){element.append(json2dom(content[i]));}}
else if(content instanceof jQuery){element.html(content);}
else{for(var method in content){if(content[method]instanceof Array)
element[method].apply(element,content[method]);else
element[method].call(element,content[method]);}}
return element;}
jQuery.extend({json2dom:json2dom});$.notifyBar=function(settings)
{var bar={};if(!settings){settings={};}
this.html=settings.html||"Your message here";this.delay=settings.delay||2500;this.animationSpeed=settings.animationSpeed||"normal";this.jqObject=settings.jqObject;if(this.jqObject){bar=this.jqObject;}else{bar=$("<div></div>").attr("id","notifyBar").css("width","100%").css("position","absolute").css("top","0px").css("left","0px").css("z-index","32768").css("background-color","#BBBBBB").css("font-size","18px").css("color","#000").css("text-align","center").css("font-family","Arial, Helvetica, serif").css("padding","30px 0px").css("border-bottom","1px solid #000000");}
bar.html(this.html).hide();var id=bar.attr("id");switch(this.animationSpeed){case"slow":asTime=600;break;case"normal":asTime=400;break;case"fast":asTime=200;break;default:asTime=this.animationSpeed;}
$("body").prepend(bar);bar.slideDown(asTime);setTimeout("$('#"+id+"').slideUp("+asTime+");",this.delay+asTime);};(function($){var options;$.fn.treeTable=function(opts){options=$.extend({},$.fn.treeTable.defaults,opts);return this.each(function(){$(this).addClass("treeTable").find("tbody tr").each(function(){if(!options.expandable||$(this)[0].className.search("child-of-")==-1){initialize($(this));}});});};$.fn.treeTable.defaults={childPrefix:"child-of-",expandable:true,indent:19,initialState:"collapsed",treeColumn:0};$.fn.collapse=function(){$(this).addClass("collapsed");childrenOf($(this)).each(function(){initialize($(this));if(!$(this).hasClass("collapsed")){$(this).collapse();}
$(this).hide();});return this;};$.fn.expand=function(){$(this).removeClass("collapsed").addClass("expanded");childrenOf($(this)).each(function(){initialize($(this));if($(this).is(".expanded.parent")){$(this).expand();}
$(this).show();});return this;};$.fn.appendBranchTo=function(destination){var node=$(this);var parent=parentOf(node);var ancestorNames=$.map(ancestorsOf($(destination)),function(a){return a.id;});if($.inArray(node[0].id,ancestorNames)==-1&&(!parent||(destination.id!=parent[0].id))&&destination.id!=node[0].id){indent(node,ancestorsOf(node).length*options.indent*-1);if(parent){node.removeClass(options.childPrefix+parent[0].id);}
node.addClass(options.childPrefix+destination.id);move(node,destination);indent(node,ancestorsOf(node).length*options.indent);}
return this;};$.fn.reverse=function(){return this.pushStack(this.get().reverse(),arguments);};$.fn.toggleBranch=function(){if($(this).hasClass("collapsed")){$(this).expand();}else{$(this).removeClass("expanded").collapse();}
return this;};$.fn.initializeTreeTableNode=function(){initialize($(this));};function ancestorsOf(node){var ancestors=[];while(node=parentOf(node)){ancestors[ancestors.length]=node[0];}
return ancestors;};function childrenOf(node){return $("table.treeTable tbody tr."+options.childPrefix+node[0].id);};function indent(node,value){var cell=$(node.children("td")[options.treeColumn]);var padding=parseInt(cell.css("padding-left"),10)+value;cell.css("padding-left",+padding+"px");childrenOf(node).each(function(){indent($(this),value);});};function initialize(node){if(!node.hasClass("initialized")){node.addClass("initialized");var childNodes=childrenOf(node);if(!node.hasClass("parent")&&childNodes.length>0){node.addClass("parent");}
if(node.hasClass("parent")){var cell=$(node.children("td")[options.treeColumn]);var padding=parseInt(cell.css("padding-left"),10)+options.indent;childNodes.each(function(){$($(this).children("td")[options.treeColumn]).css("padding-left",padding+"px");});if(options.expandable){cell.prepend('<span style="margin-left: -'+options.indent+'px; padding-left: '+options.indent+'px" class="expander"></span>');$(cell[0].firstChild).click(function(){node.toggleBranch();});if(!(node.hasClass("expanded")||node.hasClass("collapsed"))){node.addClass(options.initialState);}
if(node.hasClass("collapsed")){node.collapse();}else if(node.hasClass("expanded")){node.expand();}}}}};function move(node,destination){node.insertAfter(destination);childrenOf(node).reverse().each(function(){move($(this),node[0]);});};function parentOf(node){var classNames=node[0].className.split(' ');for(key in classNames){if(classNames[key].match("child-of-")){return $("#"+classNames[key].substring(9));}}};})(jQuery);if(jQuery)(function($){$.extend($.fn,{multiSelect:function(o,callback){if(!o)var o={};if(o.selectAll==undefined)o.selectAll=true;if(o.selectAllText==undefined)o.selectAllText="Select All";if(o.noneSelected==undefined)o.noneSelected='Select options';if(o.oneOrMoreSelected==undefined)o.oneOrMoreSelected='% selected';$(this).each(function(){var select=$(this);var html='<input type="text" readonly="readonly" class="multiSelect" value="" style="cursor: default;" />';html+='<div class="multiSelectOptions" style="position: absolute; z-index: 99999; display: none;">';if(o.selectAll)html+='<label class="selectAll"><input type="checkbox" class="selectAll" />'+o.selectAllText+'</label>';$(select).find('OPTION').each(function(){if($(this).val()!=''){html+='<label><input type="checkbox" name="'+$(select).attr('name')+'" value="'+$(this).val()+'"';if($(this).attr('selected'))html+=' checked="checked"';html+=' />'+$(this).html()+'</label>';}});html+='</div>';$(select).after(html);$(select).next('.multiSelect').mouseover(function(){$(this).addClass('hover');}).mouseout(function(){$(this).removeClass('hover');}).click(function(){if($(this).hasClass('active')){$(this).multiSelectOptionsHide();}else{$(this).multiSelectOptionsShow();}
return false;}).focus(function(){$(this).addClass('focus');}).blur(function(){$(this).removeClass('focus');});if(o.selectAll){var sa=true;$(select).next('.multiSelect').next('.multiSelectOptions').find('INPUT:checkbox').not('.selectAll').each(function(){if(!$(this).attr('checked'))sa=false;});if(sa)$(select).next('.multiSelect').next('.multiSelectOptions').find('INPUT.selectAll').attr('checked',true).parent().addClass('checked');}
$(select).next('.multiSelect').next('.multiSelectOptions').find('INPUT.selectAll').click(function(){if($(this).attr('checked')==true)$(this).parent().parent().find('INPUT:checkbox').attr('checked',true).parent().addClass('checked');else $(this).parent().parent().find('INPUT:checkbox').attr('checked',false).parent().removeClass('checked');});$(select).next('.multiSelect').next('.multiSelectOptions').find('INPUT:checkbox').click(function(){$(this).parent().parent().multiSelectUpdateSelected(o);$(this).parent().parent().find('LABEL').removeClass('checked').find('INPUT:checked').parent().addClass('checked');$(this).parent().parent().prev('.multiSelect').focus();if(!$(this).attr('checked'))$(this).parent().parent().find('INPUT:checkbox.selectAll').attr('checked',false).parent().removeClass('checked');if(callback)callback($(this));});$(select).next('.multiSelect').next('.multiSelectOptions').each(function(){$(this).multiSelectUpdateSelected(o);$(this).find('INPUT:checked').parent().addClass('checked');});$(select).next('.multiSelect').next('.multiSelectOptions').find('LABEL').mouseover(function(){$(this).parent().find('LABEL').removeClass('hover');$(this).addClass('hover');}).mouseout(function(){$(this).parent().find('LABEL').removeClass('hover');});$(select).next('.multiSelect').keydown(function(e){if($(this).next('.multiSelectOptions').is(':visible')){if(e.keyCode==9){$(this).addClass('focus').trigger('click');$(this).focus().next(':input').focus();return true;}
if(e.keyCode==27||e.keyCode==37||e.keyCode==39){$(this).addClass('focus').trigger('click');}
if(e.keyCode==40){if(!$(this).next('.multiSelectOptions').find('LABEL').hasClass('hover')){$(this).next('.multiSelectOptions').find('LABEL:first').addClass('hover');}else{$(this).next('.multiSelectOptions').find('LABEL.hover').removeClass('hover').next('LABEL').addClass('hover');if(!$(this).next('.multiSelectOptions').find('LABEL').hasClass('hover')){$(this).next('.multiSelectOptions').find('LABEL:first').addClass('hover');}}
$(this).multiSelectAdjustViewport($(this));return false;}
if(e.keyCode==38){if(!$(this).next('.multiSelectOptions').find('LABEL').hasClass('hover')){$(this).next('.multiSelectOptions').find('LABEL:first').addClass('hover');}else{$(this).next('.multiSelectOptions').find('LABEL.hover').removeClass('hover').prev('LABEL').addClass('hover');if(!$(this).next('.multiSelectOptions').find('LABEL').hasClass('hover')){$(this).next('.multiSelectOptions').find('LABEL:last').addClass('hover');}}
$(this).multiSelectAdjustViewport($(this));return false;}
if(e.keyCode==13||e.keyCode==32){if($(this).next('.multiSelectOptions').find('LABEL.hover INPUT:checkbox').hasClass('selectAll')){if($(this).next('.multiSelectOptions').find('LABEL.hover INPUT:checkbox').attr('checked')){$(this).next('.multiSelectOptions').find('INPUT:checkbox').attr('checked',false).parent().removeClass('checked');}else{$(this).next('.multiSelectOptions').find('INPUT:checkbox').attr('checked',true).parent().addClass('checked');}
$(this).next('.multiSelectOptions').multiSelectUpdateSelected(o);if(callback)callback($(this));return false;}
if($(this).next('.multiSelectOptions').find('LABEL.hover INPUT:checkbox').attr('checked')){$(this).next('.multiSelectOptions').find('LABEL.hover INPUT:checkbox').attr('checked',false);$(this).next('.multiSelectOptions').multiSelectUpdateSelected(o);$(this).next('.multiSelectOptions').find('LABEL').removeClass('checked').find('INPUT:checked').parent().addClass('checked');$(this).next('.multiSelectOptions').find('INPUT:checkbox.selectAll').attr('checked',false).parent().removeClass('checked');if(callback)callback($(this));}else{$(this).next('.multiSelectOptions').find('LABEL.hover INPUT:checkbox').attr('checked',true);$(this).next('.multiSelectOptions').multiSelectUpdateSelected(o);$(this).next('.multiSelectOptions').find('LABEL').removeClass('checked').find('INPUT:checked').parent().addClass('checked');if(callback)callback($(this));}}
return false;}else{if(e.keyCode==38||e.keyCode==40||e.keyCode==13||e.keyCode==32){$(this).removeClass('focus').trigger('click');$(this).next('.multiSelectOptions').find('LABEL:first').addClass('hover');return false;}
if(e.keyCode==9){$(this).focus().next(':input').focus();return true;}}
if(e.keyCode==13)return false;});$(select).remove();});},multiSelectOptionsHide:function(){$(this).removeClass('active').next('.multiSelectOptions').hide();},multiSelectOptionsShow:function(){$('.multiSelect').multiSelectOptionsHide();$(this).next('.multiSelectOptions').find('LABEL').removeClass('hover');$(this).addClass('active').next('.multiSelectOptions').show();var offset=$(this).position();$(this).next('.multiSelectOptions').css({top:offset.top+$(this).outerHeight()+'px'});$(this).next('.multiSelectOptions').css({left:offset.left+'px'});multiSelectCurrent=$(this);var timer='';$(this).next('.multiSelectOptions').hover(function(){clearTimeout(timer);},function(){timer=setTimeout('jQuery(multiSelectCurrent).multiSelectOptionsHide(); $(multiSelectCurrent).unbind("hover");',250);});},multiSelectUpdateSelected:function(o){var i=0,s='';$(this).find('INPUT:checkbox:checked').not('.selectAll').each(function(){i++;})
if(i==0){$(this).prev('INPUT.multiSelect').val(o.noneSelected);}else{if(o.oneOrMoreSelected=='*'){var display='';$(this).find('INPUT:checkbox:checked').each(function(){if($(this).parent().text()!=o.selectAllText)display=display+$(this).parent().text()+', ';});display=display.substr(0,display.length-2);$(this).prev('INPUT.multiSelect').val(display);}else{$(this).prev('INPUT.multiSelect').val(o.oneOrMoreSelected.replace('%',i));}}},multiSelectAdjustViewport:function(el){var i=0;var selectionTop=0,selectionHeight=0;$(el).next('.multiSelectOptions').find('LABEL').each(function(){if($(this).hasClass('hover')){selectionTop=i;selectionHeight=$(this).outerHeight();return;}
i+=$(this).outerHeight();});var divScroll=$(el).next('.multiSelectOptions').scrollTop();var divHeight=$(el).next('.multiSelectOptions').height();$(el).next('.multiSelectOptions').scrollTop(selectionTop-((divHeight/2)-(selectionHeight/2)));}});})(jQuery);(function($){$.fn.jqm=function(o){var p={overlay:50,overlayClass:'jqmOverlay',closeClass:'jqmClose',trigger:'.jqModal',ajax:F,ajaxText:'',target:F,modal:F,toTop:F,onShow:F,onHide:F,onLoad:F};return this.each(function(){if(this._jqm)return H[this._jqm].c=$.extend({},H[this._jqm].c,o);s++;this._jqm=s;H[s]={c:$.extend(p,$.jqm.params,o),a:F,w:$(this).addClass('jqmID'+s),s:s};if(p.trigger)$(this).jqmAddTrigger(p.trigger);});};$.fn.jqmAddClose=function(e){return hs(this,e,'jqmHide');};$.fn.jqmAddTrigger=function(e){return hs(this,e,'jqmShow');};$.fn.jqmShow=function(t){return this.each(function(){t=t||window.event;$.jqm.open(this._jqm,t);});};$.fn.jqmHide=function(t){return this.each(function(){t=t||window.event;$.jqm.close(this._jqm,t)});};$.jqm={hash:{},open:function(s,t){var h=H[s],c=h.c,cc='.'+c.closeClass,z=(parseInt(h.w.css('z-index'))),z=(z>0)?z:3000,o=$('<div></div>').css({height:'100%',width:'100%',position:'fixed',left:0,top:0,'z-index':z-1,opacity:c.overlay/100});if(h.a)return F;h.t=t;h.a=true;h.w.css('z-index',z);if(c.modal){if(!A[0])L('bind');A.push(s);}
else if(c.overlay>0)h.w.jqmAddClose(o);else o=F;h.o=(o)?o.addClass(c.overlayClass).prependTo('body'):F;if(ie6){$('html,body').css({height:'100%',width:'100%'});if(o){o=o.css({position:'absolute'})[0];for(var y in{Top:1,Left:1})o.style.setExpression(y.toLowerCase(),"(_=(document.documentElement.scroll"+y+" || document.body.scroll"+y+"))+'px'");}}
if(c.ajax){var r=c.target||h.w,u=c.ajax,r=(typeof r=='string')?$(r,h.w):$(r),u=(u.substr(0,1)=='@')?$(t).attr(u.substring(1)):u;r.html(c.ajaxText).load(u,function(){if(c.onLoad)c.onLoad.call(this,h);if(cc)h.w.jqmAddClose($(cc,h.w));e(h);});}
else if(cc)h.w.jqmAddClose($(cc,h.w));if(c.toTop&&h.o)h.w.before('<span id="jqmP'+h.w[0]._jqm+'"></span>').insertAfter(h.o);(c.onShow)?c.onShow(h):h.w.show();e(h);return F;},close:function(s){var h=H[s];if(!h.a)return F;h.a=F;if(A[0]){A.pop();if(!A[0])L('unbind');}
if(h.c.toTop&&h.o)$('#jqmP'+h.w[0]._jqm).after(h.w).remove();if(h.c.onHide)h.c.onHide(h);else{h.w.hide();if(h.o)h.o.remove();}return F;},params:{}};var s=0,H=$.jqm.hash,A=[],ie6=$.browser.msie&&($.browser.version=="6.0"),F=false,i=$('<iframe src="javascript:false;document.write(\'\');" class="jqm"></iframe>').css({opacity:0}),e=function(h){if(ie6)if(h.o)h.o.html('<p style="width:100%;height:100%"/>').prepend(i);else if(!$('iframe.jqm',h.w)[0])h.w.prepend(i);f(h);},f=function(h){try{$(':input:visible',h.w)[0].focus();}catch(_){}},L=function(t){$()[t]("keypress",m)[t]("keydown",m)[t]("mousedown",m);},m=function(e){var h=H[A[A.length-1]],r=(!$(e.target).parents('.jqmID'+h.s)[0]);if(r)f(h);return!r;},hs=function(w,t,c){return w.each(function(){var s=this._jqm;$(t).each(function(){if(!this[c]){this[c]=[];$(this).click(function(){for(var i in{jqmShow:1,jqmHide:1})for(var s in this[i])if(H[this[i][s]])H[this[i][s]].w[i](this);return F;});}this[c].push(s);});});};})(jQuery);(function(b){b.tools=b.tools||{version:{}};b.tools.version.scrollable="1.0.5";var c=null;function a(p,m){var s=this;if(!c){c=s}function n(t,u){b(s).bind(t,function(w,v){if(u&&u.call(this,v.index)===false&&v){v.proceed=false}});return s}b.each(m,function(t,u){if(b.isFunction(u)){n(t,u)}});var d=!m.vertical;var f=b(m.items,p);var j=0;function l(u,t){return u.indexOf("#")!=-1?b(u).eq(0):t.siblings(u).eq(0)}var q=l(m.navi,p);var g=l(m.prev,p);var i=l(m.next,p);var h=l(m.prevPage,p);var o=l(m.nextPage,p);b.extend(s,{getIndex:function(){return j},getConf:function(){return m},getSize:function(){return s.getItems().size()},getPageAmount:function(){return Math.ceil(this.getSize()/m.size)},getPageIndex:function(){return Math.ceil(j/m.size)},getRoot:function(){return p},getItemWrap:function(){return f},getItems:function(){return f.children()},getVisibleItems:function(){return s.getItems().slice(j,j+m.size)},seekTo:function(w,u,A){if(u===undefined){u=m.speed}if(b.isFunction(u)){A=u;u=m.speed}if(w<0){w=0}if(w>s.getSize()-m.size){return s}var B=s.getItems().eq(w);if(!B.length){return s}var t={index:w,proceed:true};b(s).trigger("onBeforeSeek",t);if(!t.proceed){return s}if(d){var v=-B.position().left;f.animate({left:v},u,m.easing,A?function(){A.call(s)}:null)}else{var z=-B.position().top;f.animate({top:z},u,m.easing,A?function(){A.call(s)}:null)}if(q.length){var x=m.activeClass;var y=Math.ceil(w/m.size);y=Math.min(y,q.children().length-1);q.children().removeClass(x).eq(y).addClass(x)}if(w===0){g.add(h).addClass(m.disabledClass)}else{g.add(h).removeClass(m.disabledClass)}if(w>=s.getSize()-m.size){i.add(o).addClass(m.disabledClass)}else{i.add(o).removeClass(m.disabledClass)}c=s;j=w;b(s).trigger("onSeek",{index:w});return s},move:function(v,u,t){var w=j+v;if(m.loop&&w>(s.getSize()-m.size)){w=0}return this.seekTo(w,u,t)},next:function(u,t){return this.move(1,u,t)},prev:function(u,t){return this.move(-1,u,t)},movePage:function(v,u,t){return this.move(m.size*v,u,t)},setPage:function(x,y,v){var u=m.size;var t=u*x;var w=t+u>=this.getSize();if(w){t=this.getSize()-m.size}return this.seekTo(t,y,v)},prevPage:function(u,t){return this.setPage(this.getPageIndex()-1,u,t)},nextPage:function(u,t){return this.setPage(this.getPageIndex()+1,u,t)},begin:function(u,t){return this.seekTo(0,u,t)},end:function(u,t){return this.seekTo(this.getSize()-m.size,u,t)},reload:function(){return r()},click:function(u,x,v){var w=s.getItems().eq(u);var t=m.activeClass;if(u<0||u>=this.getSize()){return s}if(m.size==2){if(u==s.getIndex()){u--}s.getItems().removeClass(t);w.addClass(t);return this.seekTo(u,x,v)}if(!w.hasClass(t)){s.getItems().removeClass(t);w.addClass(t);var z=Math.floor(m.size/2);var y=u-z;if(y>s.getSize()-m.size){y=s.getSize()-m.size}if(y!==u){return this.seekTo(y,x,v)}}return s},onBeforeSeek:function(t){return n("onBeforeSeek",t)},onSeek:function(t){return n("onSeek",t)}});if(b.isFunction(b.fn.mousewheel)){p.bind("mousewheel.scrollable",function(u,v){var t=b.browser.opera?1:-1;s.move(v>0?t:-t,50);return false})}g.addClass(m.disabledClass).click(function(){s.prev()});i.click(function(){s.next()});o.click(function(){s.nextPage()});h.addClass(m.disabledClass).click(function(){s.prevPage()});if(m.keyboard){b(document).unbind("keydown.scrollable").bind("keydown.scrollable",function(t){var u=c;if(!u||t.altKey||t.ctrlKey){return}if(d&&(t.keyCode==37||t.keyCode==39)){u.move(t.keyCode==37?-1:1);return t.preventDefault()}if(!d&&(t.keyCode==38||t.keyCode==40)){u.move(t.keyCode==38?-1:1);return t.preventDefault()}return true})}function r(){if(q.is(":empty")||q.data("me")==s){q.empty();q.data("me",s);for(var u=0;u<s.getPageAmount();u++){var v=b("<"+m.naviItem+"/>").attr("href",u).click(function(x){var w=b(this);w.parent().children().removeClass(m.activeClass);w.addClass(m.activeClass);s.setPage(w.attr("href"));return x.preventDefault()});if(u===0){v.addClass(m.activeClass)}q.append(v)}}else{var t=q.children();t.each(function(w){var x=b(this);x.attr("href",w);if(w===0){x.addClass(m.activeClass)}x.click(function(){q.find("."+m.activeClass).removeClass(m.activeClass);x.addClass(m.activeClass);s.setPage(x.attr("href"))})})}if(m.clickable){s.getItems().each(function(x,w){var y=b(this);if(!y.data("set")){y.bind("click.scrollable",function(){s.click(x)});y.data("set",true)}})}if(m.hoverClass){s.getItems().hover(function(){b(this).addClass(m.hoverClass)},function(){b(this).removeClass(m.hoverClass)})}return s}r();var e=null;function k(){if(e){return}e=setInterval(function(){if(m.interval===0){clearInterval(e);e=0;return}s.next()},m.interval)}if(m.interval>0){p.hover(function(){clearInterval(e);e=0},function(){k()});k()}}b.fn.scrollable=function(d){var e=this.eq(typeof d=="number"?d:0).data("scrollable");if(e){return e}var f={size:5,vertical:false,clickable:true,loop:false,interval:0,speed:400,keyboard:true,activeClass:"active",disabledClass:"disabled",hoverClass:null,easing:"swing",items:".items",prev:".prev",next:".next",prevPage:".prevPage",nextPage:".nextPage",navi:".navi",naviItem:"a",api:false,onBeforeSeek:null,onSeek:null};b.extend(f,d);this.each(function(){e=new a(b(this),f);b(this).data("scrollable",e)});return f.api?e:this}})(jQuery);if(jQuery)(function($){$.extend($.fn,{fileTree:function(o,h){if(!o)var o={};if(o.root==undefined)o.root='/';if(o.script==undefined)o.script='jqueryFileTree.php';if(o.folderEvent==undefined)o.folderEvent='click';if(o.expandSpeed==undefined)o.expandSpeed=500;if(o.collapseSpeed==undefined)o.collapseSpeed=500;if(o.expandEasing==undefined)o.expandEasing=null;if(o.collapseEasing==undefined)o.collapseEasing=null;if(o.multiFolder==undefined)o.multiFolder=true;if(o.loadMessage==undefined)o.loadMessage='Loading...';$(this).each(function(){function showTree(c,t){$(c).addClass('wait');$(".jqueryFileTree.start").remove();$.post(o.script,{dir:t},function(data){$(c).find('.start').html('');$(c).removeClass('wait').append(data);if(o.root==t)$(c).find('UL:hidden').show();else $(c).find('UL:hidden').slideDown({duration:o.expandSpeed,easing:o.expandEasing});bindTree(c);});}
function bindTree(t){$(t).find('LI A').bind(o.folderEvent,function(){if($(this).parent().hasClass('directory')){if($(this).parent().hasClass('collapsed')){if(!o.multiFolder){$(this).parent().parent().find('UL').slideUp({duration:o.collapseSpeed,easing:o.collapseEasing});$(this).parent().parent().find('LI.directory').removeClass('expanded').addClass('collapsed');}
$(this).parent().find('UL').remove();showTree($(this).parent(),$(this).attr('rel').match(/.*\//));$(this).parent().removeClass('collapsed').addClass('expanded');}else{$(this).parent().find('UL').slideUp({duration:o.collapseSpeed,easing:o.collapseEasing});$(this).parent().removeClass('expanded').addClass('collapsed');}
if(o.folderClick!=undefined)o.folderClick(this,$(this).attr('rel'));}else{h($(this).attr('rel'));}
return false;});if(o.folderEvent.toLowerCase!='click')$(t).find('LI A').bind('click',function(){return false;});}
$(this).html('<ul class="jqueryFileTree start"><li class="wait">'+o.loadMessage+'<li></ul>');showTree($(this),o.root);});}});})(jQuery);$.fn.insertAtCaret=function(myValue){return this.each(function(){if(document.selection){this.focus();sel=document.selection.createRange();sel.text=myValue;this.focus();}
else if(this.selectionStart||this.selectionStart=='0'){var startPos=this.selectionStart;var endPos=this.selectionEnd;var scrollTop=this.scrollTop;this.value=this.value.substring(0,startPos)+myValue+this.value.substring(endPos,this.value.length);this.focus();this.selectionStart=startPos+myValue.length;this.selectionEnd=startPos+myValue.length;this.scrollTop=scrollTop;}else{this.value+=myValue;this.focus();}});};if(!Array.prototype.map)
{Array.prototype.map=function(fun)
{"use strict";if(this===void 0||this===null)
throw new TypeError();var t=Object(this);var len=t.length>>>0;if(typeof fun!=="function")
throw new TypeError();var res=new Array(len);var thisp=arguments[1];for(var i=0;i<len;i++)
{if(i in t)
res[i]=fun.call(thisp,t[i],i,t);}
return res;};}
$.editable.addInputType('autocomplete',{element:$.editable.types.text.element,plugin:function(settings,original){$('input').focus(function(){this.select();});$('input',this).autocomplete(settings.autocomplete);}});var CDFDD=Base.extend({logger:"",dashboardData:{},dashboardWcdf:{},styles:[],renderers:[],layout:{},components:{},datasources:{},wizards:{},constructor:function(){this.logger=new Logger("CDFDD");this.logger.info("Initializing CDFDD");TableManager.globalInit();WizardManager.globalInit();},init:function(){this.logger.info("Initializing.");this.layout=new LayoutPanel(LayoutPanel.MAIN_PANEL);this.layout.init();this.components=new ComponentsPanel(ComponentsPanel.MAIN_PANEL);this.components.init();this.datasources=new DatasourcesPanel(DatasourcesPanel.MAIN_PANEL);this.datasources.init();this.wizard=new WizardManager();this.wizard.init();this.layout.switchTo();$(function(){$(document).keydown(function(e){if($(e.target).is('input, textarea')){return;}
else{}
if($(e.target).is('input, textarea')){switch(e.which){case 38:Dashboards.log("Go up");break;case 40:Dashboards.log("Go down");break;}}
switch(e.which){case 49:$(".cdfdd-modes").find("a:eq(0)").click();break;case 50:$(".cdfdd-modes").find("a:eq(1)").click();break;case 51:$(".cdfdd-modes").find("a:eq(2)").click();break;case 83:if(e.shiftKey){cdfdd.save();}
break;case 80:if(e.shiftKey){cdfdd.previewMode();}
break;case 71:if(e.shiftKey){cdfdd.cggDialog();}
break;case 191:if(e.shiftKey){cdfdd.toggleHelp();}
break;case 86:if(e.shiftKey){ComponentValidations.validateComponents();}
break;}});});var myself=this;$.getJSON("SyncStyles",{operation:"listStyles"},function(json){myself.styles=json.result;});$.getJSON("listRenderers",{operation:"listStyles"},function(json){myself.renderers=json.result;});},initStyles:function(callback){var myself=this;if(myself.styles.length>0){var wcdf=myself.getDashboardWcdf();var cleanStyle=myself.styles.indexOf('Clean');if(!wcdf.style){wcdf.style=myself.styles[cleanStyle>=0?cleanStyle:0];}
var saveSettingsParams={operation:"saveSettings",file:CDFDDFileName.replace(".cdfde",".wcdf"),style:wcdf.style};$.post(CDFDDDataUrl,saveSettingsParams,function(result){var json=eval("("+result+")");if(json.status=="true"){myself.setDashboardWcdf(wcdf);callback();}else{$.notifyBar({html:"Errors initializing settings: "+json.result});}});}},load:function(){this.logger.info("Loading dashboard...");var myself=this;var loadParams={operation:"load",file:CDFDDFileName};$.post(CDFDDDataUrl,loadParams,function(result){var json=eval("("+result+")");if(json.status=="true"){myself.setDashboardData(myself.unstrip(json.result.data));myself.setDashboardWcdf(json.result.wcdf);myself.init();}
else{alert(json.result);}});},save:function(){this.logger.info("Saving dashboard...");this.dashboardData.filename=CDFDDFileName;var saveParams={operation:"save",file:CDFDDFileName,cdfstructure:JSON.stringify(this.strip(this.dashboardData),"",1)};if(CDFDDFileName!="/null/null/null"){$.post(CDFDDDataUrl,saveParams,function(result){var json=eval("("+result+")");if(json.status=="true"){$.notifyBar({html:"Dashboard saved successfully",delay:1000});}
else{$.notifyBar({html:"Errors saving file: "+json.result});}});}
else{this.saveAs(false);}},strip:function(original){var strip={type:true,name:true,value:true,url:true};var o=Util.clone(original);$.each(o,function(i,t){if(typeof t!=="object"){return;}
$.each(t.rows,function(j,c){$.each(c.properties,function(k,properties){$.each(properties,function(p){if(!strip[p])
delete properties[p];});});});});return o;},unstrip:function(original){var strip={type:true,name:true,value:true,url:true};var myself=this;var o=Util.clone(original);$.each(o,function(i,t){if(typeof t!=="object"){return true;}
myself.logger.debug("  unstrip: "+i+", "+t);$.each(t.rows,function(j,c){myself.logger.debug("  unstrip component "+c.type+" property count: "+c.properties.length);$.each(c.properties,function(idx,p){try{var property=PropertiesManager.getPropertyType(p.name).stub;for(var attr in property)if(property.hasOwnProperty(attr)){if(!p.hasOwnProperty(attr)){p[attr]=property[attr];}}}catch(e){Dashboards.log(p.name+": "+e);}});});});return o;},toggleHelp:function(){$("#keyboard_shortcuts_help").toggle();},newDashboard:function(){var myself=this;$.prompt('Are you sure you want to start a new dashboard?<br/>Unsaved changes will be lost.',{buttons:{Ok:true,Cancel:false},callback:function(v,m,f){if(v)myself.saveAs(true);}});},saveAs:function(fromScratch){var selectedFolder="";var selectedFile="";var selectedTitle=this.getDashboardWcdf().title;var selectedDescription=this.getDashboardWcdf().description;var myself=this;var content='<div class="saveaslabel">Save as:</div>\n'+'        <div id="container_id" class="folderexplorer" width="400px"></div>\n'+'         <span class="folderexplorerfilelabel">File Name:</span>\n'+'         <span class="folderexplorerfileinput"><input id="fileInput"  type="text"></input></span>\n'+'        <hr class="filexplorerhr"/>\n'+'        <span class="folderexplorerextralabel" >Extra Information:</span><br/>\n'+'         <span class="folderexplorerextralabels" >Title:</span><input id="titleInput" class="folderexplorertitleinput" type="text" value="'+selectedTitle+'"></input>\n'+'         <br/><span class="folderexplorerextralabels" >Description:</span><input id="descriptionInput"  class="folderexplorerdescinput" type="text" value="'+selectedDescription+'"></input>';$.prompt(content,{loaded:function(){$('#fileInput').change(function(){selectedFile=this.value;});$('#titleInput').change(function(){selectedTitle=this.value;});$('#descriptionInput').change(function(){selectedDescription=this.value;});$('#container_id').fileTree({root:'/',script:CDFDDDataUrl.replace("Syncronize","ExploreFolder?fileExtensions=.wcdf&access=create"),expandSpeed:1000,collapseSpeed:1000,multiFolder:false,folderClick:function(obj,folder){if($(".selectedFolder").length>0)$(".selectedFolder").attr("class","");$(obj).attr("class","selectedFolder");selectedFolder=folder;$("#fileInput").val("");}},function(file){$("#fileInput").val(file.replace(selectedFolder,""));selectedFile=$("#fileInput").val();});},buttons:{Ok:true,Cancel:false},opacity:0.2,prefix:'treeTableNewJqi',callback:function(v,m,f){if(v){if(selectedFile.indexOf(".")!=-1&&(selectedFile.length<5||selectedFile.lastIndexOf(".wcdf")!=selectedFile.length-5))
$.prompt('Invalid file extension. Must be .wcdf');else if(selectedFolder.length==0)
$.prompt('Please choose destination folder.');else if(selectedFile.length==0)
$.prompt('Please enter the file name.');else if(selectedFile.length>0){if(selectedFile.indexOf(".wcdf")==-1)selectedFile+=".wcdf";CDFDDFileName=selectedFolder+selectedFile;myself.dashboardData.filename=CDFDDFileName;var saveAsParams={operation:fromScratch?"newFile":"saveas",file:selectedFolder+selectedFile,title:selectedTitle,description:selectedDescription,cdfstructure:JSON.stringify(myself.dashboardData,"",2)};$.post(CDFDDDataUrl,saveAsParams,function(result){var json=eval("("+result+")");if(json.status=="true"){if(selectedFolder[0]=="/")selectedFolder=selectedFolder.substring(1,selectedFolder.length);var solutionPath=selectedFolder.split("/");myself.initStyles(function(){window.location='../pentaho-cdf-dd/Edit?solution='+solutionPath[0]+"&path="+solutionPath.slice(1).join("/")+"&file="+selectedFile;});}
else
$.notifyBar({html:"Errors saving file: "+json.result});});}}}});},previewMode:function(){if(CDFDDFileName=="/null/null/null"){$.notifyBar({html:"Need to save an initial dashboard before previews are available."});return;}
var fullPath=CDFDDFileName.split("/");var solution=fullPath[1];var path=fullPath.slice(2,fullPath.length-1).join("/");var file=fullPath[fullPath.length-1].replace(".cdfde","_tmp.cdfde");;var style=this.getDashboardWcdf().style;this.logger.info("Saving temporary dashboard...");var tmpFileName=CDFDDFileName.replace(".cdfde","_tmp.cdfde");this.dashboardData.filename=tmpFileName;var serializedDashboard=JSON.stringify(this.dashboardData,"",2);this.dashboardData.filename=CDFDDFileName;var saveParams={operation:"save",file:tmpFileName,cdfstructure:serializedDashboard};$.post(CDFDDDataUrl,saveParams,function(result){var json=eval("("+result+")");if(json.status=="true"){var _href=CDFDDDataUrl.replace("Syncronize","Render?")+"solution="+solution+"&path=/"+path+"&file="+file+"&style="+style+"&cache=false";$.fancybox({type:"iframe",href:_href,width:$(window).width(),height:$(window).height()});}
else{$.notifyBar({html:"Errors saving file: "+json.result});}});},reload:function(){this.logger.warn("Reloading dashboard... ");$.prompt('Are you sure you want to reload? Unsaved changes will be lost.',{buttons:{Ok:true,Cancel:false},callback:function(v,m,f){if(v)window.location.reload();}});},reset:function(){this.logger.info("Resetting dashboad");CDFDD.PANELS().empty();},saveSettings:function(){var myself=this;var ready=true;function sCallback(){if(myself.styles.length>0&&myself.renderers.length>0){myself.saveSettingsCallback();}}
if(this.styles.length==0){ready=false;$.getJSON("SyncStyles",{operation:"listStyles"},function(json){myself.styles=json.result;sCallback();});};if(this.renderers.length==0){ready=false;$.getJSON("listRenderers",{},function(json){myself.renderers=json.result;sCallback();});};if(ready){this.saveSettingsCallback();}},saveSettingsCallback:function(){var title=this.getDashboardWcdf().title;var description=this.getDashboardWcdf().description;var author=this.getDashboardWcdf().author;var style=this.getDashboardWcdf().style;var rendererType=this.getDashboardWcdf().rendererType;var myself=this;var content='\n'+'    <span><b>Settings:</b></span><br/><hr/>\n'+'    <span>Title:</span><br/><input class="cdf_settings_input" id="titleInput" type="text" value="'+title+'"></input><br/>\n'+'    <span>Author:</span><br/><input class="cdf_settings_input" id="authorInput" type="text" value="'+author+'"></input>\n'+'    <span>Description:</span><br/><textarea class="cdf_settings_textarea" id="descriptionInput">'+description+'</textarea>\n'+'    <span>Style:</span><br/><select class="cdf_settings_input" id="styleInput">';$.each(this.styles,function(i,obj){content+=('<option value="'+obj+'" '+(style==obj?'selected':'')+' >'+obj+'</option>');});content+='</select><span>Dashboard Type:</span><br/><select class="cdf_settings_input" id="rendererInput">';$.each(this.renderers,function(i,obj){content+=('<option value="'+obj+'" '+(rendererType==obj?'selected':'')+' >'+obj+'</option>');});content+='</select>';$.prompt(content,{buttons:{Save:true,Cancel:false},submit:function(){title=$("#titleInput").val();author=$("#authorInput").val();description=$("#descriptionInput").val();style=$("#styleInput").val();rendererType=$("#rendererInput").val();},callback:function(v,m,f){if(v){myself.logger.info("Saving dashboard settings...");var saveSettingsParams={operation:"saveSettings",file:CDFDDFileName.replace(".cdfde",".wcdf"),title:title,author:author,description:description,style:style,rendererType:rendererType};$.post(CDFDDDataUrl,saveSettingsParams,function(result){var json=eval("("+result+")");if(json.status=="true"){myself.setDashboardWcdf({title:title,author:author,description:description,style:style,rendererType:rendererType});cdfdd.layout.init();$.notifyBar({html:"Dashboard Settings saved successfully",delay:1000});}
else
$.notifyBar({html:"Errors saving settings: "+json.result});});}}});},setDashboardData:function(dashboardData){this.dashboardData=dashboardData;},getDashboardData:function(){return this.dashboardData;},setDashboardWcdf:function(dashboardWcdf){this.dashboardWcdf=dashboardWcdf;},getDashboardWcdf:function(){return this.dashboardWcdf;},cggDialog:function(){var components=cdfdd.dashboardData.components.rows;var cggCandidates=components.filter(function(e){return e.meta_cdwSupport=='true';});var ph=$('#cggDialog');ph=ph.length>0?ph:$("<div id='cggDialog' style='display:none'></div>").appendTo($("body")).jqm();ph.empty();ph.append("<h3>Choose what charts to render as CGG");cggCandidates.map(function(e){var checkbox=$("<input type='checkbox'>");checkbox[0].checked=(e.meta_cdwRender=='true'||false);checkbox.change(function(){e.meta_cdwRender=""+this.checked;});var name='',title='';e.properties.map(function(p){if(p.name=='title'){title=p.value;}else if(p.name=='name'){name=p.value;}});var label="<span>"+(title!==''?title:name)+"</span>";ph.append(checkbox);ph.append(label+"<br>");ph.jqmShow();});}},{LAYOUT:function(){return $("table#layout-div tbody");},PANELS:function(){return $("#cdfdd-panels");}});var Panel=Base.extend({id:"",name:"",logger:{},constructor:function(id){this.logger=new Logger("Panel");this.id=id;},init:function(){this.logger.info("Initializing panel "+name);if($("#panel-"+this.id).length==0){CDFDD.PANELS().append(this.getHtml());}},switchTo:function(){this.logger.debug("Switching to "+this.name);$("div."+Panel.GUID).hide();$("div#panel-"+this.id).show();},reset:function(){$("#"+id).empty();},getHtml:function(){return'\n'+'   <div id="panel-'+this.id+'" class="span-24 last '+Panel.GUID+'">\n'+'   <div class="panel-content">'+this.getContent()+'</div> \n'+'   </div>';},getContent:function(){return'<span class="highlight">Not done yet</span>';},setId:function(id){this.id=id;},getId:function(){return this.id;}},{GUID:"cdfdd-panel",panels:{},register:function(panel){Panel.panels[panel.getId()]=panel;},getPanel:function(id){return Panel.panels[id];},getRowPropertyValue:function(row,propertyName){var output="";$.each(row.properties,function(i,property){if(property.name==propertyName){output=property.value;return false;}});return output;},enableThisButton:function(doc){var a=$(doc);var myIdx=a.prevAll("a").length;a.parent().find("img").each(function(i,x){if(i==myIdx){Panel.unsetHover(x);$(x).attr("src",$(x).attr("src").replace(/(.*)\/X?(.*)/,"$1/$2"));}else{$(x).attr("src",$(x).attr("src").replace(/(.*)\/X?(.*)/,"$1/X$2"));}});},disableThisButton:function(doc){var a=$(doc);var myIdx=a.prevAll("a").length;a.parent().find("img").each(function(i,x){if(i==myIdx){$(x).attr("src",$(x).attr("src").replace(/(.*)\/X?(.*)/,"$1/X$2"));}});},setHover:function(comp){var el=$(comp);var src=el.attr("src");var xPos=src.search("/X");if(xPos!=-1){src=src.slice(0,xPos)+"/"+src.slice(xPos+2);el.attr("src",src.slice(0,src.length-".png".length)+"_mouseover.png");}},unsetHover:function(comp){var el=$(comp);var src=el.attr("src");var hPos=src.search("_mouseover");if(hPos!=-1){src=src.replace(/(.*)\/X?(.*)/,"$1/X$2");el.attr("src",src.slice(0,src.length-"_mouseover.png".length)+".png");}}});var Logger=Base.extend({ERROR:0,WARN:1,INFO:2,DEBUG:3,name:"",logDescription:["ERROR","WARN","INFO","DEBUG"],constructor:function(name){this.name=name;},log:function(level,str){if(cdfddLogEnabled&&level<=cdfddLogLevel&&typeof console!='undefined'){console.log(" - ["+this.name+"] "+this.logDescription[level]+": "+str);}},error:function(str){this.log(this.ERROR,str);},warn:function(str){this.log(this.WARN,str);},info:function(str){this.log(this.INFO,str);},debug:function(str){this.log(this.DEBUG,str);}});var CDFDDUtils=Base.extend({},{ev:function(v){return(typeof v=='function'?v():v);},getProperty:function(stub,name){var result;if(typeof stub.properties=='undefined'){return null;}
$.each(stub.properties,function(i,p){if(p.name==name){result=p;return false;}});return result;}});var cdfdd;$(function(){cdfdd=new CDFDD();cdfdd.load();$.editable.types.selectMulti={element:function(settings,original){var select=$('<select multiple="multiple" />');$(this).append(select);return(select);},content:function(data,settings,original){if(String==data.constructor){eval('var json = '+data);}else{var json=data;}
for(var key in json){if(!json.hasOwnProperty(key)){continue;}
if('selected'==key){continue;}
var option=$('<option />').val(key).append(json[key]);$('select',this).append(option);}
var _selectedHash={};var _selectedArray=json['selected'];$.each(_selectedArray,function(i,val){_selectedHash[val]=true});$('select',this).children().each(function(){if(_selectedHash[$(this).val()]||$(this).text()==$.trim(original.revert)){$(this).attr('selected','selected');}});$('select',this).multiSelect({oneOrMoreSelected:"*"},function(){});}};$.extend($.fn,{multiSelectOptionsShow:function(){$('.multiSelect').multiSelectOptionsHide();var t=$(this);var ph=t.next('.multiSelectOptions');ph.find('LABEL').removeClass('hover');t.addClass('active').next('.multiSelectOptions').show();var offset=[]
ph.css({top:offset.top+t.outerHeight()+'px'}).css({left:offset.left+'px'});var timer='';ph.unbind("mouseenter mouseleave").mouseenter(function(){Dashboards.log("enter");clearTimeout(timer);}).mouseleave(function(){Dashboards.log("leave");timer=setTimeout(function(){t.multiSelectOptionsHide();ph.unbind("mouseenter mouseleave");},250);});}})});cdfddLogEnabled=true;cdfddLogLevel=3;$.fn.editable.defaults.placeholder=' - ';var IndexManager=Base.extend({id:"",logger:{},index:{},constructor:function(tableModel){this.logger=new Logger("IndexManager");this.setTableModel(tableModel);},updateIndex:function(){var data=this.getTableModel().getData();var idx={};var index=0;var root={};root.id=IndexManager.ROOTID;root.parent=null;root.children=[];root.type=_type;root.index=index;idx[IndexManager.ROOTID]=root;for(var rowIndex in data){var row=data[rowIndex];var _id=this.getTableModel().getEvaluatedId(rowIndex);var _parent;if(typeof this.getTableModel().getParentId()=='undefined'){_parent=IndexManager.ROOTID;}
else{_parent=this.getTableModel().getParentId()(row);if(typeof _parent=='undefined'){_parent=IndexManager.ROOTID;}}
var _type=this.getTableModel().getRowType()(row);var entry={};entry.id=_id;entry.parent=_parent;entry.children=[];entry.type=_type;entry.index=index;idx[_id]=entry;idx[_parent].children.push(entry);index++;};this.setIndex(idx);},isFirstChild:function(rowId){return this.getIndex()[this.getIndex()[rowId].parent].children[0].id===rowId;},isLastChild:function(rowId){var _brothers=this.getBrothers(rowId);return _brothers[_brothers.length-1].id===rowId;},getBrothers:function(rowId){return this.getIndex()[this.getIndex()[rowId].parent].children;},getChildIndex:function(rowId){var brothers=this.getBrothers(rowId);var idx=-1;$.each(brothers,function(i,brother){if(brothers[i].id===rowId){idx=i;return false;}});return idx;},getLastChild:function(rowId){var _children=this.getIndex()[rowId].children;var _length=_children.length;if(_length==0){return this.getIndex()[rowId];}
else{return this.getLastChild(_children[_length-1].id);}},getPreviousSibling:function(rowId){return this.getBrothers(rowId)[this.getChildIndex(rowId)-1];},getNextSibling:function(rowId){return this.getBrothers(rowId)[this.getChildIndex(rowId)+1];},setIndex:function(index){this.index=index},getIndex:function(){return this.index},setTableModel:function(tableModel){this.tableModel=tableModel;this.updateIndex()},getTableModel:function(){return this.tableModel}},{ROOTID:"UnIqEiD"});var PropertiesManager=Base.extend({},{propertyTypes:{},register:function(propertyType){PropertiesManager.propertyTypes[propertyType.getType()]=propertyType;},getPropertyType:function(propertyType){return PropertiesManager.propertyTypes[propertyType];},getProperty:function(type,options){return PropertiesManager.getPropertyType(type).getPropertyObject(options);}});var BasePropertyType=Base.extend({type:"",logger:{},stub:{},constructor:function(){this.logger=new Logger("BasePropertyType");},getPropertyObject:function(options){return $.extend({},this.stub,options);},setType:function(type){this.type=type},getType:function(){return this.type}});var BaseModel=Base.extend({},{MODEL:'BaseModel',getStub:function(){return{}},models:{},registerModel:function(_class){this.models[_class.MODEL]=_class;},getModel:function(_model){return this.models[_model];}});var CellOperations=Base.extend({logger:{},constructor:function(){this.logger=new Logger("BaseType");}},{operations:[],registerOperation:function(operation){this.operations.push(operation);},getOperationsByType:function(type){var _operations=[];$.each(CellOperations.operations,function(i,value){for(var i in value.types){if(type.match("^"+value.types[i])){_operations.push(value);}}});return _operations;}});var BaseOperation=Base.extend({id:"BASE_OPERATION",types:["TYPE"],name:"Base operation",description:"Base Operation description",icon:"/pentaho/content/pentaho-cdf-dd/getResource?resource=/images/toolbar-folder-add-48x48.png",order:20,logger:{},hoverIcon:null,clickIcon:null,showInactiveIcon:false,execute:function(tableManager){this.logger.error("Method not implemented; "+tableManager.getTableId()+"; "+tableManager.getSelectedCell());},canExecute:function(tableModel){return true;},constructor:function(){this.logger=new Logger("BaseOperation");},getHtml:function(tableManager,idx){var code='';var tableManagerId=tableManager.getTableId();if(this.canExecute(tableManager)){var mouseHoverCmd='';if(this.hoverIcon){mouseHoverCmd='onmouseover="$(this).attr(\'src\',\''+this.hoverIcon+'\')" onmouseout="$(this).attr(\'src\',\''+this.getIcon()+'\')"';}
var mouseClickCmd='';if(this.clickIcon){mouseClickCmd='onmousedown="$(this).attr(\'src\',\''+this.clickIcon+'\')" onmouseup="$(this).attr(\'src\',\''+this.getIcon()+'\')"';}
code='\n'+'    <a class="tooltip" title="'+this.getName()+'"  href="javascript:TableManager.executeOperation(\''+tableManagerId+'\','+idx+');">\n'+'    <img border="0" src="'+this.getIcon()+'" class="cdfdd"'+mouseHoverCmd+' '+mouseClickCmd+' ></img>\n'+'    </a>\n'+'    ';}
else if(this.showInactiveIcon){var _icon=this.getIcon().replace(/(.*)\//,"$1/X");code='\n'+'    <img border="0" alt="'+this.getName()+'" src="'+_icon+'" class="cdfdd"></img>\n'+'    ';}
return code;},getId:function(){return this.id},setId:function(id){this.id=id},getName:function(){return this.name},setName:function(name){this.name=name},getDescription:function(){return this.description},setDescription:function(description){this.description=description},getIcon:function(){return this.icon},setIcon:function(icon){this.icon=icon}});var AddRowOperation=BaseOperation.extend({id:"ADD_ROW",types:["GenericRow"],name:"New Row",description:"Adds a new row to the layout on the specific position",icon:"/pentaho/content/pentaho-cdf-dd/getResource?resource=/images/NAV/addrow.png",constructor:function(){this.logger=new Logger("AddRowOperation");}});CellOperations.registerOperation(new AddRowOperation());var MoveUpOperation=BaseOperation.extend({id:"MOVE_UP",types:["GenericMoveUp"],name:"Move Up",description:"Move up",icon:"/pentaho/content/pentaho-cdf-dd/getResource?resource=/images/NAV/up.png",hoverIcon:"/pentaho/content/pentaho-cdf-dd/getResource?resource=/images/NAV/up_mouseover.png",clickIcon:"/pentaho/content/pentaho-cdf-dd/getResource?resource=/images/NAV/up_onclick.png",constructor:function(){this.logger=new Logger("MoveUpOperation");},canExecute:function(tableManager){var rowIdx=tableManager.getSelectedCell()[0];var rowId=tableManager.getTableModel().getEvaluatedId(rowIdx);return!tableManager.getTableModel().getIndexManager().isFirstChild(rowId);},execute:function(tableManager){var rowIdx=tableManager.getSelectedCell()[0];var colIdx=tableManager.getSelectedCell()[1];var rowId=tableManager.getTableModel().getEvaluatedId(rowIdx);var fromIdx=rowIdx;var toIdx=-1;var nextSibling=tableManager.getTableModel().getIndexManager().getNextSibling(rowId);if(typeof nextSibling=='undefined'){toIdx=tableManager.getTableModel().getIndexManager().getLastChild(rowId).index;}
else{toIdx=nextSibling.index-1;}
var targetIdx=tableManager.getTableModel().getIndexManager().getPreviousSibling(rowId).index;this.logger.debug("Moving nodes from "+fromIdx+" to "+toIdx+" to the place of "+targetIdx);var _data=tableManager.getTableModel().getData();var _tmp=_data.splice(fromIdx,toIdx-fromIdx+1);_data.splice(targetIdx,0)
Array().splice.apply(_data,[targetIdx,0].concat(_tmp));tableManager.getTableModel().setData(_data);for(var i=0;i<=toIdx-fromIdx;i++){$('#'+tableManager.getTableId()+" > tbody > tr:eq("+(targetIdx+i)+")").before($('#'+tableManager.getTableId()+" > tbody > tr:eq("+(fromIdx+i)+")"));}
tableManager.setSelectedCell([targetIdx,colIdx]);tableManager.updateOperations();var a=[];$.each(_data,function(i,row){a.push(row.id);})
this.logger.debug("Result: "+a.join(', '));}});CellOperations.registerOperation(new MoveUpOperation());var MoveDownOperation=BaseOperation.extend({id:"MOVE_DOWN",types:["GenericMoveDown"],name:"Move Down",description:"Move down",icon:"/pentaho/content/pentaho-cdf-dd/getResource?resource=/images/NAV/down.png",hoverIcon:"/pentaho/content/pentaho-cdf-dd/getResource?resource=/images/NAV/down_mouseover.png",clickIcon:"/pentaho/content/pentaho-cdf-dd/getResource?resource=/images/NAV/down_onclick.png",constructor:function(){this.logger=new Logger("MoveDownOperation");},canExecute:function(tableManager){var rowIdx=tableManager.getSelectedCell()[0];var rowId=tableManager.getTableModel().getEvaluatedId(rowIdx);return!tableManager.getTableModel().getIndexManager().isLastChild(rowId);},execute:function(tableManager){var rowIdx=tableManager.getSelectedCell()[0];var colIdx=tableManager.getSelectedCell()[1];var rowId=tableManager.getTableModel().getEvaluatedId(rowIdx);var fromIdx=rowIdx;var toIdx=-1;var indexManager=tableManager.getTableModel().getIndexManager();var nextSibling=indexManager.getNextSibling(rowId);if(typeof nextSibling=='undefined'){toIdx=indexManager.getLastChild(rowId).index;}
else{toIdx=nextSibling.index-1;}
var targetIdx=indexManager.getLastChild(indexManager.getNextSibling(rowId).id).index;this.logger.debug("Moving nodes from "+fromIdx+" to "+toIdx+" to the place of "+targetIdx);var _data=tableManager.getTableModel().getData();var _tmp=_data.splice(fromIdx,toIdx-fromIdx+1);Array().splice.apply(_data,[targetIdx-toIdx+fromIdx,0].concat(_tmp));tableManager.getTableModel().setData(_data);for(var i=0;i<=toIdx-fromIdx;i++){$('#'+tableManager.getTableId()+" > tbody > tr:eq("+(targetIdx)+")").after($('#'+tableManager.getTableId()+" > tbody > tr:eq("+(fromIdx)+")"));}
tableManager.setSelectedCell([targetIdx-toIdx+fromIdx,colIdx]);tableManager.updateOperations();var a=[];$.each(_data,function(i,row){a.push(row.id);})
this.logger.debug("Result: "+a.join(', '));}});CellOperations.registerOperation(new MoveDownOperation());var DeleteOperation=BaseOperation.extend({id:"Delete",types:["GenericDelete"],name:"Delete",description:"Delete",icon:"/pentaho/content/pentaho-cdf-dd/getResource?resource=/images/NAV/remove.png",hoverIcon:"/pentaho/content/pentaho-cdf-dd/getResource?resource=/images/NAV/remove_mouseover.png",clickIcon:"/pentaho/content/pentaho-cdf-dd/getResource?resource=/images/NAV/remove_onclick.png",constructor:function(){this.logger=new Logger("DeleteOperation");},execute:function(tableManager){var rowIdx=tableManager.getSelectedCell()[0];var colIdx=tableManager.getSelectedCell()[1];var rowId=tableManager.getTableModel().getEvaluatedId(rowIdx);var fromIdx=rowIdx;var toIdx=-1;var indexManager=tableManager.getTableModel().getIndexManager();var nextSibling=indexManager.getNextSibling(rowId);if(typeof nextSibling=='undefined'){toIdx=indexManager.getLastChild(rowId).index;}
else{toIdx=nextSibling.index-1;}
var _parentId=indexManager.getIndex()[rowId].parent;var deleteParent=tableManager.id!=LayoutPanel.TREE&&_parentId!=IndexManager.ROOTID&&indexManager.isFirstChild(rowId)&&indexManager.isLastChild(rowId);if(deleteParent){fromIdx=indexManager.getIndex()[_parentId].index;_parentId=indexManager.getIndex()[_parentId].parent;}
this.logger.debug("Deleting nodes from "+fromIdx+" to "+toIdx);tableManager.getTableModel().getData().splice(fromIdx,toIdx-fromIdx+1);indexManager.updateIndex();for(var i=0;i<=toIdx-fromIdx;i++){$('#'+tableManager.getTableId()+" > tbody > tr:eq("+(fromIdx)+")").remove();}
tableManager.cellUnselected();var a=[];$.each(tableManager.getTableModel().getData(),function(i,row){a.push(row.id);})
this.logger.debug("Result: "+a.join(', '));tableManager.updateTreeTable(_parentId);}});CellOperations.registerOperation(new DeleteOperation());var ApplyTemplateOperation=BaseOperation.extend({id:"APPLY_TEMPLATE",types:["GenericApplyTemplate"],name:"Apply Template",description:"Applys a template.",icon:"/pentaho/content/pentaho-cdf-dd/getResource?resource=/images/NAV/loadtemp.png",hoverIcon:"/pentaho/content/pentaho-cdf-dd/getResource?resource=/images/NAV/loadtemp_mouseover.png",clickIcon:"/pentaho/content/pentaho-cdf-dd/getResource?resource=/images/NAV/loadtemp_onclick.png",constructor:function(){this.logger=new Logger("ApplyTemplateOperation");}});CellOperations.registerOperation(new ApplyTemplateOperation());var SaveAsTemplateOperation=BaseOperation.extend({id:"SAVEAS_TEMPLATE",types:["GenericSaveAsTemplate"],name:"Save as Template",description:"Save sa template.",icon:"/pentaho/content/pentaho-cdf-dd/getResource?resource=/images/NAV/savetemp.png",hoverIcon:"/pentaho/content/pentaho-cdf-dd/getResource?resource=/images/NAV/savetemp_mouseover.png",clickIcon:"/pentaho/content/pentaho-cdf-dd/getResource?resource=/images/NAV/savetemp_onclick.png",constructor:function(){this.logger=new Logger("SaveAsTemplateOperation");}});CellOperations.registerOperation(new SaveAsTemplateOperation());var TableManager=Base.extend({id:"",tableId:"",logger:{},title:"Title",tableModel:{},initialOperations:[],isSelectedCell:false,hasAdvancedProperties:false,selectedCell:[],operations:[],linkedTableManager:undefined,linkedTableManagerOperation:undefined,parentTableManager:undefined,cellRendererPool:{},constructor:function(id){this.logger=new Logger("TableManager - "+id);this.id=id;this.tableId="table-"+id;TableManager.register(this);},init:function(){this.reset();$("#"+this.id).append(this.newTable());this.render();},reset:function(){$("#"+this.id).empty();},render:function(){this.logger.debug("Rendering table "+this.getTableId());var headerRows=$("<tr></tr>");var myself=this;$.each(myself.getTableModel().getColumnNames(),function(i,val){var _header=$("<th class=\"ui-state-default\">"+val+"</th>");if(typeof myself.getTableModel().getColumnSizes()!='undefined'){_header.attr('width',myself.getTableModel().getColumnSizes()[i]);}
_header.appendTo(headerRows);});headerRows.appendTo("#"+this.getTableId()+" > thead");var myself=this;var data=this.getTableModel().getData()||[];$.each(data,function(i,row){myself.addRow(row);});$("#"+this.getTableId()).treeTable();this.updateOperations();},newTable:function(args){var isLayoutTable=this.tableId=='table-cdfdd-layout-tree';isLayoutTable=false;var table=''+'<table id="'+this.tableId+'" class="myTreeTable cdfdd ui-reset ui-clearfix ui-component ui-hover-state">\n'+'   <caption class="ui-state-default"><div class="simpleProperties propertiesSelected">'+this.title+'</div>'+
(!isLayoutTable?('<div id="'+this.tableId+'Operations" style="float: right" class="cdfdd-operations"></div>'):'')+
(this.hasAdvancedProperties==true?'<span style="float:left">&nbsp;&nbsp;/&nbsp;&nbsp;</span><div class="advancedProperties propertiesUnSelected">Advanced Properties</div>':'')+'</caption>\n'+'   <thead>\n'+'   </thead>\n'+'   <tbody class="ui-widget-content">\n'+'   </tbody>\n'+'   </table>\n'+'   ';return table;},addRow:function(row,pos){var _model=BaseModel.getModel(row.type);if(typeof _model!='undefined')
this.extendProperties(row,_model.getStub());var rowObj=$('<tr></tr>');var _id;try{_id=this.getTableModel().getRowId()(row);rowObj.attr("id",_id);}
catch(e){this.logger.error("Error evaluating id expression "+this.getTableModel().getRowId()+": "+e);}
var _parent;var _parentExpression=this.getTableModel().getParentId();try{if(typeof _parentExpression!='undefined'){_parent=_parentExpression(row);if(typeof _parent!='undefined'&&_parent!=IndexManager.ROOTID){rowObj.addClass("child-of-"+_parent);}}}
catch(e){this.logger.error("Error evaluating parent expression "+_parentExpression+": "+e);}
for(var i in this.getTableModel().getColumnGetExpressions()){this.renderColumn(rowObj,row,i);}
var selector="table.#"+this.getTableId()+" tbody";if(pos<0){rowObj.appendTo($(selector));$(selector).append(html);}
else{var _selector=$(selector+" > tr:eq("+pos+")");_selector.length==1?_selector.before(rowObj):rowObj.appendTo($(selector));}
return _id;},renderColumn:function(tr,row,colIdx){var renderer;var tm=this.getTableModel();var ct=tm.getColumnTypes()[colIdx];var _type=typeof ct=='function'?ct(row):ct;if(!(typeof tm.getEditable()=='undefined'?false:tm.getEditable()[colIdx])){_type="Label";}
var _setExpression=tm.getColumnSetExpressions()[colIdx];if(typeof this.cellRendererPool[_type]=='undefined'){try{eval('renderer = new '+_type+"Renderer(this)");this.cellRendererPool[_type]=renderer;}catch(e){this.logger.warn("Error creating renderer: "+e);renderer=new CellRenderer(this);}}
else{renderer=this.cellRendererPool[_type];}
var myself=this;return renderer.render(tr,tm.getColumnGetExpressions()[colIdx](row),function(value){_setExpression.apply(myself,[row,value]);tr.find("td:eq("+colIdx+")").remove();myself.renderColumn(tr,row,colIdx);});},renderColumnByRow:function(row,colIdx){if(typeof colIdx=="undefined")
colIdx=1;var rowIdx=this.getTableModel().getRowIndexByName(row.name);var tr=$("#"+this.getId()).find("tbody > tr:eq("+rowIdx+")");tr.find("td:eq(1)").remove();this.renderColumn(tr,row,colIdx);},updateTreeTable:function(rowId){if(rowId!=IndexManager.ROOTID){var _parentQ=$('#'+this.getTableId()+" > tbody > tr#"+rowId);_parentQ.removeClass("initialized");_parentQ.removeClass("parent");$("> td > span.expander",_parentQ).remove();_parentQ.initializeTreeTableNode();_parentQ.expand();}},insertAtIdx:function(_stub,insertAtIdx){this.getTableModel().getData().splice(insertAtIdx,0,_stub);this.getTableModel().getIndexManager().updateIndex();var newId=this.addRow(_stub,insertAtIdx);this.updateTreeTable(_stub.parent);this.selectCell(insertAtIdx,1,'simple');},createOrGetParent:function(category,categoryDesc){var indexManager=this.getTableModel().getIndexManager();var cat=indexManager.getIndex()[category];if(typeof cat=='undefined'){var _stub={id:category,name:categoryDesc,type:"Label",typeDesc:"<i>Group</i>",parent:IndexManager.ROOTID,properties:[{name:"Group",description:"Group",value:categoryDesc,type:"Label"}]};insertAtIdx=this.getTableModel().getData().length;this.insertAtIdx(_stub,insertAtIdx);return insertAtIdx+1;}
else{return cat.index+cat.children.length+1;}},updateOperations:function(){this.setOperations(this.getInitialOperations());if(this.isSelectedCell)
var _ops=CellOperations.getOperationsByType(this.getTableModel().getEvaluatedRowType(this.selectedCell[0]));this.setOperations(this.getOperations().concat(_ops));this.logger.debug("Found "+this.getOperations().length+" operations for this cell");var _opsNode=$("#"+this.getTableId()+"Operations");_opsNode.empty();var myself=this;$.each(this.getOperations(),function(i,_operation){if(typeof _operation!='undefined')
_opsNode.append(_operation.getHtml(myself,i));});},cellClick:function(row,col,classType){if(typeof this.getLinkedTableManager()!='undefined')
this.getLinkedTableManager().cellUnselected();this.isSelectedCell=true;this.selectedCell=[row,col];this.updateOperations();this.fireDependencies(row,col,classType);},cellUnselected:function(){this.isSelectedCell=false;this.cleanSelections();this.updateOperations();this.cleanDependencies();if(typeof this.getLinkedTableManager()!='undefined')
this.getLinkedTableManager().cellUnselected();},selectCell:function(row,col,classType){this.cleanSelections();$('#'+this.getTableId()+" > tbody > tr:eq("+row+")").addClass("ui-state-active");this.cellClick(row,col,classType);},cleanSelections:function(){$('#'+this.getTableId()).find("tr.ui-state-active").removeClass("ui-state-active");},fireDependencies:function(row,col,classType){if(typeof this.getLinkedTableManager()!='undefined'){var data=this.getLinkedTableManagerOperation()(this.getTableModel().getData()[row],classType);var tableManager=this.getLinkedTableManager();tableManager.getTableModel().setData(data);tableManager.cleanSelections();tableManager.init();}},cleanDependencies:function(){if(typeof this.getLinkedTableManager()!='undefined'){var tableManager=this.getLinkedTableManager();tableManager.getTableModel().setData([]);tableManager.cleanSelections();tableManager.init();}},extendProperties:function(row,stub){var pRow={};$.each(row.properties,function(i,p){pRow[p.name]=p;});$.each(stub.properties,function(i,s){if(typeof pRow[s.name]=='undefined')
row.properties.push(s);});},setId:function(id){this.id=id;},getId:function(){return this.id;},setTitle:function(title){this.title=title;},getTitle:function(){return this.title;},setTableId:function(tableId){this.tableId=tableId;},getTableId:function(){return this.tableId;},setTableModel:function(tableModel){this.tableModel=tableModel;},getTableModel:function(){return this.tableModel;},setInitialOperations:function(initialOperations){this.initialOperations=initialOperations;},getInitialOperations:function(){return this.initialOperations;},setOperations:function(operations){this.operations=operations;},getOperations:function(){return this.operations;},setSelectedCell:function(selectedCell){this.selectedCell=selectedCell;},getSelectedCell:function(){return this.selectedCell;},setLinkedTableManager:function(linkedTableManager){this.linkedTableManager=linkedTableManager;linkedTableManager.parentTableManager=this;},getLinkedTableManager:function(){return this.linkedTableManager;},setLinkedTableManagerOperation:function(linkedTableManagerOperation){this.linkedTableManagerOperation=linkedTableManagerOperation;},getLinkedTableManagerOperation:function(){return this.linkedTableManagerOperation;}},{tableManagers:{},register:function(tableManager){TableManager.tableManagers[tableManager.getTableId()]=tableManager;},getTableManager:function(id){return TableManager.tableManagers[id];},executeOperation:function(tableManagerId,idx){var tableManager=TableManager.getTableManager(tableManagerId);tableManager.getOperations()[idx].execute(tableManager);},globalInit:function(){$("table.myTreeTable tbody tr td").live("mousedown",function(){var myself=$(this);var row=myself.parent().prevAll().length;var col=myself.prevAll().length;var wasSelected=myself.hasClass("selected");var _tableManager=TableManager.getTableManager(myself.closest("table").attr("id"));if(!wasSelected){_tableManager.selectCell(row,col,'simple');}
else{_tableManager.cellUnselected();}});$(".advancedProperties").live('click',function(){var tbody=$("#table-"+ComponentsPanel.PROPERTIES+" tbody");tbody.fadeOut(300);setTimeout(function(){var myself=$("#table-"+ComponentsPanel.COMPONENTS+" .ui-state-active td");if(myself.length>0){var row=myself.parent().prevAll().length;var col=myself.prevAll().length;var _tableManager=TableManager.getTableManager(myself.closest("table").attr("id"));_tableManager.selectCell(row,col,'advanced');$(".advancedProperties").attr("class","advancedProperties propertiesSelected");$(".advancedProperties").parent().find(".simpleProperties").attr("class","simpleProperties propertiesUnSelected");}},500);});$(".simpleProperties").live('click',function(){var tbody=$("#table-"+ComponentsPanel.PROPERTIES+" tbody");tbody.fadeOut(300);setTimeout(function(){var myself=$("#table-"+ComponentsPanel.COMPONENTS+" .ui-state-active td");if(myself.length>0){var row=myself.parent().prevAll().length;var col=myself.prevAll().length;var _tableManager=TableManager.getTableManager(myself.closest("table").attr("id"));_tableManager.selectCell(row,col,'simple');$(".advancedProperties").attr("class","advancedProperties propertiesUnSelected");$(".advancedProperties").parent().find(".simpleProperties").attr("class","simpleProperties propertiesSelected");}},500);});},S4:function(){return(((1+Math.random())*0x10000)|0).toString(16).substring(1);},generateGUID:function(){return(TableManager.S4()+TableManager.S4()+"-"+TableManager.S4()+"-"+TableManager.S4()+"-"+TableManager.S4()+"-"+TableManager.S4()+TableManager.S4()+TableManager.S4());}});var TableModel=Base.extend({id:"row.id",logger:{},data:[],indexManager:{},columnId:undefined,columnNames:[],columnGetExpressions:[],columnTypes:[],columnSizes:undefined,editable:undefined,columnSetExpressions:[],rowId:"row.id",parentId:undefined,rowType:"row.type",constructor:function(id){this.logger=new Logger("TableModel"+id);this.id=id;this.setIndexManager(new IndexManager(this));this.init();},getEvaluatedId:function(rowNumber){try{var row=this.data[rowNumber];return this.getRowId()(row);}
catch(e){this.logger.error("Error getting id "+e);}},getRowByName:function(name){var row;$.each(this.data,function(i,r){if(r.name==name){row=r;return;}});return row;},getRowIndexByName:function(name){var idx;$.each(this.data,function(i,r){if(r.name==name){idx=i;return false;}});return idx;},getEvaluatedRowType:function(rowNumber){try{var row=this.data[rowNumber];return this.getRowType()(row);}
catch(e){this.logger.error("Error getting row type: "+e);}},init:function(){},setId:function(id){this.id=id;},getId:function(){return this.id;},setData:function(data){this.data=data;this.getIndexManager().updateIndex();},getData:function(){return this.data;},setIndexManager:function(indexManager){this.indexManager=indexManager;},getIndexManager:function(){return this.indexManager;},setColumnNames:function(columnNames){this.columnNames=columnNames;},getColumnNames:function(){return this.columnNames;},setColumnGetExpressions:function(columnGetExpressions){this.columnGetExpressions=columnGetExpressions;},getColumnGetExpressions:function(){return this.columnGetExpressions;},setColumnSetExpressions:function(columnSetExpressions){this.columnSetExpressions=columnSetExpressions;},getColumnSetExpressions:function(){return this.columnSetExpressions;},setColumnTypes:function(columnTypes){this.columnTypes=columnTypes;},getColumnTypes:function(){return this.columnTypes;},setColumnSizes:function(columnSizes){this.columnSizes=columnSizes;},getColumnSizes:function(){return this.columnSizes;},setEditable:function(editable){this.editable=editable;},getEditable:function(){return this.editable;},setRowId:function(rowId){this.rowId=rowId;},getRowId:function(){return this.rowId;},setRowType:function(rowType){this.rowType=rowType;},getRowType:function(){return this.rowType;},setParentId:function(parentId){this.parentId=parentId;},getParentId:function(){return this.parentId;}});var PropertiesTableModel=TableModel.extend({constructor:function(id){this.logger=new Logger("TableModel"+id);this.id=id;this.setIndexManager(new IndexManager(this));this.setColumnNames(['Property','Value']);this.setColumnGetExpressions([function(row){return row.description;},function(row){return row.value;}]);this.setColumnSetExpressions([undefined,function(row,value){row.value=value;}]);this.setColumnTypes(['String',function(row){return row.type;}]);this.setColumnSizes(['40%','60%']);this.setEditable([false,true]);this.setRowId(function(row){return TableManager.generateGUID();});this.setRowType(function(row){return row.type;});this.init();}});var CellRenderer=Base.extend({logger:{},tableManager:null,constructor:function(tableManager){this.logger=new Logger("CellRenderer");this.logger.debug("Creating new CellRenderer");this.tableManager=tableManager;},render:function(placeholder,value,callback){$("<td>"+value+"</td>").appendTo(placeholder);},getTableManager:function(){return this.tableManager;}});var LabelRenderer=CellRenderer.extend({constructor:function(tableManager){this.base(tableManager);this.logger=new Logger("LabelRenderer");this.logger.debug("Creating new LabelRenderer");}});var StringRenderer=CellRenderer.extend({constructor:function(tableManager){this.base(tableManager);this.logger=new Logger("StringRenderer");this.logger.debug("Creating new StringRenderer");},render:function(placeholder,value,callback){var _editArea=$("<td>"+value+"</td>");var myself=this;_editArea.editable(function(value,settings){myself.logger.debug("Saving new value: "+value);callback(value);return value;},{cssclass:"cdfddInput",select:true,onblur:"submit",onsubmit:function(settings,original){return myself.validate($('input',this).val());}});_editArea.appendTo(placeholder);},validate:function(settings,original){return true;}});var IdRenderer=StringRenderer.extend({constructor:function(tableManager){this.base(tableManager);this.logger=new Logger("IdRenderer");this.logger.debug("Creating new IdRenderer");},validate:function(value){if(!value.match(/^[a-zA-Z0-9_.]*$/)){$.prompt('Argument '+value+' invalid. Can only contain alphanumeric characters and the special _ and . characters');return false;}
return true;}});var IntegerRenderer=StringRenderer.extend({constructor:function(tableManager){this.base(tableManager);this.logger=new Logger("IntegerRenderer");this.logger.debug("Creating new IntegerRenderer");},validate:function(value){if(!value.match(/^[-]?\d*$/)){$.prompt('Argument '+value+' must be numeric');return false;}
return true;}});var FloatRenderer=StringRenderer.extend({constructor:function(tableManager){this.base(tableManager);this.logger=new Logger("FloatRenderer");this.logger.debug("Creating new FloatRenderer");},validate:function(value){if(!value.match(/^[-]?\d*\.?\d*$/)){$.prompt('Argument '+value+' must be numeric');return false;}
return true;}});var SelectRenderer=CellRenderer.extend({isAutoComplete:true,selectData:{},revertedSelectData:{},autocompleteArray:[],constructor:function(tableManager){this.base(tableManager);this.logger=new Logger("SelectRenderer");this.logger.debug("Creating new SelectRenderer");this.getDataInit();},render:function(placeholder,value,callback){this.processData();var _editArea=$("<td>"+((!$.isArray(this.getData())&&typeof this.getData()[value]!=undefined)?this.getData()[value]:value)+"</td>");var myself=this;_editArea.editable(function(value,settings){var valueId;if(!$.isArray(myself.getData())&&typeof myself.revertedSelectData[value]!="undefined"){valueId=myself.revertedSelectData[value];}
else{valueId=value;}
myself.logger.debug("Saving new value: "+valueId);callback(valueId);myself.postChange(valueId);return value;},{type:"autocomplete",tooltip:"Click to edit...",onblur:"submit",autocomplete:{source:function(req,add){myself.autoCompleteRequest(req,add);},minLength:0,focus:function(event,data){if(data!=undefined)$('input',_editArea).val(data.item.value);},delay:this.getDelay()},onsubmit:function(settings,original){return myself.validate($('input',this).val());},height:12});_editArea.appendTo(placeholder);},autoCompleteRequest:function(req,add){if(this.isAutoComplete){add(jQuery.grep(this.autocompleteArray,function(elt,i){return elt.toLowerCase().indexOf(req.term.toLowerCase())==0;}));}
else{add(this.autocompleteArray);}},getDelay:function(){return 300;},processData:function(){if($.isArray(this.getData())){this.isArray=true;this.autocompleteArray=this.getData();}
else{this.isArray=false;this.autocompleteArray=[];for(i in this.getData()){this.autocompleteArray.push(this.getData()[i]);this.revertedSelectData[this.getData()[i]]=i;}}},validate:function(settings,original){return true;},getData:function(){return this.selectData;},getDataInit:function(){},postChange:function(){}});var BooleanRenderer=SelectRenderer.extend({isAutoComplete:false,selectData:{'true':'True','false':'False'}});var SelectMultiRenderer=CellRenderer.extend({value:null,constructor:function(tableManager){this.base(tableManager);this.logger=new Logger("SelectMultiRenderer");this.logger.debug("Creating new SelectMultiRenderer");},render:function(placeholder,value,callback){this.value=value;var myself=this;var _editArea=$("<td>"+myself.getFormattedValue(value)+"</td>");_editArea.editable(function(value,settings){var selector=$(this);var value="['"+selector.find("input").val().replace(/, /g,"','")+"']";if(value=="['Select options']"){value="[]";}
myself.logger.debug("Saving new value: "+value);callback(value);return value;},{cssclass:"cdfddInput",data:this.getData(),type:'selectMulti',submit:'OK',height:12,onsubmit:function(settings,original){return myself.validate($('input',this).val());}});_editArea.appendTo(placeholder);},validate:function(settings,original){return true;},getData:function(){return'{"A": "Alpha","B":"Beta"}';},getFormattedValue:function(value){return value;}});var RoundCornersRenderer=SelectRenderer.extend({selectData:{'':'Simple','cdfdd-round':'Round','cdfdd-bevel':'Bevel','cdfdd-notch':'Notch','cdfdd-bite':'Bite','cdfdd-bevel_top':'Top Bevel','cdfdd-dog_tr':'Dog TR'}});var TextAlignRenderer=SelectRenderer.extend({selectData:{'':'','left':'Left','center':'Center','right':'Right'}});var ColorRenderer=CellRenderer.extend({constructor:function(tableManager){this.base(tableManager);this.logger=new Logger("ColorRenderer");this.logger.debug("Creating new ColorRenderer");this.id=0;},getId:function(){return this.id++;},render:function(placeholder,value,callback){this.placeholder=placeholder;var id=this.getId();var inputId="#colorpicker_input_"+id;var checkId="#colorpicker_check_"+id;var _editArea=$('<td><form onsubmit="return false" class="cdfddInput"><input id="colorpicker_check_'+id+'" class="colorcheck" type="checkbox"></input><input id="colorpicker_input_'+id+'" class="colorinput" readonly="readonly" type="text" size="7"></input></form></td>');var myself=this;$(checkId,_editArea).bind("click",function(){if($(this).is(":checked")){$(inputId,_editArea).attr("disabled",true);$(inputId,_editArea).attr("readonly","readonly");$(inputId).trigger("click");}
else{$(inputId,_editArea).val("");$(inputId,_editArea).attr("disabled",true);callback("");}});this.updateValueState(value,_editArea,inputId,checkId);$(inputId,_editArea).ColorPicker({onSubmit:function(hsb,hex,rgb,el){$(el).val("#"+hex);$(el).ColorPickerHide();callback("#"+hex);},onBeforeShow:function(){$(this).ColorPickerSetColor(this.value.substring(1));}});_editArea.appendTo(placeholder);},updateValueState:function(value,placeholder,inputId,checkId){if(value==''){$(checkId,placeholder).removeAttr("checked");$(checkId,placeholder).css("background-color","#ffffff");$(inputId,placeholder).attr("disabled",true);}
else{$(checkId,placeholder).attr("checked","true");$(inputId,placeholder).removeAttr("disabled");$(inputId,placeholder).attr("readonly","readonly");$(inputId,placeholder).val(value);}}});var TextAreaRenderer=CellRenderer.extend({value:null,constructor:function(tableManager){this.base(tableManager);this.logger=new Logger("TextAreaRenderer");this.logger.debug("Creating new TextAreaRenderer");},render:function(placeholder,value,callback){this.value=value;var _editArea=$('<td><div style="float:left"><code></code></div><div class="edit" style="float:right"></div></td>');_editArea.find("code").text(this.getFormattedValue(value));var myself=this;var _prompt=$('<button class="cdfddInput">...</button>').bind("click",function(){var _inner='Edit<br /><textarea wrap="off" cols="80" class="cdfddEdit" name="textarea">'+myself.value+'</textarea>';cdfdd.textarea=[myself,placeholder,myself.value,callback];$.prompt(_inner,{buttons:{Ok:true,Cancel:false},callback:myself.callback,opacity:0.2,prefix:'brownJqi'});}).appendTo($("div.edit",_editArea));_editArea.appendTo(placeholder);},callback:function(v,m,f){if(v){var value=f.textarea;this.value=value;if(value.length!=0&&value.substr(value.length-1,1)!=" "){value=value+" ";}
cdfdd.textarea[3](value);$("code",cdfdd.textarea[1]).text(cdfdd.textarea[0].getFormattedValue(value));}
delete cdfdd.textarea;},getFormattedValue:function(_value){if(_value.length>30){_value=_value.substring(0,20)+" (...)";}
return _value;}});var CodeRenderer=CellRenderer.extend({value:null,editor:null,constructor:function(tableManager){this.base(tableManager);this.logger=new Logger("CodeRenderer");this.logger.debug("Creating new CodeRenderer");},render:function(placeholder,value,callback){this.value=value;var _editArea=$('<td><div style="float:left"><code></code></div><div class="edit" style="float:right"></div></td>');_editArea.find("code").text(this.getFormattedValue(value));var myself=this;var _prompt=$('<button class="cdfddInput">...</button>').bind("click",function(){var _inner='<div style="height:450px;"> Edit<br /><pre id="codeArea" style="width:95%; height:90%;" class="cdfddEdit" name="textarea"></pre></div>';cdfdd.textarea=[myself,placeholder,myself.value,callback];$.prompt(_inner,{buttons:{Ok:true,Cancel:false},callback:myself.callback,opacity:0.2,prefix:'brownJqi'});myself.editor=new CodeEditor();myself.editor.initEditor('codeArea');myself.editor.setMode(myself.getCodeType());myself.editor.setContents(myself.value);}).appendTo($("div.edit",_editArea));_editArea.appendTo(placeholder);},callback:function(v,m,f){if(v){var value=cdfdd.textarea[0].editor.getContents();this.value=value;if(value.length!=0&&value.substr(value.length-1,1)!=" "){value=value+" ";}
cdfdd.textarea[3](value);$("code",cdfdd.textarea[1]).text(cdfdd.textarea[0].getFormattedValue(value));}
delete cdfdd.textarea;},getCodeType:function(){return'javascript';},getFormattedValue:function(_value){if(_value.length>30){_value=_value.substring(0,20)+" (...)";}
return _value;}});var HtmlRenderer=CodeRenderer.extend({getCodeType:function(){return'html';}});var ResourceRenderer=CodeRenderer.extend({getCodeType:function(){var rtype=this.getTableManager().getTableModel().getRowByName("resourceType");if(rtype!=null){return rtype.value.toLowerCase();}
else{return null;}}});var DateRenderer=CellRenderer.extend({callback:undefined,constructor:function(tableManager){this.base(tableManager);this.logger=new Logger("DateRenderer");this.logger.debug("Creating new DateRenderer");},render:function(placeholder,value,callback){this.callback=callback;var _editArea=$("<td>"+this.getFormattedValue(value)+"</td>");var myself=this;_editArea.editable(function(value,settings){myself.logger.debug("Saving new value: "+value);if(value!='pickDate')
callback(value);return myself.getFormattedValue(value);},{cssclass:"cdfddInput",data:this.getData(value),type:'select',submit:'OK',height:12,onsubmit:function(settings,original){var selectedValue=$(this.children()[0]).val();if(selectedValue=='pickDate'){myself.pickDate($(this.children()[0]));return false;}
return myself.validate();}});_editArea.appendTo(placeholder);},pickDate:function(input){var myself=this;this.datePicker=$("<input/>").css("width","80px");$(input).replaceWith(this.datePicker);this.datePicker.datepicker({dateFormat:'yy-mm-dd',changeMonth:true,changeYear:true,onSelect:function(date,input){myself.callback(date);}});this.datePicker.datepicker('show');},validate:function(settings,original){return true;},getData:function(value){var data=Panel.getPanel(ComponentsPanel.MAIN_PANEL).getParameters();var _str="{'today':'Today','yesterday':'Yesterday','lastWeek':'One week ago','lastMonth':'One month ago','monthStart':'First day of month','yearStart':'First day of year','pickDate':'Pick Date', 'selected':'"+value+"'}";return _str;},getFormattedValue:function(selectedValue){var date;if(selectedValue.match(/\d{4}-\d{2}-\d{2}/)){var dateArray=selectedValue.split('-');date=new Date(dateArray[0],dateArray[1]-1,dateArray[2]);return this.toDateString(date);}
else{if(selectedValue=='pickDate')
return this.toDateString(this.datePicker.datepicker('getDate'));return selectedValue;}},toDateString:function(d){var currentMonth="0"+(d.getMonth()+1);var currentDay="0"+(d.getDate());return d.getFullYear()+"-"+(currentMonth.substring(currentMonth.length-2,currentMonth.length))+"-"+(currentDay.substring(currentDay.length-2,currentDay.length));}});var DateRangeRenderer=DateRenderer.extend({pickDate:function(input){this.datePicker=$("<input/>").css("width","80px");$(input).replaceWith(this.datePicker);var offset=this.datePicker.offset();var myself=this;var a=this.datePicker.daterangepicker({posX:offset.left-400,posY:offset.top-100,dateFormat:'yy-mm-dd',onDateSelect:function(rangeA,rangeB){myself.rangeA=rangeA;myself.rangeB=rangeB;}});this.datePicker.click();},getData:function(value){var data=Panel.getPanel(ComponentsPanel.MAIN_PANEL).getParameters();var _str="{'monthToDay':'Month to day','yearToDay':'Year to day','pickDate':'Pick Dates', 'selected':'"+(value)+"'}";return _str;},getFormattedValue:function(value){var selectedValue=value;if(selectedValue=='pickDate'){return this.rangeA+" - "+this.rangeB;}
var date=new Date()
if(selectedValue=="monthToDay")
date.setDate(1);else if(selectedValue=="yearToDay"){date.setMonth(0);date.setDate(1);}
return this.toDateString(date)+" "+this.toDateString(new Date());}});var ResourceFileRenderer=CellRenderer.extend({callback:null,editor:null,fileName:null,createNew:true,renderEditorButton:function(){var myself=this;return $('<button class="cdfddInput">...</button>').click(function(){if(myself.fileName==null)return;var url="extEditor?path="+myself.fileName+"&mode="+myself.getResourceType();var _inner="<iframe id=externalEditor src='"+url+"' width='100%' height='400px' ></iframe>";var action;var extEditor={edit:{html:_inner,buttons:{'Open File in new Tab/Window':'newtab','Close':'close'},opacity:0.2,top:'5%',prefix:'brownJqi',submit:function(val,msg,form){action=val;var status=$('iframe#externalEditor').contents().find('#infoArea');if(status!=null&&status.text().indexOf('*')>-1){$.prompt.goToState('confirm');return false;}
else{if(action=='newtab'){window.open(url);}
return true;}}},confirm:{html:'<div height="100%" width="100%" style="text-align:center;font-size:15px;"> <br> <br> <span>Any unsaved changes will be lost. Continue anyway?</span> <br> <br> </div>',buttons:{Yes:true,Cancel:false},submit:function(val,msg,form){if(val){if(action=='newtab'){window.open(url);}
return true;}
else{$.prompt.goToState('edit');return false;}}}};$.prompt(extEditor,{prefix:'brownJqi',top:'5%'});});},constructor:function(tableManager){this.base(tableManager);this.logger=new Logger("ResourceFileRenderer");this.logger.debug("Creating new ResourceFileRenderer");},render:function(placeholder,value,callback){this.callback=callback;this.value=value;this.validate(value);var content=$('<td></td>');var _editArea=$('<div class="cdfdd-resourceFileNameRender" >'+value+'</div>');var _fileExplorer=$('<button class="cdfdd-resourceFileExplorerRender"> ^ </button>');var myself=this;var _prompt=this.renderEditorButton();content.append(_editArea);content.append(_fileExplorer);content.append(_prompt);_editArea.editable(function(value,settings){myself.logger.debug("Saving new value: "+value);callback(value);return value;},{cssclass:"cdfddInput",select:true,onsubmit:function(settings,original){var value=$('input',this).val();myself.fileName=value;return myself.validate(value);}});var fileExtensions=this.getFileExtensions();_fileExplorer.bind('click',function(){var fileExplorercontent='Choose existing file'+(myself.createNew?', or select a folder to create one:':':');fileExplorercontent+='<div id="container_id" class="urltargetfolderexplorer"></div>';var selectedFile="";var selectedFolder="";var openOrNew={browse:{html:fileExplorercontent,buttons:{Ok:true,Cancel:false},opacity:0.2,submit:function(v,m,f){if(v){if(selectedFile.length>0){myself.fileName=selectedFile;var file=myself.formatSelection(selectedFile);_editArea.text(file);myself.callback(file);return true;}
else if(selectedFolder.length>0){if(myself.createNew){$.prompt.goToState('newFile');}
return false;}}
return true;}},newFile:{html:'<div> New File: <input name="fileName"></input></div>',buttons:{Ok:true,Cancel:false},submit:function(v,m,f){if(v){selectedFile=selectedFolder+f.fileName;var ext=selectedFile.substring(selectedFile.lastIndexOf('.')+1);if('.'+ext!=myself.getFileExtensions()){selectedFile+=myself.getFileExtensions();}
myself.fileName=selectedFile;var file=myself.formatSelection(selectedFile);_editArea.text(file);myself.callback(file);return true;}
else{$.prompt.goToState('browse');return false;}}}};$.prompt(openOrNew,{opacity:'0.2',loaded:function(){selectedFile="";$('#container_id').fileTree({root:'/',script:CDFDDDataUrl.replace("Syncronize","ExploreFolder?fileExtensions="+fileExtensions),expandSpeed:1000,collapseSpeed:1000,multiFolder:false,folderClick:function(obj,folder){if($(".selectedFolder").length>0)$(".selectedFolder").attr("class","");$(obj).attr("class","selectedFolder");selectedFolder=folder;}},function(file){selectedFile=file;$(".selectedFile").attr("class","");$("a[rel='"+file+"']").attr("class","selectedFile");});}});});content.appendTo(placeholder);},getResourceType:function(){var rtype=this.getTableManager().getTableModel().getRowByName("resourceType");if(rtype!=null){return rtype.value.toLowerCase();}
else{return null;}},getFileExtensions:function(){return this.getResourceType()=="css"?".css":".js";},formatSelection:function(file){var common=true;var splitFile=file.split("/");var dashFile=cdfdd.getDashboardData().filename;if(dashFile==null)dashFile='';splitPath=dashFile.split("/"),finalPath="",i=0;while(common){if(splitFile[i]!==splitPath[i]){common=false;}
i+=1;}
$.each(splitPath.slice(i),function(i,j){finalPath+="../";});finalPath+=splitFile.slice(i-1).join('/');return("${res:"+finalPath.replace(/\/+/g,"/")+'}');},setFileName:function(settings)
{if(settings.indexOf('${res:')>-1){var fileName=settings.replace('${res:','').replace('}','');if(fileName.charAt(0)!='/')
{var basePath=cdfdd.getDashboardData().filename;if(basePath==null)
{this.fileName=null;return;}
var lastSep=basePath.lastIndexOf('/');basePath=basePath.substring(0,lastSep);if(fileName.indexOf('..')>-1)
{var base=basePath.split('/');var file=fileName.split('/');var baseEnd=base.length;var fileStart=0;while(file[fileStart]=='..'&&baseEnd>0)
{fileStart++;baseEnd--;}
fileName=base.slice(0,baseEnd).concat(file.slice(fileStart)).join('/');}
else{fileName=basePath+'/'+fileName;}}
this.fileName=fileName;}
else if(settings!=null&&settings!=''){this.fileName=settings;}
else{this.fileName=null;}},validate:function(settings,original){if(settings!=''&&(this.fileName==null||settings!=this.formatSelection(this.fileName))){this.setFileName(settings);}
return true;}});var PalleteManager=Base.extend({id:"",palleteId:"",logger:{},linkedTableManager:undefined,categories:{},entries:{},constructor:function(id){this.logger=new Logger("PalleteManager - "+id);this.id=id;this.setPalleteId(id+"Pallete");$("#"+this.id).append(this.newPallete());PalleteManager.register(this);},init:function(){this.render();},reset:function(){$("#"+this.id).empty();},newPallete:function(args){var _container='<div id="'+this.getPalleteId()+'"></div>';return _container;},render:function(){this.logger.debug("Rendering pallete "+this.getPalleteId());var _placeholder=$("#"+this.getPalleteId());_placeholder.accordion({header:"h3",active:false,autoHeight:false,icons:{header:"ui-icon-triangle-1-e",headerSelected:"ui-icon-triangle-1-s"}});},addEntry:function(palleteEntry){this.getEntries()[palleteEntry.getId()]=palleteEntry;var _cat=palleteEntry.getCategory();if(typeof this.getCategories()[_cat]=='undefined'){this.createCategory(palleteEntry);}
this.getCategories()[_cat].push(palleteEntry);var _placeholder=$(".pallete-"+_cat+" > ul ",$("#"+this.getPalleteId()));var code='\n'+'       <li><a class="tooltip" title="'+palleteEntry.getDescription()+'"  href="javascript:PalleteManager.executeEntry(\''+this.getPalleteId()+'\',\''+palleteEntry.getId()+'\');">\n'+'   '+palleteEntry.getName()+'\n'+'   </a>\n'+'   ';_placeholder.append(code)},createCategory:function(palleteEntry){$("#"+this.getPalleteId()).append('<div><h3><a href="#">'+palleteEntry.getCategoryDesc()+'</a></h3><div class="pallete-'+palleteEntry.getCategory()+'"><ul></ul></div></div>');this.getCategories()[palleteEntry.getCategory()]=[];},setId:function(id){this.id=id},getId:function(){return this.id},setPalleteId:function(palleteId){this.palleteId=palleteId},getPalleteId:function(){return this.palleteId},getLinkedTableManager:function(){return this.linkedTableManager},setLinkedTableManager:function(linkedTableManager){this.linkedTableManager=linkedTableManager},setCategories:function(categories){this.categories=categories},getCategories:function(){return this.categories},setEntries:function(entries){this.entries=entries},getEntries:function(){return this.entries}},{palleteManagers:{},register:function(palleteManager){PalleteManager.palleteManagers[palleteManager.getPalleteId()]=palleteManager;},getPalleteManager:function(id){return PalleteManager.palleteManagers[id];},executeEntry:function(palleteManagerId,id){var palleteManager=PalleteManager.getPalleteManager(palleteManagerId);palleteManager.getEntries()[id].execute(palleteManager);}});var PalleteEntry=Base.extend({id:"PALLETE_ENTRY",name:"Base operation",description:"Base Operation description",icon:"/pentaho/content/pentaho-cdf-dd/getResource?resource=/images/toolbar-folder-add-48x48.png",category:undefined,categoryDesc:undefined,logger:{},constructor:function(){this.logger=new Logger("BaseOperation");},execute:function(palleteManager,stub){var tableManager=palleteManager.getLinkedTableManager();var _stub=stub!=undefined?stub:this.getStub();var rowIdx;var colIdx=0;var rowId;var rowType;var insertAtIdx=-1;var indexManager=tableManager.getTableModel().getIndexManager();insertAtIdx=tableManager.createOrGetParent(this.category,this.categoryDesc);_stub.parent=this.category;this.logger.debug("Inserting row after "+rowType+" at "+insertAtIdx);tableManager.insertAtIdx(_stub,insertAtIdx);if(typeof tableManager.getLinkedTableManager()!='undefined'){$("table#"+tableManager.getLinkedTableManager().getTableId()+" > tbody > tr:first > td:eq(1)").trigger('click');}
return _stub;},getStub:function(){this.logger.warn("NOT IMPLEMENTED YET");},getId:function(){return this.id},setId:function(id){this.id=id},getName:function(){return this.name},setName:function(name){this.name=name},getCategory:function(){return this.category},setCategory:function(category){this.category=category},getCategoryDesc:function(){return this.categoryDesc},setCategoryDesc:function(categoryDesc){this.categoryDesc=categoryDesc},getDescription:function(){return this.description},setDescription:function(description){this.description=description},getIcon:function(){return this.icon},setIcon:function(icon){this.icon=icon}});var PalleteWizardEntry=PalleteEntry.extend({execute:function(palleteManager){this.renderWizard();},apply:function(palleteManager){this.logger.fatal("Not done yet");}},{});var WizardManager=Base.extend({wizardId:"BASEWIZARD",logger:{},title:"NOT SET",stub:{},constructor:function(){this.logger=new Logger("WizardManager");WizardManager.register(this);},init:function(){this.logger.info("Initializing WizardManager");this.resetAll();this.initWizard();$("#"+WizardManager.MAIN_DIALOG).jqm({modal:true});},render:function(_stub){this.stub=_stub;this.init();this.resetWizard();this.renderWizard();$('#'+WizardManager.MAIN_DIALOG).jqmShow();if(typeof this.postRenderWizard=='function'){this.postRenderWizard();}},resetAll:function(){$("#"+WizardManager.MAIN_DIALOG).empty();},resetWizard:function(){$("#"+WizardManager.WIZARD_LEFT_SECTION).empty();$("#"+WizardManager.WIZARD_CENTER_SECTION).empty();},renderWizard:function(){this.logger.warn("renderWizard: Method not implmemented");},postRenderWizard:function(){},initWizard:function(){var wizard='\n'+'   <div class="container">  \n'+'   <div class="span-24 last round cdfdd-wizard-title"><h1>'+this.getTitle()+'</h1></div>\n'+'   <div id="wizardDialogBody">\n'+'     <form onsubmit="return false">\n'+'    <div id="wizardDialogLeftSection" class="cdfdd-wizard-left span-5 round">\n'+'    </div>\n'+'    <div id="wizardDialogCenterSection" class="cdfdd-wizard-center span-19 last round ">\n'+'    </div>\n'+'     </form>\n'+'   </div>\n'+'   <!-- buttons -->\n'+'   <div class="clear span-15" >&nbsp;</div>\n'+'   <div class="cdfdd-wizard-buttons span-9 last round">\n'+'   <form onsubmit="return false;">\n'+'   <input id="cdfdd-wizard-button-ok" type="button" disabled onclick="WizardManager.getWizardManager(\''+this.getWizardId()+'\').buttonOk()" value="Ok"></input> \n'+'   <input id="cdfdd-wizard-button-cancel" type="button" onclick="WizardManager.getWizardManager(\''+this.getWizardId()+'\').buttonCancel()" value="Cancel"></input>\n'+'   </form>\n'+'   </div>\n'+'   ';$("#"+WizardManager.MAIN_DIALOG).append(wizard);$(".cdfdd-wizard-title").corner();},buttonOk:function(){this.logger.warn("OK Button pressed - not implemented yet");$('#'+WizardManager.MAIN_DIALOG).jqmHide();return false;},buttonCancel:function(){this.logger.warn("Cancel Button pressed - not implemented yet");$('#'+WizardManager.MAIN_DIALOG).jqmHide();},setWizardId:function(wizardId){this.wizardId=wizardId;},getWizardId:function(){return this.wizardId;},setTitle:function(title){this.title=title;},getTitle:function(){return this.title;}},{MAIN_DIALOG:"wizardDialog",WIZARD_BODY:"wizardDialogBody",WIZARD_LEFT_SECTION:"wizardDialogLeftSection",WIZARD_CENTER_SECTION:"wizardDialogCenterSection",WIZARD_RIGHT_SECTION:"wizardDialogRightSection",wizardManagers:{},register:function(wizardManager){WizardManager.wizardManagers[wizardManager.getWizardId()]=wizardManager;},getWizardManager:function(id){return WizardManager.wizardManagers[id];},executeOperation:function(wizardManagerId,idx){var wizardManager=WizardManager.getWizardManager(wizardManagerId);wizardManager.getOperations()[idx].execute(wizardManager);},globalInit:function(){$("td.draggableDimension, td.draggableMeasure, td.draggableFilter").live("mouseover",function(){var myself=$(this);myself.parent().parent().find("td").removeClass("ui-state-active");myself.addClass("ui-state-active");});}});var SaikuOlapWizard=WizardManager.extend({wizardId:"SAIKU_OLAP_WIZARD",title:"Saiku OLAP Wizard",constructor:function(){this.base();this.logger=new Logger("SaikuOlapWizard");WizardManager.register(this);},init:function(){this.base();},renderWizard:function(){var saikuContent='\n'+'    <div id="SaikuOlapWizardContent"> <br/>\n'+'    <table><tr id="fileChooser" >\n'+'    <td><input id="newSaikuQuery" type="button" value="New Saiku Query"/></td></tr></table><br/>\n'+'    <div id="SaikuWindow" /> <br/>\n'+'    </div>\n';var saikuCallback=function(filename){var splitFile=filename.split("/");var solution=splitFile[1];var action=splitFile[splitFile.length-1];var path="";if(splitFile.length>3){for(var i=2;i<splitFile.length-1;i++){path+="/"+splitFile[i];}}
var iframe='<iframe id="saikuIframe" src="../saiku-ui/index.html?biplugin=true&solution='+solution+'&path='+path+'&action='+action+'&dimension_prefetch=false#query/open/'+action+'" width="100%" height="400px" />';$('#SaikuWindow').html(iframe);$("#cdfdd-wizard-button-ok").removeAttr("disabled");};$("#"+WizardManager.WIZARD_BODY).html(saikuContent);$("#newSaikuQuery").click(function(){var iframe='<iframe id="saikuIframe" src="../saiku-ui/index.html?biplugin=true" width="100%" height="400px" />';$('#SaikuWindow').html(iframe);$("#cdfdd-wizard-button-ok").removeAttr("disabled");});var spr=new SaikuPathRenderer();spr.render($('#fileChooser'),"Choose existing Saiku Query",saikuCallback);$(".round","#"+WizardManager.WIZARD_BODY).corner();},buttonOk:function(){window.saveSaiku=function(saikuStub){var saikuMondrianStub=BaseModel.getModel('Componentsmdx_mondrianJndi').getStub();CDFDDUtils.getProperty(saikuMondrianStub,"name").value="olapQuery";CDFDDUtils.getProperty(saikuMondrianStub,"jndi").value=saikuStub.jndi;saikuStub.catalog=saikuStub.catalog.replace('solution:','');CDFDDUtils.getProperty(saikuMondrianStub,"catalog").value=saikuStub.catalog;CDFDDUtils.getProperty(saikuMondrianStub,"query").value=saikuStub.mdx;var componentsPalleteManager=PalleteManager.getPalleteManager(DatasourcesPanel.PALLETE_ID);var entry=componentsPalleteManager.getEntries()['MDX_MONDRIANJNDI_ENTRY'];var componentsTableManager=componentsPalleteManager.getLinkedTableManager();insertAtIdx=componentsTableManager.createOrGetParent(entry.getCategory(),entry.getCategoryDesc());saikuMondrianStub.parent=entry.getCategory();componentsTableManager.insertAtIdx(saikuMondrianStub,insertAtIdx);$('#'+WizardManager.MAIN_DIALOG).jqmHide();};window.getSaikuMdx();}});var wizard=new SaikuOlapWizard();var OlapWizard=WizardManager.extend({wizardId:"OLAP_WIZARD",title:"OLAP Wizard",catalogs:{},olapObjects:{DimensionTableData:[],MeasureTableData:[],FilterTableData:[]},selectedWizardObjects:{rows:[],columns:[],filters:[]},selectedOptions:{},levelType:"",levelDirection:"",constructor:function(){this.base();this.logger=new Logger("OlapWizard");},init:function(){this.base();this.resetOlapObjects();this.resetSelectedWizardObjects();},renderWizard:function(){var leftSectionContent='\n'+'    <div class="cdfdd-wizard-olap-cubes span-5 round last">\n'+'     <h3>Cube:</h3>\n'+'         <div id="cdfddOlapCubeSelector" class="centeredText"></div>\n'+'     </div>\n'+'     <div class="cdfdd-wizard-olap-dimensions span-5 round last">\n'+'         <div id="cdfddOlapDimensionDiv" class="centeredText">\n'+'       <table id="cdfddOlapDimensionSelector" class="cdfdd small ui-reset ui-clearfix ui-component ui-hover-state">\n'+'       <caption class="ui-state-hover">Dimensions</caption>\n'+'       <thead>\n'+'       </thead>\n'+'       <tbody class="ui-widget-content">\n'+'       </tbody>\n'+'       </table>\n'+'       <table id="cdfddOlapMeasureSelector" class="cdfdd small ui-reset ui-clearfix ui-component ui-hover-state">\n'+'       <caption class="ui-state-hover">Measures</caption>\n'+'       <thead>\n'+'       </thead>\n'+'       <tbody class="ui-widget-content">\n'+'       </tbody>\n'+'       </table>\n'+'       <table id="cdfddOlapFilterSelector" class="cdfdd small ui-reset ui-clearfix ui-component ui-hover-state">\n'+'       <caption class="ui-state-hover">Filters</caption>\n'+'       <thead>\n'+'       </thead>\n'+'       <tbody class="ui-widget-content">\n'+'       </tbody>\n'+'       </table>\n'+'      </div>\n'+'     </div>';var centerSectionContent='\n'+'    <div class="span-19 round last">\n'+'     <div class="span-13">\n'+'      <div id="cdfdd-olap-preview" >\n'+'       <i>Preview Area:</i><input id="cdfdd-olap-enable-preview" type="checkbox" onchange="WizardManager.getWizardManager(\''+this.getWizardId()+'\').processChange()" value="true" checked="checked"></input>\n'+'       <div id="cdfdd-olap-preview-area"></div>\n'+'      </div>\n'+'      <div id="cdfdd-olap-rows" class="cdfdd-olap-droppable round"><i>Rows: </i><br/><span class="options"></span></div>\n'+'      <div id="cdfdd-olap-columns" class="cdfdd-olap-droppable round"><i>Columns: </i><br/><span class="options"></span></div>\n'+'      <div id="cdfdd-olap-filters" class="cdfdd-olap-droppable round"><i>Filters: </i><br/><span class="options"></span></div>\n'+'     </div>\n'+'     <div id="cdfdd-component-options" class="span-6 cdfdd-wizard-components-options last round"></div>\n'+'    </div>';$("#"+WizardManager.WIZARD_LEFT_SECTION).append(leftSectionContent);$("#"+WizardManager.WIZARD_CENTER_SECTION).append(centerSectionContent);this.renderMainOlapArea();this.renderCubeSelector();$(".round","#"+WizardManager.WIZARD_BODY).corner();var myself=this;$("#cdfdd-olap-rows").droppable({accept:this.getDroppableRows(),hoverClass:'ui-state-active',drop:function(ev,ui){WizardManager.getWizardManager(myself.wizardId).processDroppable("rows",$(this),$(ui.draggable));}});$("#cdfdd-olap-columns").droppable({accept:this.getDroppableColumns(),hoverClass:'ui-state-active',drop:function(ev,ui){WizardManager.getWizardManager(myself.wizardId).processDroppable("columns",$(this),$(ui.draggable));}});$("#cdfdd-olap-filters").droppable({accept:this.getDroppableFilters(),hoverClass:'ui-state-active',drop:function(ev,ui){WizardManager.getWizardManager(myself.wizardId).processDroppable("filters",$(this),$(ui.draggable));}});},getDroppableRows:function(){this.logger.error("getDroppableRows not implemented");},getDroppableColumns:function(){this.logger.error("getDroppableColumns not implemented");},getDroppableFilters:function(){this.logger.error("getDroppableFilters not implemented");},getMainOlapArea:function(){this.logger.error("getMainOlapArea not implemented");},renderCubeSelector:function(){var params={operation:"GetOlapCubes"};var myself=this;$.getJSON(CDFDDServerUrl+"OlapUtils",params,function(json){if(json&&json.status=="true"){var catalogs=json.result.catalogs;myself.setCatalogs(catalogs);myself.logger.info("Got correct response from getCubes: "+catalogs);var _selector=$("#cdfddOlapCubeSelector");_selector.append('<select id="cdfddOlapCatalogSelect" class="small" onchange="WizardManager.getWizardManager(\''+myself.wizardId+'\').catalogSelected()"><option value="-"> Select catalog </option></select><br/>');_selector.append('<select id="cdfddOlapCubeSelect" class="small" onchange="WizardManager.getWizardManager(\''+myself.wizardId+'\').cubeSelected()" ><option value="-"> Select cube </option></select>');$.each(catalogs,function(i,catalog){$("select#cdfddOlapCatalogSelect",_selector).append("<option>"+catalog.name+"</option>");});}
else{alert(json.result);}});},renderDimensions:function(){this.logger.warn("renderDimensions - Not done yet");},catalogSelected:function(){var _selector=$("#cdfddOlapCubeSelector");var selectedCatalog=this.getCatalog();var cubes=selectedCatalog.cubes;$("select#cdfddOlapCubeSelect",_selector).empty();$.each(cubes,function(i,cube){$("select#cdfddOlapCubeSelect",_selector).append("<option>"+cube.name+"</option>");});this.cubeSelected();},cubeSelected:function(){var selectedCatalog=$("#cdfddOlapCatalogSelect").val();var selectedCube=$("#cdfddOlapCubeSelect").val();this.logger.debug("Cube Selected: "+selectedCube);this.resetOlapObjects();this.resetSelectedWizardObjects();var params={operation:"GetCubeStructure",catalog:selectedCatalog,cube:selectedCube};var myself=this;$.getJSON(CDFDDServerUrl+"OlapUtils",params,function(json){if(json.status=="true"){myself.logger.info("Got correct response from GetCubeStructure");var dimensions=json.result.dimensions;var dimensionIdx=0;var dimensionTBody=$("#cdfddOlapDimensionSelector > tbody");dimensionTBody.empty();$.each(dimensions,function(i,dimension){var hierarchies=dimension.hierarchies;$.each(hierarchies,function(j,hierarchy){var hierarchyId="dimRow-"+(++dimensionIdx);dimensionTBody.append("<tr id='"+hierarchyId+"'><td>"+hierarchy.name+"</td></tr>");var levels=hierarchy.levels;$.each(levels,function(k,level){var levelId="dimRow-"+(++dimensionIdx);dimensionTBody.append("<tr id='"+levelId+"' class='olapObject child-of-"+hierarchyId+"'><td class='draggableDimension'>"+level.name+"</td></tr>");level.hierarchy=hierarchy;level.catalog=selectedCatalog;level.cube=selectedCube;myself.addOlapObject(WizardOlapObjectManager.DIMENSION,level);});});});dimensionTBody.parent().treeTable();$("td.draggableDimension",dimensionTBody).draggable({helper:'clone'});var measures=json.result.measures;var measureIdx=0;var measureTBody=$("#cdfddOlapMeasureSelector > tbody");measureTBody.empty();$.each(measures,function(i,measure){var measureId="levelRow-"+(++measureIdx);measureTBody.append("<tr id='"+measureId+"' class='olapObject'><td class='draggableMeasure'>"+measure.name+"</td></tr>");myself.addOlapObject(WizardOlapObjectManager.MEASURE,measure);});measureTBody.parent().treeTable();$("td.draggableMeasure",measureTBody).draggable({helper:'clone',type:"Measure"});myself.getAvailableFilters();}
else{alert(json.result);}});},getAvailableFilters:function(){var myself=this;var filters=Panel.getPanel(ComponentsPanel.MAIN_PANEL).getParameters();var filterTBody=$("#cdfddOlapFilterSelector > tbody");filterTBody.empty();$.each(filters,function(i,filter){if(filter.dimension!=undefined){filterTBody.append("<tr class='olapObject'><td class='draggableFilter'\">"+filter.properties[0].value+"</td></tr>");myself.addOlapObject(WizardOlapObjectManager.FILTER,filter);}});filterTBody.parent().treeTable();$("td.draggableFilter",filterTBody).draggable({helper:'clone'});},processDroppable:function(type,drop,drag){var myself=this;var levelIdx=drag.parent().prevAll("tr.olapObject").length;var wizardObjectType=drag.attr("class").replace(/draggable/,"").split(" ")[0];var wizardObject=this.addSelectedWizardObject(type,wizardObjectType,this.getOlapObject(wizardObjectType,levelIdx));var container=drop.find(".options");var htmlWizardObject=wizardObject.render(container);var clearButtonContainer=$('<div class="cdfdd-olap-clearButton"></div>');var clearButton=$('<a border="0"><img src="getResource?resource=/images/clear.gif">&nbsp;</a>');$(clearButton).bind('click',function(){myself.removeSelectdWizardObject(type,wizardObject);clearButtonContainer.remove();myself.processChange();});container.append(clearButtonContainer.append(clearButton));this.processChange();},removeSelectdWizardObject:function(type,object){var index=this.selectedWizardObjects[type].indexOf(object);this.selectedWizardObjects[type][index].clear();this.selectedWizardObjects[type].splice(index,1);},processChange:function(){this.logger.warn("processChange - Not done yet");},getCatalog:function(){var catalog=null;var selectedCatalog=$("#cdfddOlapCatalogSelect").val();$.each(this.getCatalogs(),function(i,cat){if(cat.name==selectedCatalog){catalog=cat;return false;}});return catalog;},getCube:function(){return $("#cdfddOlapCubeSelect").val();},setCatalogs:function(catalogs){this.catalogs=catalogs;},getCatalogs:function(){return this.catalogs;},setSelectedOptions:function(selectedOptions){this.selectedOptions=selectedOptions;},getSelectedOptions:function(){return this.selectedOptions;},addOlapObject:function(type,object){this.olapObjects[type+"TableData"].push(object);},getOlapObject:function(type,index){return this.olapObjects[type+"TableData"][index];},addSelectedWizardObject:function(type,olapType,object){var selectedWizarObject=WizardOlapObjectManager.getOlapObject(olapType,object);var myself=this;selectedWizarObject.setProcessChange(function(){myself.processChange();});this.selectedWizardObjects[type].push(selectedWizarObject);return selectedWizarObject;},getSelectedWizardObject:function(type,index){return this.selectedWizardObjects[type][index];},getSelectedRowsValue:function(preview){var rows=[];for(o in this.selectedWizardObjects.rows){rows.push(this.selectedWizardObjects.rows[o].getValue(preview));}
return rows;},getSelectedColumnsValue:function(preview){var columns=[];for(o in this.selectedWizardObjects.columns){columns.push(this.selectedWizardObjects.columns[o].getValue(preview));}
return columns;},getListenners:function(){var listeners="[";for(objs in this.selectedWizardObjects)
for(o in this.selectedWizardObjects[objs]){if(this.selectedWizardObjects[objs][o].getId!=undefined)listeners+="\""+this.selectedWizardObjects[objs][o].getId()+"\",";}
return listeners.length>1?listeners.replace(/,$/,"]"):"";},getComponentParameters:function(){var params='[';for(var i=0;i<this.selectedWizardObjects.filters.length;i++){var name=this.selectedWizardObjects.filters[i].olapObject.properties[0].value;if(i>0)params+=',';params+='["'+name+'","'+name+'"]';}
return params+']';},resetOlapObjects:function(){this.olapObjects={DimensionTableData:[],MeasureTableData:[],FilterTableData:[]};},resetSelectedWizardObjects:function(){this.selectedWizardObjects={rows:[],columns:[],filters:[]};},addQueryToDatasources:function(series){var datasourcesPalleteManager=PalleteManager.getPalleteManager(DatasourcesPanel.PALLETE_ID);var datasourcesTableManager=datasourcesPalleteManager.getLinkedTableManager();var queryModel=BaseModel.getModel('Componentsmdx_mondrianJndi');var topCount=this.getSelectedOptions().topCount;topCount=(topCount.length>0)?topCount:undefined;var datasourceStub=queryModel.getStub();CDFDDUtils.getProperty(datasourceStub,"name").value=this.getSelectedOptions().name+"Query";CDFDDUtils.getProperty(datasourceStub,"jndi").value=this.getSelectedOptions().jndi;CDFDDUtils.getProperty(datasourceStub,"catalog").value=this.getSelectedOptions().schema.replace('solution:','');CDFDDUtils.getProperty(datasourceStub,"query").value=this.buildQuery(false,topCount);if(this.includeUniqueName){CDFDDUtils.getProperty(datasourceStub,"output").value='["1","0"]';}
if(this.selectedWizardObjects.filters){var queryParamsStr='[';for(var i=0;i<this.selectedWizardObjects.filters.length;i++){var filter=this.selectedWizardObjects.filters[i].olapObject;if(i>0){queryParamsStr+=',';}
queryParamsStr+='['+'"'+filter.properties[0].value+'",'+'"'+filter.dimension+'", "String",""]';}
queryParamsStr+=']';CDFDDUtils.getProperty(datasourceStub,"parameters").value=queryParamsStr;}
var mdxEntry=datasourcesPalleteManager.getEntries()['MDX_MONDRIANJNDI_ENTRY'];var insertAtIdx=datasourcesTableManager.createOrGetParent(mdxEntry.getCategory(),mdxEntry.getCategoryDesc());datasourceStub.parent=mdxEntry.getCategory();datasourcesTableManager.insertAtIdx(datasourceStub,insertAtIdx);},getFilterValue:function(filter,preview){if(preview){return filter.olapObject.dimension;}
else{return'${'+filter.olapObject.properties[0].value+'}';}},buildQuery:function(preview,topCount){var isSelector=this.includeUniqueName==true;var rows=this.getSelectedRowsValue(preview).join(" * ");var columnsArr=this.getSelectedColumnsValue(preview);var columns=columnsArr.join(" * ");var cube=this.getSelectedOptions().cube;var sets=[];var members=[];var conditions=[];var isFirstColumnMeasure=columnsArr.length>0&&this.getSelectedWizardObject("columns",0).olapObject.type=='measure';for(o in this.selectedWizardObjects.filters){conditions.push(this.getFilterValue(this.selectedWizardObjects.filters[o],preview));}
var rootDim=this.getSelectedWizardObject('rows',0).member;if(rootDim==null){rootDim='';}
rootDim=rootDim.substring(0,rootDim.indexOf(']')+1);var memberDecl="with member [Measures].[Name] as '"+rootDim+".CurrentMember.UniqueName'";var filterBegin=" filter(";var filterEnd=", not isempty(("+rootDim+".CurrentMember"+
(columnsArr.length>0?(", "+columnsArr[0]):"")+")) ) ";var preMeasure="[Measures].[Name]";if(columns.length>0)preMeasure+=',';var preRows=topCount!=undefined?"TopCount(":"";if(isSelector){preRows+=filterBegin;}
var posRows=topCount!=undefined?", "+topCount+((isFirstColumnMeasure)?', '+columnsArr[0]+")":")"):"";if(isSelector){posRows=filterEnd+posRows;}
var nonEmptyPreStr=columns.length>0?"NON EMPTY(":"";var nonEmptyPosStr=columns.length>0?")":"";var query=(isSelector?memberDecl:'')+sets.join(" , \n")+members.join(" , \n")+" select "+nonEmptyPreStr+
preRows+"{"+rows+"}"+posRows+nonEmptyPosStr+" on ROWS, \n "+
nonEmptyPreStr+"{"+(isSelector?preMeasure:'')+columns+"}"+nonEmptyPosStr+" on Columns \n from ["+cube+"]";if(conditions.length>0){query+="\n where ("+conditions.join(" , ")+")";}
return sets.length>0||members.length>0?"with \n"+query:query;}},{});var OlapParameterWizard=OlapWizard.extend({wizardId:"OLAP_PARAMETER_WIZARD",includeUniqueName:true,constructor:function(){this.base();this.logger=new Logger("OlapParameterWizard");},renderMainOlapArea:function(){var content=$('\n'+'   <div class="cdfdd-component-options-label">Name: <input id="cdfdd-olap-parameter-name" class="invalid" type="text" onchange="WizardManager.getWizardManager(\''+this.getWizardId()+'\').processChange()" ></input></div>\n'+'   <hr/>\n'+'   <div class="cdfdd-component-options-label">Type:<select class="cdfdd-component-options-type" onchange="WizardManager.getWizardManager(\''+this.getWizardId()+'\').processChange()" id="cdfdd-olap-parameter-type" name="cdfdd-olap-parameter-type"></select></div>\n'+'   <div class="cdfdd-component-options-label">Html Object:<select class="cdfdd-component-options-htmlobject" onchange="WizardManager.getWizardManager(\''+this.getWizardId()+'\').processChange()" id="cdfdd-olap-parameter-htmlobject" name="cdfdd-olap-parameter-htmlobject"></select></div>\n'+'   <div class="cdfdd-component-options-label">Top Count:<select class="cdfdd-component-options-topCount" onchange="WizardManager.getWizardManager(\''+this.getWizardId()+'\').processChange()" id="cdfdd-olap-parameter-topcount" name="cdfdd-olap-parameter-topcount"></select></div>\n'+'   ');var olapMain=$("#cdfdd-component-options");var selector=$("#cdfdd-olap-parameter-type",content);selector.append('<option value="selectComponent">Select</option>');selector.append('<option value="radioComponent">Radio Box</option>');selector.append('<option value="multiButtonComponent">Multiple Buttons</option>');var topCountSelector=$("#cdfdd-olap-parameter-topcount",content);var topCounts=["",5,10,15,20,25,50,100];for(t in topCounts)
topCountSelector.append('<option value="'+topCounts[t]+'">'+topCounts[t]+'</option>');topCountSelector.val(50);var data=Panel.getPanel(LayoutPanel.MAIN_PANEL).getHtmlObjects();var htmlObject=$("#cdfdd-olap-parameter-htmlobject",content);$.each(data,function(i,val){htmlObject.append('<option value="'+val.properties[0].value+'" : >'+val.properties[0].value+'</option>');});olapMain.html(content);},getDroppableRows:function(){return"td.draggableDimension, td.draggableMeasure, td.draggableFilter";},getDroppableColumns:function(){return"td.draggableDimension, td.draggableMeasure, td.draggableFilter";},getDroppableFilters:function(){return"td.draggableDimension, td.draggableMeasure, td.draggableFilter";},processChange:function(){$("#cdfdd-olap-preview-area").empty();var preview=$("#cdfdd-olap-enable-preview:checked").length>0;var catalog=this.getCatalog();var valid=this.selectedWizardObjects.rows.length>0&&catalog!=undefined;var topCount=$("#cdfdd-olap-parameter-topcount").val();$("#cdfdd-olap-preview").removeClass('disabled');if(!preview){$("#cdfdd-olap-preview").addClass('disabled');}
if(valid&preview){this.getSelectedOptions().name=$("#cdfdd-olap-parameter-name").val();this.getSelectedOptions().type=$("#cdfdd-olap-parameter-type").val();this.getSelectedOptions().jndi=catalog.jndi;this.getSelectedOptions().schema=catalog.schema;this.getSelectedOptions().cube=this.getCube();this.getSelectedOptions().topCount=topCount;var topCount=this.getSelectedOptions().topCount;this.getSelectedOptions().query=this.buildQuery(true,topCount.length>0?topCount:undefined);this.preview();}
var name=$("#cdfdd-olap-parameter-name").val();if(name.length>0){$("#cdfdd-olap-parameter-name").removeClass("invalid");valid=valid&true;}
else{$("#cdfdd-olap-parameter-name").addClass("invalid");valid=false;}
if(valid){$("#cdfdd-wizard-button-ok").removeAttr("disabled");}
else{$("#cdfdd-wizard-button-ok").attr("disabled","disabled");}},preview:function(){this.logger.debug("Launching preview");CDFDDPreviewComponent={name:"CDFDDPreviewComponent",type:this.getSelectedOptions().type,valueAsId:true,size:this.getSelectedOptions().type=="selectMultiComponent"?5:1,selectMulti:true,queryDefinition:{queryType:'mdx',jndi:this.getSelectedOptions().jndi,catalog:this.getSelectedOptions().schema,query:this.getSelectedOptions().query,cube:this.getSelectedOptions().cube},htmlObject:"cdfdd-olap-preview-area",executeAtStart:true};Dashboards.components=[];Dashboards.init([CDFDDPreviewComponent]);},buttonOk:function(){this.apply();$('#'+WizardManager.MAIN_DIALOG).jqmHide();},apply:function(){$('#'+WizardManager.MAIN_DIALOG).jqmHide();this.addQueryToDatasources();var componentsPaletteManager=PalleteManager.getPalleteManager(ComponentsPanel.PALLETE_ID);var componentsTableManager=componentsPaletteManager.getLinkedTableManager();var parameterModel=BaseModel.getModel(ComponentsOlapParameterModel.MODEL);var parameterStub=parameterModel.getStub();var parameterId=this.getSelectedOptions().name+"Parameter";var dimension=this.selectedWizardObjects.rows[0].member;var type=this.getSelectedOptions().type;CDFDDUtils.getProperty(parameterStub,"name").value=parameterId;CDFDDUtils.getProperty(parameterStub,"propertyValue").value=dimension;parameterStub.dimension=dimension;var parameterEntry=new ParameterEntry();var insertAtIdx=componentsTableManager.createOrGetParent(parameterEntry.getCategory(),parameterEntry.getCategoryDesc());parameterStub.parent=parameterEntry.getCategory();componentsTableManager.insertAtIdx(parameterStub,insertAtIdx);var type=this.getSelectedOptions().type;var model="";var entry=null;switch(type){case"selectComponent":model=ComponentsSelectModel.MODEL;entry=new SelectEntry();break;case"selectMultiComponent":model=ComponentsSelectMultiModel.MODEL;entry=new SelectMultiEntry();break;case"autocompleteBoxComponent":model=ComponentsAutocompleteBoxModel.MODEL;entry=new AutocompleteBoxEntry();break;case"radioComponent":model=ComponentsradioModel.MODEL;entry=new radioEntry();break;case"checkComponent":model=ComponentscheckModel.MODEL;entry=new checkEntry();break;case"multiButtonComponent":model=ComponentsmultiButtonModel.MODEL;entry=new multiButtonEntry();break;default:this.logger.error("Not done yet!");alert("Type"+type+" not implemented");}
var selectorModel=BaseModel.getModel(model);var selectorStub=selectorModel.getStub();CDFDDUtils.getProperty(selectorStub,"name").value=this.getSelectedOptions().name+"Selector";CDFDDUtils.getProperty(selectorStub,"parameter").value=this.getSelectedOptions().name+"Parameter";CDFDDUtils.getProperty(selectorStub,"dataSource").value=this.getSelectedOptions().name+"Query";CDFDDUtils.getProperty(selectorStub,"htmlObject").value=$("#cdfdd-olap-parameter-htmlobject").val();if(CDFDDUtils.getProperty(selectorStub,"valueAsId")){CDFDDUtils.getProperty(selectorStub,"valueAsId").value=false;}
var listenners=this.getListenners();if(listenners.length>0){CDFDDUtils.getProperty(selectorStub,"listeners").value=listenners;}
CDFDDUtils.getProperty(selectorStub,"xActionArrayParameter").value=this.getComponentParameters();insertAtIdx=componentsTableManager.createOrGetParent(entry.getCategory(),entry.getCategoryDesc());selectorStub.parent=entry.getCategory();componentsTableManager.insertAtIdx(selectorStub,insertAtIdx);}},{});var wizard=new OlapParameterWizard();var OlapChartWizard=OlapWizard.extend({wizardId:"OLAP_CHART_WIZARD",constructor:function(){this.base();this.logger=new Logger("OlapChartWizard");},renderMainOlapArea:function(){var content=$('\n'+'   <div class="cdfdd-component-options-label">Name: <input id="cdfdd-olap-parameter-name" class="invalid" type="text" onchange="WizardManager.getWizardManager(\''+this.getWizardId()+'\').processChange()" ></input></div>\n'+'   <hr/>\n'+'   <div class="cdfdd-component-options-label">Title: <input id="cdfdd-olap-parameter-title" type="text" onchange="WizardManager.getWizardManager(\''+this.getWizardId()+'\').processChange()" id="cdfdd-olap-parameter-title" name="cdfdd-olap-parameter-title"></input></div>\n'+'   <div class="cdfdd-component-options-label">Type:<select class="cdfdd-component-options-type" onchange="WizardManager.getWizardManager(\''+this.getWizardId()+'\').processChange()" id="cdfdd-olap-parameter-type" name="cdfdd-olap-parameter-type"></select></div>\n'+'   <div class="cdfdd-component-options-label">Html Object:<select class="cdfdd-component-options-htmlobject" onchange="WizardManager.getWizardManager(\''+this.getWizardId()+'\').processChange()" id="cdfdd-olap-parameter-htmlobject" name="cdfdd-olap-parameter-htmlobject"></select></div>\n'+'   <div class="cdfdd-component-options-label">Orientation:<select class="cdfdd-component-options-orientation" onchange="WizardManager.getWizardManager(\''+this.getWizardId()+'\').processChange()" id="cdfdd-olap-parameter-orientation" name="cdfdd-olap-parameter-orientation"></select></div>\n'+'   <div class="cdfdd-component-options-label">Top Count:<select class="cdfdd-component-options-topCount" onchange="WizardManager.getWizardManager(\''+this.getWizardId()+'\').processChange()" id="cdfdd-olap-parameter-topcount" name="cdfdd-olap-parameter-topcount"></select></div>\n'+'   ');var appendOption=function(obj,options){for(v in options)
obj.append('<option value="'+options[v][0]+'">'+options[v][1]+'</option>');};var componentOptions=$("#cdfdd-component-options");var typeSelector=$("#cdfdd-olap-parameter-type",content);appendOption(typeSelector,[["BarChart","Bar Chart"],["PieChart","Pie Chart"],["LineChart","Line Chart"],["DotChart","Dot Chart"]]);var topCountSelector=$("#cdfdd-olap-parameter-topcount",content);appendOption(topCountSelector,[["",""],["5","5"],["10","10"],["15","15"]]);var orientationSelector=$("#cdfdd-olap-parameter-orientation",content);appendOption(orientationSelector,[["horizontal","Horizontal"],["vertical","Vertical"]]);componentOptions.html(content);var data=Panel.getPanel(LayoutPanel.MAIN_PANEL).getHtmlObjects();var htmlObject=$("#cdfdd-olap-parameter-htmlobject",content);$.each(data,function(i,val){htmlObject.append('<option value="'+val.properties[0].value+'" : >'+val.properties[0].value+'</option>');});},getDroppableRows:function(){return"td.draggableDimension, td.draggableMeasure, td.draggableFilter";},getDroppableColumns:function(){return"td.draggableDimension, td.draggableMeasure, td.draggableFilter";},getDroppableFilters:function(){return"td.draggableDimension, td.draggableMeasure, td.draggableFilter";},processChange:function(){$("#cdfdd-olap-preview-area").empty();var preview=$("#cdfdd-olap-enable-preview:checked").length>0;var catalog=this.getCatalog();var valid=this.selectedWizardObjects.rows.length>0&&this.selectedWizardObjects.columns.length>0&&catalog!=undefined;;$("#cdfdd-olap-preview").removeClass('disabled');if(!preview){$("#cdfdd-olap-preview").addClass('disabled');}
if(valid&preview){this.getSelectedOptions().name=$("#cdfdd-olap-parameter-name").val();this.getSelectedOptions().title=$("#cdfdd-olap-parameter-title").val();this.getSelectedOptions().type=$("#cdfdd-olap-parameter-type").val();this.getSelectedOptions().topCount=$("#cdfdd-olap-parameter-topcount").val();this.getSelectedOptions().orientation=$("#cdfdd-olap-parameter-orientation").val();this.getSelectedOptions().jndi=catalog.jndi;this.getSelectedOptions().schema=catalog.schema;this.getSelectedOptions().cube=this.getCube();var topCount=this.getSelectedOptions().topCount;topCount=(topCount.length>0)?topCount:undefined;this.getSelectedOptions().query=this.buildQuery(true,topCount);this.preview();}
var name=$("#cdfdd-olap-parameter-name").val();if(name.length>0){$("#cdfdd-olap-parameter-name").removeClass("invalid");valid=valid&true;}
else{$("#cdfdd-olap-parameter-name").addClass("invalid");valid=false;}
if(valid){$("#cdfdd-wizard-button-ok").removeAttr("disabled");}
else{$("#cdfdd-wizard-button-ok").attr("disabled","disabled");}},getSeriesName:function(){var row=this.selectedWizardObjects.rows[0];if(row){for(var i=0;i<row.membersArray.length;i++){if(row.member==row.membersArray[i].qualifiedName){return row.membersArray[i].name;}}}
return null;},preview:function(){this.logger.debug("Launching preview");CDFDDPreviewComponentDefinition={width:440,height:200,title:"Preview",titlePosition:"top",titleSize:40,legend:false,maxBarSize:100,innerGap:0.9,explodedSliceIndex:0,explodedSliceRadius:0,orientation:this.getSelectedOptions().orientation,queryType:'mdx',jndi:this.getSelectedOptions().jndi,catalog:this.getSelectedOptions().schema,title:this.getSelectedOptions().title,query:this.getSelectedOptions().query,crosstabMode:true,seriesInRows:false,animate:false,clickable:false,timeSeries:false,timeSeriesFormat:"%Y-%m-%d",stacked:false,panelSizeRatio:0.8,barSizeRatio:0.9,colors:[],showValues:false,valuesAnchor:"right",titlePosition:"top",titleSize:25,legend:true,legendPosition:"bottom",legendAlign:"center",showXScale:true,xAxisPosition:"bottom",xAxisSize:30,showYScale:true,yAxisPosition:"left",yAxisSize:50,xAxisFullGrid:false,yAxisFullGrid:false,axisOffset:0,originIsZero:true,secondAxis:false,secondAxisIndependentScale:true,secondAxisIdx:-1,secondAxisOriginIsZero:true,secondAxisColor:"blue",extensionPoints:[]};CDFDDPreviewComponent={name:"CDFDDPreviewComponent",type:this.getComponentType(),chartDefinition:CDFDDPreviewComponentDefinition,htmlObject:"cdfdd-olap-preview-area",executeAtStart:true,postFetch:function(values){values.resultset.map(function(row){row.splice(1,1,parseFloat(row[1]));});return{resultset:values.resultset,metadata:[{colIndex:0,colName:'Name',colType:'String'},{colIndex:1,colName:'Value',colType:'Numeric'}]};}};Dashboards.components=[];Dashboards.init([CDFDDPreviewComponent]);},buttonOk:function(){this.apply();$('#'+WizardManager.MAIN_DIALOG).jqmHide();},getComponentType:function(){return'ccc'+this.getSelectedOptions().type;},apply:function(){$('#'+WizardManager.MAIN_DIALOG).jqmHide();this.addQueryToDatasources(this.getSeriesName());var type=this.getComponentType();var chartModel=BaseModel.getModel('Components'+type);var chartStub=chartModel.getStub();CDFDDUtils.getProperty(chartStub,"name").value=this.getSelectedOptions().name+"Chart";CDFDDUtils.getProperty(chartStub,"title").value=this.getSelectedOptions().name;CDFDDUtils.getProperty(chartStub,"htmlObject").value=$("#cdfdd-olap-parameter-htmlobject").val();CDFDDUtils.getProperty(chartStub,"dataSource").value=this.getSelectedOptions().name+"Query";CDFDDUtils.getProperty(chartStub,"height").value="300";CDFDDUtils.getProperty(chartStub,"width").value="400";CDFDDUtils.getProperty(chartStub,"cccCrosstabMode").value=true;CDFDDUtils.getProperty(chartStub,"cccOrientation").value=this.getSelectedOptions().orientation;var listenners=this.getListenners();if(listenners.length>0){CDFDDUtils.getProperty(chartStub,"listeners").value=listenners;}
CDFDDUtils.getProperty(chartStub,"xActionArrayParameter").value=this.getComponentParameters();var entryName=type.toUpperCase()+'_ENTRY';var componentsPalleteManager=PalleteManager.getPalleteManager(ComponentsPanel.PALLETE_ID);var chartEntry=componentsPalleteManager.getEntries()[entryName];var componentsTableManager=componentsPalleteManager.getLinkedTableManager();var insertAtIdx=componentsTableManager.createOrGetParent(chartEntry.getCategory(),chartEntry.getCategoryDesc());chartStub.parent=chartEntry.getCategory();componentsTableManager.insertAtIdx(chartStub,insertAtIdx);}},{});var wizard=new OlapChartWizard();var WizardOlapObjectManager=Base.extend({},{MEASURE:"Measure",DIMENSION:"Dimension",FILTER:"Filter",getOlapObject:function(type,object){if(type==WizardOlapObjectManager.MEASURE)
return new WizardMeasureObject(object);if(type==WizardOlapObjectManager.DIMENSION)
return new WizardDimensionObject(object);if(type==WizardOlapObjectManager.FILTER)
return new WizardFilterObject(object);}});var WizardOlapObject=Base.extend({constructor:function(object){this.logger=new Logger("OlapObject");this.olapObject=object;},getValue:function(preview){this.logger.error("getValue not implemented");},getFilterValue:function(preview){this.logger.error("getFilterValue not implemented");},render:function(container){this.logger.error("render not implemented");},setProcessChange:function(processChange){this.processChange=processChange;}},{});var WizardMeasureObject=WizardOlapObject.extend({getValue:function(preview){return this.olapObject.qualifiedName;},getFilterValue:function(preview){return this.olapObject.qualifiedName;},render:function(container){this.htmlObject=$('<div class="cdfdd-olap-measures">'+this.olapObject.name+'</div>');container.append(this.htmlObject);return this.htmlObject;},clear:function(){this.htmlObject.remove();}});var WizardDimensionObject=WizardOlapObject.extend({constructor:function(olapObject){this.base(olapObject);this.memberDepth=0;this.member=olapObject.hierarchy.defaultMemberQualifiedName;this.catalog=olapObject.catalog
this.cube=olapObject.cube;this.membersArray=[{name:olapObject.hierarchy.defaultMember,qualifiedName:olapObject.hierarchy.defaultMemberQualifiedName}];this.initialMembersArray=Util.clone(this.membersArray);this.initialMember=olapObject.hierarchy.defaultMemberQualifiedName;},getValue:function(preview){return"Descendants("+this.member+" ,"+this.olapObject.qualifiedName+")";},getFilterValue:function(preview){var set="set ["+this.olapObject.name+"_set] as Descendants("+this.member+" ,"+this.olapObject.qualifiedName+")";var member="member "+this.member+".[Filter] as Aggregate(["+this.olapObject.name+"_set])";return{set:set,member:member,condition:this.member+".[Filter]"};},render:function(container){if(this.htmlObject==undefined){this.htmlObject=$('<div class="cdfdd-olap-dimensions"></div>');container.append(this.htmlObject);}
this.htmlObject.empty();this.htmlObject.append('<div class="cdfdd-olap-dimensions-label">'+this.olapObject.name+'</div>');var selector=this.buildSelector();this.renderLeftButton(selector);this.htmlObject.append(selector);this.renderRightButton(selector);return this.htmlObject;},renderLeftButton:function(selector,container){var myself=this;if(this.memberDepth>0){this.htmlObject.append($('<a><img class="image-left" src="getResource?resource=/images/arrow-left.png"></a>').bind('click',function(){myself.getMembersArray('up',selector.val(),container);}));}
else
this.htmlObject.append('<div class="image-left"></div>');},renderRightButton:function(selector,container){var myself=this;if(this.memberDepth<this.olapObject.depth-1)
this.htmlObject.append($('<a><img class="image-right" src="getResource?resource=/images/arrow-right.png"></a>').bind('click',function(){myself.getMembersArray('down',selector.val(),container);}));},buildSelector:function(){var myself=this;var selector=$('<select class="cdfdd-olap-dimensions-input" ></select>');for(m in this.membersArray)
selector.append($('<option value="'+this.membersArray[m].qualifiedName+'">'+this.membersArray[m].name+'</option>'));selector.change(function(){myself.member=$(this).val();myself.processChange();});return selector;},clear:function(){this.htmlObject.remove();},getMembersArray:function(direction,memberQualifiedName,container){var myself=this;var params={operation:"GetLevelMembersStructure",catalog:myself.catalog,cube:myself.cube,member:memberQualifiedName,direction:direction};$.getJSON(CDFDDServerUrl+"OlapUtils",params,function(json){if(json.status=="true"){myself.membersArray=json.result.members;if(myself.membersArray.length==0){myself.membersArray=Util.clone(myself.initialMembersArray);myself.member=myself.initialMember;}
else
myself.member=myself.membersArray[0].qualifiedName;if(direction=='down')
myself.memberDepth++;else
myself.memberDepth--;myself.render(container);myself.processChange();}});}});var WizardFilterObject=WizardOlapObject.extend({render:function(container){this.htmlObject=$('<div class="cdfdd-olap-measures">'+this.getId()+'</div>');container.append(this.htmlObject);return this.htmlObject;},getId:function(){return this.olapObject.properties[0].value;},getValue:function(preview){return preview?this.olapObject.dimension:"${"+this.getId()+"}";},getFilterValue:function(preview){if(preview)return this.olapObject.dimension;var set="set ["+this.getId()+"_set] as {${"+this.getId()+"}}";var member="member "+this.olapObject.dimension+".[Filter] as Aggregate(["+this.getId()+"_set])";return{set:set,member:member,condition:this.olapObject.dimension+".[Filter]"};},clear:function(){this.htmlObject.remove();}});var CDFDDDatasourcesArray=[];var DatasourcesPanel=Panel.extend({name:"Datasources Panel",datasourcesPallete:{},datasourcesTable:{},datasourcesTableModel:{},propertiesTable:{},propertiesTableModel:{},datasourcesArray:[],constructor:function(id){this.base(id);this.logger=new Logger("Datasources");Panel.register(this);},init:function(){this.base();this.logger.debug("Specific init");this.datasourcesPallete=new PalleteManager(DatasourcesPanel.PALLETE);this.addPalleteEntries();this.datasourcesPallete.init();this.datasourcesTable=new TableManager(DatasourcesPanel.DATASOURCES);this.datasourcesTable.setTitle("Datasources");this.datasourcesPallete.setLinkedTableManager(this.datasourcesTable);var datasourcesTableModel=new TableModel('datasourcesTreeTableModel');datasourcesTableModel.setColumnNames(['Type','Name']);datasourcesTableModel.setColumnGetExpressions([function(row){return row.typeDesc},function(row){return CDFDDUtils.ev(row.properties[0].value)}]);datasourcesTableModel.setColumnTypes(['String','String']);datasourcesTableModel.setRowId(function(row){return row.id});datasourcesTableModel.setRowType(function(row){return row.type});datasourcesTableModel.setParentId(function(row){return row.parent});datasourcesTableModel.setData(cdfdd.getDashboardData().datasources.rows);this.datasourcesTable.setTableModel(datasourcesTableModel);this.datasourcesTable.init();this.propertiesTable=new TableManager(DatasourcesPanel.PROPERTIES);this.propertiesTable.setTitle("Properties");var propertiesTableModel=new PropertiesTableModel('datasourcesPropertiesTableModel');propertiesTableModel.setColumnGetExpressions([function(row){return row.description},function(row){return CDFDDUtils.ev(row.value)}]);propertiesTableModel.setColumnSetExpressions([undefined,function(row,value){row.value=value
if(row.name=='name'){var _tableManager=TableManager.getTableManager("table-"+DatasourcesPanel.DATASOURCES);this.logger.debug("Changing the name - applying to previous row in "+_tableManager+" in row "+_tableManager.getSelectedCell()[0]);var _cell=_tableManager.getSelectedCell();$("#"+_tableManager.getTableId()+" > tbody > tr:eq("+_cell[0]+") > td:eq(1)").text(value);}}]);this.propertiesTable.setTableModel(propertiesTableModel);this.propertiesTable.init();this.datasourcesTable.setLinkedTableManager(this.propertiesTable);this.datasourcesTable.setLinkedTableManagerOperation(function(row){var arr=[];for(p in row.properties){arr.push(row.properties[p]);}
return arr;});},getContent:function(){return' \n'+'   <div id="'+DatasourcesPanel.PALLETE+'" class="span-6 accordion"></div>\n'+'   <div id="'+DatasourcesPanel.DATASOURCES+'" class="span-8">Datasources</div>\n'+'   <div id="'+DatasourcesPanel.PROPERTIES+'" class="span-10 last">Properties</div>\n'+'   ';},addPalleteEntries:function(){$.each(CDFDDDatasourcesArray,function(i,datasource){Panel.getPanel(DatasourcesPanel.MAIN_PANEL).getDatasourcesPallete().addEntry(datasource);});},getDatasources:function(){var data=this.datasourcesTable.getTableModel().getData();var output=[];var myself=this;$.each(data,function(i,row){if(row.type!="Label")
output.push(row);});return output;},getPreviousProperty:function(prop){var data=this.datasourcesTable.getTableModel().getData();var output="";var myself=this;$.each(data,function(i,row){if(i==data.length-1)
return false;if(row.type==DatasourcesMdxModel.MODEL||row.type==DatasourcesSqlModel){output=Panel.getRowPropertyValue(row,prop);return false;}});return output;},getPreviousJndi:function(){return this.getPreviousProperty('jndi')},getPreviousCatalog:function(){return this.getPreviousProperty('catalog')},getPreviousCube:function(){return this.getPreviousProperty('cube')},setDatasourcesPallete:function(datasourcesPallete){this.datasourcesPallete=datasourcesPallete},getDatasourcesPallete:function(){return this.datasourcesPallete},setDatasourcesArray:function(datasourcesArray){this.datasourcesArray=datasourcesArray},getDatasourcesArray:function(){return this.datasourcesArray}},{MAIN_PANEL:"datasourceens_panel",PALLETE:"cdfdd-datasources-pallete",PALLETE_ID:"cdfdd-datasources-palletePallete",DATASOURCES:"cdfdd-datasources-datasources",PROPERTIES:"cdfdd-datasources-properties"});var DatasourcesMoveUpOperation=MoveUpOperation.extend({id:"DATASOURCES_MOVE_UP",types:["Datasources"],constructor:function(){this.logger=new Logger("DatasourcesMoveUpOperation");}});CellOperations.registerOperation(new DatasourcesMoveUpOperation);var DatasourcesMoveDownOperation=MoveDownOperation.extend({id:"DATASOURCES_MOVE_DOWN",types:["Datasources"],constructor:function(){this.logger=new Logger("DatasourcesMoveDownOperation");}});CellOperations.registerOperation(new DatasourcesMoveDownOperation);var DatasourcesDeleteOperation=DeleteOperation.extend({id:"DATASOURCES_DELETE",types:["Datasources"],constructor:function(){this.logger=new Logger("DatasourcesDeleteOperation");}});CellOperations.registerOperation(new DatasourcesDeleteOperation);var MdxEntry=PalleteEntry.extend({id:"MDX_ENTRY",name:"OLAP MDX query",description:"MDX query against a OLAP cube",category:"LEGACY",categoryDesc:"Legacy Datasources",execute:function(palleteManager){var myself=this;this._execute=this.base;var content='<select id="cdfddOlapCatalogSelect" onchange="MdxEntry.getEntry(\'MDX_ENTRY\').catalogSelected()"><option value="-"> Select catalog </option></select><br/>\n'+'   <select id="cdfddOlapCubeSelect" onchange="MdxEntry.getEntry(\'MDX_ENTRY\').cubeSelected()" ><option value="-"> Select cube </option></select>';$.prompt(content,{buttons:{Ok:true,Skip:false},loaded:function(){$.getJSON(CDFDDServerUrl+"OlapUtils",{operation:"GetOlapCubes"},function(json){if(json.status=="true"){var catalogs=json.result.catalogs;myself.catalogs=catalogs;$.each(catalogs,function(i,catalog){$("select#cdfddOlapCatalogSelect").append("<option>"+catalog.name+"</option>");});myself.catalogSelected();}});},callback:function(v,m,f){var datasourceStub=myself.getStub();if(v&&myself.catalog!=undefined){CDFDDUtils.getProperty(datasourceStub,"jndi").value=myself.catalog.jndi;CDFDDUtils.getProperty(datasourceStub,"catalog").value=myself.catalog.schema;CDFDDUtils.getProperty(datasourceStub,"cube").value=myself.cube;}
myself._execute(palleteManager,datasourceStub);}});},catalogSelected:function(){var myself=this;var selectedCatalog=$("#cdfddOlapCatalogSelect").val();var catalog=undefined;$.each(this.catalogs,function(i,cat){if(cat.name==selectedCatalog){catalog=cat;return;};});this.catalog=catalog;if(catalog!=undefined){var cubes=catalog.cubes;$("select#cdfddOlapCubeSelect").empty();$.each(cubes,function(i,cube){if(i==0)myself.cube=cube.name;$("select#cdfddOlapCubeSelect").append("<option>"+cube.name+"</option>");});}},cubeSelected:function(){this.cube=$("#cdfddOlapCatalogSelect").val();},getStub:function(){return DatasourcesMdxModel.getStub();}},{getEntry:function(id){var entry=undefined;$.each(CDFDDDatasourcesArray,function(i,ent){if(ent.id==id){entry=ent;return;}});return entry;}});var QueryRenderer=TextAreaRenderer.extend({});var DatasourcesMdxModel=BaseModel.extend({},{MODEL:'DatasourcesMdxModel',getStub:function(){var _stub={id:TableManager.generateGUID(),type:DatasourcesMdxModel.MODEL,typeDesc:"Mdx query",parent:IndexManager.ROOTID,properties:[]};_stub.properties.push(PropertiesManager.getProperty("name"));_stub.properties.push(PropertiesManager.getProperty("jndi"));_stub.properties.push(PropertiesManager.getProperty("catalog"));_stub.properties.push(PropertiesManager.getProperty("cube"));_stub.properties.push(PropertiesManager.getProperty("mdxquery"));return _stub;}});BaseModel.registerModel(DatasourcesMdxModel);CDFDDDatasourcesArray.push(new MdxEntry());var SqlEntry=PalleteEntry.extend({id:"SQL_ENTRY",name:"SQL query",description:"SQL query against a datasource",category:"LEGACY",categoryDesc:"Legacy Datasources",getStub:function(){return DatasourcesSqlModel.getStub();}});var DatasourcesSqlModel=BaseModel.extend({},{MODEL:'DatasourcesSqlModel',getStub:function(){var _stub={id:TableManager.generateGUID(),type:DatasourcesSqlModel.MODEL,typeDesc:"Sql query",parent:IndexManager.ROOTID,properties:[]};_stub.properties.push(PropertiesManager.getProperty("name"));_stub.properties.push(PropertiesManager.getProperty("jndi"));_stub.properties.push(PropertiesManager.getProperty("sqlquery"));return _stub;}});BaseModel.registerModel(DatasourcesSqlModel);CDFDDDatasourcesArray.push(new SqlEntry());var XactionResultSetEntry=PalleteEntry.extend({id:"XACTIONRESULTSET_ENTRY",name:"Xaction result set",description:"Use a result set returned from a xaction call in the Pentaho BI Server",category:"LEGACY",categoryDesc:"Legacy Datasources",getStub:function(){return DatasourcesXactionModel.getStub();}});var DatasourcesXactionModel=BaseModel.extend({},{MODEL:'DatasourcesXactionModel',getStub:function(){var _stub={id:TableManager.generateGUID(),type:DatasourcesXactionModel.MODEL,typeDesc:"Xaction resultset",parent:IndexManager.ROOTID,properties:[]};_stub.properties.push(PropertiesManager.getProperty("name"));_stub.properties.push(PropertiesManager.getProperty("solution"));_stub.properties.push(PropertiesManager.getProperty("path"));_stub.properties.push(PropertiesManager.getProperty("xaction"));_stub.properties.push(PropertiesManager.getProperty("parameters"));return _stub;}});BaseModel.registerModel(DatasourcesXactionModel);CDFDDDatasourcesArray.push(new XactionResultSetEntry());var KettleEntry=PalleteEntry.extend({id:"KETTLE_ENTRY",name:"Kettle transformation",description:"Executes a kettle transformation",category:"LEGACY",categoryDesc:"Legacy Datasources",getStub:function(){return DatasourcesKettleModel.getStub();}});var DatasourcesKettleModel=BaseModel.extend({},{MODEL:'DatasourcesKettleModel',getStub:function(){var _stub={id:TableManager.generateGUID(),type:DatasourcesKettleModel.MODEL,typeDesc:"Kettle transformation",parent:IndexManager.ROOTID,properties:[]};_stub.properties.push(PropertiesManager.getProperty("name"));_stub.properties.push(PropertiesManager.getProperty("directory"));_stub.properties.push(PropertiesManager.getProperty("transformation"));_stub.properties.push(PropertiesManager.getProperty("importStep"));return _stub;}});BaseModel.registerModel(DatasourcesKettleModel);CDFDDDatasourcesArray.push(new KettleEntry());var CDADataSourceEntry=PalleteEntry.extend({id:"CDA_DATASOURCE",name:"CDA Datasource",description:"CDA Data Source",category:"CDA",categoryDesc:"Community Data Access",getStub:function(){return CDADataSourceModel.getStub();}});var CDADataSourceModel=BaseModel.extend({},{MODEL:'DatasourcesCDAModel',getStub:function(){var _stub={id:TableManager.generateGUID(),type:CDADataSourceModel.MODEL,typeDesc:"CDA Datasource",parent:IndexManager.ROOTID,properties:[]};_stub.properties.push(PropertiesManager.getProperty("name"));_stub.properties.push(PropertiesManager.getProperty("cdaPath"));_stub.properties.push(PropertiesManager.getProperty("dataAccessId"));_stub.properties.push(PropertiesManager.getProperty("outputIndexId"));return _stub;}});BaseModel.registerModel(CDADataSourceModel);CDFDDDatasourcesArray.push(new CDADataSourceEntry());var CdaPathRenderer=ResourceFileRenderer.extend({getFileExtensions:function(){return".cda";},getResourceType:function(){return'cda';},formatSelection:function(file){return file;}});var CdaEditorRenderer=StringRenderer.extend({constructor:function(tableManager){this.base(tableManager);this.logger=new Logger("CdaFileRenderer");this.logger.debug("Creating new CdaFileRenderer");},render:function(placeholder,value,callback){var _editArea=$("<td></td>");var path=value;var _prompt=$('<button class="cdfddInput" style="width:auto">Edit in CDA</button>').bind("click",function(){CdaEditorRenderer.popup(path);});_editArea.append(_prompt);_editArea.appendTo(placeholder);},validate:function(settings,original){return true;}},{popup:function(path){$("#wizardDialog").empty();$("#wizardDialog").append("<iframe src='../cda/editFile?path="+path+"&initialState=exEdit' width='100%' height='95%' ></iframe>");$("#wizardDialog").append("<button onclick='$(\"#wizardDialog\").jqmHide()'class='cdfddInput' style='float:right;width: auto'>Close</button>");$("#wizardDialog").jqmShow();}});var CggPathRenderer=ResourceFileRenderer.extend({getFileExtensions:function(){return".js";},getResourceType:function(){return'javascript';},formatSelection:function(file){return file;}});var KtrPathRenderer=ResourceFileRenderer.extend({getFileExtensions:function(){return".ktr";},formatSelection:function(file){var common=true,splitFile=file.split("/"),splitPath=cdfdd.getDashboardData().filename.split("/"),finalPath="",i=0;while(common){if(splitFile[i]!==splitPath[i]){common=false;}
i+=1;}
$.each(splitPath.slice(i),function(i,j){finalPath+="../";});finalPath+=splitFile.slice(i-1).join('/');return finalPath.replace(/\/+/g,"/");}});var SaikuPathRenderer=ResourceFileRenderer.extend({createNew:false,renderEditorButton:function(){return'';},getFileExtensions:function(){return".saiku";},formatSelection:function(file){return file;}});var OlapMembersWizardEntry=PalleteWizardEntry.extend({id:"MDXMEBMERSWIZARD_ENTRY",name:"OLAP Selector wizard",description:"Generates a query to fetch the members of a dimension. Useful to use with selectors",category:"Wizards",categoryDesc:"Wizards",renderWizard:function(){return WizardManager.getWizardManager('OLAP_PARAMETER_WIZARD').render();},apply:function(){WizardManager.getWizardManager('OLAP_PARAMETER_WIZARD').apply();}});CDFDDDatasourcesArray.push(new OlapMembersWizardEntry());var OlapChartWizardEntry=PalleteWizardEntry.extend({id:"OLAP_CHART_WIZARD_ENTRY",name:"OLAP Chart wizard",description:"Generates a chart.",category:"Wizards",categoryDesc:"Wizards",renderWizard:function(){return WizardManager.getWizardManager('OLAP_CHART_WIZARD').render();},apply:function(){WizardManager.getWizardManager('OLAP_CHART_WIZARD').apply();}});CDFDDDatasourcesArray.push(new OlapChartWizardEntry());var SaikuOlapWizardEntry=PalleteWizardEntry.extend({id:"SAIKU_OLAP_WIZARD_ENTRY",name:"Saiku OLAP Wizard",description:"Use Saiku to generate an OLAP Query",category:"Wizards",categoryDesc:"Wizards",renderWizard:function(){return WizardManager.getWizardManager('SAIKU_OLAP_WIZARD').render();},apply:function(){WizardManager.getWizardManager('SAIKU_OLAP_WIZARD').apply();}});CDFDDDatasourcesArray.push(new SaikuOlapWizardEntry());var WizardFunctionsManager=Base.extend({},{FunctionTypes:{},WizardFunctionsArray:{},register:function(FunctionType){WizardFunctionsManager.FunctionTypes[FunctionType.getType()]=FunctionType;},registerWizardFunctions:function(wizardFunctions){WizardFunctionsManager.WizardFunctionsArray[wizardFunctions.type]=wizardFunctions;},getFunction:function(FunctionType){return WizardFunctionsManager.FunctionTypes[FunctionType];},getWizardFunctions:function(wizardFunctions){return WizardFunctionsManager.WizardFunctionsArray[wizardFunctions];}});var PromptFunction=Base.extend({type:"",parent:"",name:"",value:"",setType:function(type){this.type=type},getType:function(){return this.type},setParent:function(parent){this.parent=parent},getParent:function(){return this.parent},setName:function(type){this.name=name},getName:function(){return this.name},setValue:function(value){this.value=value},getValue:function(){return typeof this.value=='function'?this.value():this.value}});var JavascriptDecodeURIFunction=PromptFunction.extend({type:"decodeURI",parent:"Functions",name:"decodeURI",value:"decodeURI(stringValue)"});WizardFunctionsManager.register(new JavascriptDecodeURIFunction());var JavascriptToStringFunction=PromptFunction.extend({type:"toString",parent:"String Functions",name:"ToString",value:".toString()"});WizardFunctionsManager.register(new JavascriptToStringFunction());var JavascriptSubStringFunction=PromptFunction.extend({type:"subString",parent:"String Functions",name:"SubString",value:".substring(start,stop)"});WizardFunctionsManager.register(new JavascriptSubStringFunction());var JavascriptClickFunction=PromptFunction.extend({type:"click",parent:"Event Handlers",name:"Click",value:".click(function() { /* INSERT CODE HERE */ })"});WizardFunctionsManager.register(new JavascriptClickFunction());var MdxAndOperator=PromptFunction.extend({type:"and",parent:"Operators",name:"AND",value:"Expression1 AND Expression2"});WizardFunctionsManager.register(new MdxAndOperator());var MdxDescendantsFunction=PromptFunction.extend({type:"descendants",parent:"Functions",name:"Descendants",value:"Descendants(Member_Expression [ , Level_Expression [ ,Desc_Flag ] ] )"});WizardFunctionsManager.register(new MdxDescendantsFunction());var SqlFormatFunction=PromptFunction.extend({type:"format",parent:"Scalar",name:"FORMAT",value:"FORMAT(column_name,format)"});WizardFunctionsManager.register(new SqlFormatFunction());var JavascriptWizardFunctions=Base.extend({type:"JavascriptWizard",getFunctions:function(){var Functions=[];Functions.push(WizardFunctionsManager.getFunction("toString"));Functions.push(WizardFunctionsManager.getFunction("subString"));Functions.push(WizardFunctionsManager.getFunction("click"));Functions.push(WizardFunctionsManager.getFunction("eval"));Functions.push(WizardFunctionsManager.getFunction("decodeURI"));return Functions;}});WizardFunctionsManager.registerWizardFunctions(new JavascriptWizardFunctions());var MdxWizardFunctions=Base.extend({type:"MdxWizard",getFunctions:function(){var Functions=[];Functions.push(WizardFunctionsManager.getFunction("and"));Functions.push(WizardFunctionsManager.getFunction("descendants"));return Functions;}});WizardFunctionsManager.registerWizardFunctions(new MdxWizardFunctions());var SqlWizardFunctions=Base.extend({type:"SqlWizard",getFunctions:function(){var Functions=[];Functions.push(WizardFunctionsManager.getFunction("format"));return Functions;}});WizardFunctionsManager.registerWizardFunctions(new SqlWizardFunctions());var CdaWizardFunctions=Base.extend({type:"CdaWizard",getFunctions:function(){var Functions=[];return Functions;}});WizardFunctionsManager.registerWizardFunctions(new CdaWizardFunctions());var PromptWizardManager=Base.extend({},{WizardsArray:{},register:function(wizardType){PromptWizardManager.WizardsArray[wizardType.getId()]=wizardType;},getWizard:function(wizardType){return PromptWizardManager.WizardsArray[wizardType];}});var PromptWizard=WizardManager.extend({wizardId:"PROMPT_WIZARD",title:"Prompt Wizard",hasFunctions:true,hasParameters:true,constructor:function(){this.base();this.logger=new Logger("PromptWizard");this.functions=[];},getId:function(){return this.wizardId;},setInvoker:function(invoker){this.invoker=invoker;},getPropertyValue:function(id){return this.invoker.getPropertyValue(id)},getFunctionValue:function(_function){this.logger.warn("PromptWizard: Method not implmemented");return"";},getParameterValue:function(parameterProperties){this.logger.warn("PromptWizard: Method not implmemented");return"";},renderWizard:function(){$("#cdfdd-wizard-button-ok").removeAttr("disabled");var leftSectionContent=$('\n'+'    <div class="cdfdd-wizard-prompt-left-section span-5 last round">\n'+'    </div>');if(this.hasFunctions)
leftSectionContent.append('\n'+'     <table id="prompt-wizard-functions" class="prompt-wizard-functions">\n'+'       <tbody class="ui-widget-content">\n'+'       </tbody>\n'+'       </table>');if(this.hasParameters)
leftSectionContent.append('\n'+'     <table id="prompt-wizard-parameters" class="">\n'+'       <tbody class="ui-widget-content">\n'+'       </tbody>\n'+'       </table>');var centerSectionContent='\n'+'    <div class="cdfdd-wizard-prompt-center-section span-19 last round">\n'+'     <div class="span-18">\n'+'      <textarea  class="prompt-wizard-textarea" >'+this.invoker.getValue()+'</textarea>\n'+'     </div>\n'+'    </div>';$("#"+WizardManager.WIZARD_LEFT_SECTION).append(leftSectionContent);$("#"+WizardManager.WIZARD_CENTER_SECTION).append(centerSectionContent);$(".round","#"+WizardManager.WIZARD_BODY).corner();this.renderLeftPanel();},renderLeftPanel:function(){if(this.hasFunctions){var functionsTBody=$("#prompt-wizard-functions > tbody");functionsTBody.empty();functionsTBody.append("<tr id='functions' class='ui-state-hover expanded'><td>Functions</td></tr>");var myself=this;$.each(this.functions,function(i,_function){var parentId="function-"+_function.parent.replace(/ /g,"_").toLowerCase();if($("#"+parentId).length==0)
functionsTBody.append("<tr id='"+parentId+"' class='child-of-functions prompt-wizard-elements small' ><td>"+_function.parent+"</td></tr>");var jsFunction=$("'<td class='draggableLevel'>"+_function.name+"</td>'");functionsTBody.append($("<tr id='"+_function.type+"' class='child-of-"+parentId+" prompt-wizard-elements small'></tr>").append(jsFunction));jsFunction.click(function(){$(".prompt-wizard-textarea").insertAtCaret(myself.getFunctionValue(_function));return false});});functionsTBody.parent().treeTable();}
if(this.hasParameters){var parameters=Panel.getPanel(ComponentsPanel.MAIN_PANEL).getParameters();var parametersTBody=$("#prompt-wizard-parameters > tbody");parametersTBody.empty();parametersTBody.append("<tr id='parameters' class='ui-state-hover expanded'><td>Parameters</td></tr>");var myself=this;var parameterIdx=0;$.each(parameters,function(i,param){if(myself.getPropertyValue("name")!=param.properties[0].value){var parameterId="parmeter-"+(++parameterIdx);var parentId="parameter-"+param.properties[1].type.replace(/ /g,"_").toLowerCase();if($("#"+parentId).length==0)
parametersTBody.append("<tr id='"+parentId+"' class='child-of-parameters prompt-wizard-elements small' ><td>"+param.properties[1].type+"</td></tr>");var parameter=$("<td>"+param.properties[0].value+"</td>");parametersTBody.append($("<tr id='"+parameterId+"' class='child-of-"+parentId+" prompt-wizard-elements small'></tr>").append(parameter));parameter.click(function(){$(".prompt-wizard-textarea").insertAtCaret(myself.getParameterValue(param.properties));return false});}});parametersTBody.parent().treeTable();}},buttonOk:function(){this.apply();$('#'+WizardManager.MAIN_DIALOG).jqmHide();},buttonCancel:function(){$('#'+WizardManager.MAIN_DIALOG).jqmHide();},apply:function(){var value=$(".prompt-wizard-textarea").val();if(value.length!=0&&value.substr(value.length-1,1)!=" "){value=value+" ";}
this.invoker.promptCallback(value);}},{WIZARD_RIGHT_SECTION:"cdfdd-wizard-prompt-right-section",WIZARD_LEFT_SECTION:"cdfdd-wizard-prompt-left-section"});var AcePromptWizard=PromptWizard.extend({mode:'none',editor:null,EDITOR_ID:'wizardEditor',renderWizard:function(){$("#cdfdd-wizard-button-ok").removeAttr("disabled");var leftSectionContent=$('\n'+'   <div class="cdfdd-wizard-prompt-left-section span-5 last round">\n'+'   </div>');if(this.hasFunctions)
leftSectionContent.append('\n'+'    <table id="prompt-wizard-functions" class="prompt-wizard-functions">\n'+'      <tbody class="ui-widget-content">\n'+'      </tbody>\n'+'      </table>');if(this.hasParameters)
leftSectionContent.append('\n'+'    <table id="prompt-wizard-parameters" class="">\n'+'      <tbody class="ui-widget-content">\n'+'      </tbody>\n'+'      </table>');var centerSectionContent='\n'+'   <div class="cdfdd-wizard-prompt-center-section span-19 last round">\n'+'    <div class="span-18">\n'+'     <pre id="'+this.EDITOR_ID+'" style="position: relative;width: 750px;height: 400px;"> </pre>\n'+'    </div>\n'+'   </div>';$("#"+WizardManager.WIZARD_LEFT_SECTION).append(leftSectionContent);$("#"+WizardManager.WIZARD_CENTER_SECTION).append(centerSectionContent);$(".round","#"+WizardManager.WIZARD_BODY).corner();this.renderLeftPanel();},renderLeftPanel:function()
{if(this.hasFunctions){this.renderFunctions();}
if(this.hasParameters){this.renderParameters();}},renderFunctions:function()
{var functionsTBody=$("#prompt-wizard-functions > tbody");functionsTBody.empty();functionsTBody.append("<tr id='functions' class='ui-state-hover expanded'><td>Functions</td></tr>");var myself=this;$.each(this.functions,function(i,_function){if(_function!=null){var parentId="function-"+_function.parent.replace(/ /g,"_").toLowerCase();if($("#"+parentId).length==0)
functionsTBody.append("<tr id='"+parentId+"' class='child-of-functions prompt-wizard-elements small' ><td>"+_function.parent+"</td></tr>");var jsFunction=$("'<td class='draggableLevel'>"+_function.name+"</td>'");functionsTBody.append($("<tr id='"+_function.type+"' class='child-of-"+parentId+" prompt-wizard-elements small'></tr>").append(jsFunction));jsFunction.click(function(){myself.editor.insert(myself.getFunctionValue(_function));return false;});}});functionsTBody.parent().treeTable();},renderParameters:function()
{var parameters=Panel.getPanel(ComponentsPanel.MAIN_PANEL).getParameters();var parametersTBody=$("#prompt-wizard-parameters > tbody");parametersTBody.empty();parametersTBody.append("<tr id='parameters' class='ui-state-hover expanded'><td>Parameters</td></tr>");var myself=this;var parameterIdx=0;$.each(parameters,function(i,param){if(myself.getPropertyValue("name")!=param.properties[0].value){var parameterId="parmeter-"+(++parameterIdx);var parentId="parameter-"+param.properties[1].type.replace(/ /g,"_").toLowerCase();if($("#"+parentId).length==0)
parametersTBody.append("<tr id='"+parentId+"' class='child-of-parameters prompt-wizard-elements small' ><td>"+param.properties[1].type+"</td></tr>");var parameter=$("<td>"+param.properties[0].value+"</td>");parametersTBody.append($("<tr id='"+parameterId+"' class='child-of-"+parentId+" prompt-wizard-elements small'></tr>").append(parameter));parameter.click(function(){myself.editor.insert(myself.getParameterValue(param.properties));return false});}});parametersTBody.parent().treeTable();},postRenderWizard:function(){this.editor=new CodeEditor();this.editor.setMode(this.mode);this.editor.initEditor(this.EDITOR_ID);this.editor.setContents(this.invoker.getValue());},apply:function(){var value=this.editor.getContents();this.invoker.promptCallback(value);}});var JavascriptWizard=AcePromptWizard.extend({wizardId:"JAVASCRIPT_WIZARD",title:"Javascript Wizard",hasOlap:false,mode:'javascript',constructor:function(){this.base();this.logger=new Logger("JavascriptWizard");this.functions=WizardFunctionsManager.getWizardFunctions("JavascriptWizard").getFunctions();},getParameterValue:function(parameterProperties){return parameterProperties[0].value;},getFunctionValue:function(_function){return _function.value;}},{});PromptWizardManager.register(new JavascriptWizard());var MdxWizard=PromptWizard.extend({wizardId:"MDX_WIZARD",title:"Mdx Wizard",constructor:function(){this.base();this.logger=new Logger("MdxWizard");this.functions=WizardFunctionsManager.getWizardFunctions("MdxWizard").getFunctions();},getParameterValue:function(parameterProperties){return"${"+parameterProperties[0].value+"}";},getFunctionValue:function(_function){return _function.value;},getMdxValue:function(level){return level.defaultMemberQualifiedName!=undefined?level.defaultMemberQualifiedName:level.qualifiedName;},buttonPreview:function(){var myself=this;var queryDefinition={queryType:'mdx',topCount:10,jndi:myself.getPropertyValue("jndi"),catalog:myself.getPropertyValue("catalog"),query:$(".prompt-wizard-textarea").val()};PivotLinkComponent.openPivotLink({pivotDefinition:queryDefinition});},renderWizard:function(){this.base();$("."+PromptWizard.WIZARD_LEFT_SECTION).append('\n'+'    <table id="prompt-wizard-olap" class="prompt-wizard-olap">\n'+'     <thead>\n'+'     </thead>\n'+'     <tbody class="ui-widget-content">\n'+'     </tbody>\n'+'     </table>');$(".cdfdd-wizard-buttons form").prepend('<input id="cdfdd-wizard-button-preview" type="button" onclick="PromptWizardManager.getWizard(\''+this.wizardId+'\').buttonPreview()" value="Preview"></input>');var params={operation:"GetCubeStructure",catalog:this.getPropertyValue("catalog"),cube:this.getPropertyValue("cube"),jndi:this.getPropertyValue("jndi")};var myself=this;this.logger.debug("Getting olap:");this.logger.debug("Catalog:"+params.catalog);this.logger.debug("Cube:"+params.cube);this.logger.debug("Jndi:"+params.jndi);$.getJSON(CDFDDServerUrl+"OlapUtils",params,function(json){if(json.status=="true"){var dimensions=json.result.dimensions;var measures=json.result.measures;var olapIdx=0;var dimensionTBody=$("#prompt-wizard-olap > tbody");dimensionTBody.empty();dimensionTBody.append("<tr id='olap' class='ui-state-hover expanded'><td>Olap:</td></tr>");$.each(dimensions,function(i,dimension){var hierarchies=dimension.hierarchies;$.each(hierarchies,function(j,hierarchy){var hierarchyId="dimRow-"+(++olapIdx);var dim=$('<td>'+hierarchy.name+'</td>');dimensionTBody.append($("<tr id='"+hierarchyId+"' class='child-of-olap prompt-wizard-elements small'></tr>").append(dim));dim.bind("click",function(e){if($(e.originalTarget).find("span").length>0)$(".prompt-wizard-textarea").insertAtCaret(myself.getMdxValue(hierarchy));return false;});var levels=hierarchy.levels;$.each(levels,function(k,level){var levelId="dimRow-"+(++olapIdx);var dimLevel=$('<td>'+level.name+'</td>');dimensionTBody.append($("<tr id='"+levelId+"' class='child-of-"+hierarchyId+" prompt-wizard-elements small'></tr>").append(dimLevel));dimLevel.click(function(){$(".prompt-wizard-textarea").insertAtCaret(myself.getMdxValue(level));return false});});});});dimensionTBody.append("<tr id='olap-mesaures' class='child-of-olap prompt-wizard-elements small'><td>Measures</td></tr>");$.each(measures,function(i,m){var measure=$('<td>'+m.name+'</td>');var measureId="dimMeasure-"+(++olapIdx);dimensionTBody.append($("<tr id='"+measureId+"' class='child-of-olap-mesaures prompt-wizard-elements small'></tr>").append(measure));measure.click(function(){$(".prompt-wizard-textarea").insertAtCaret(myself.getMdxValue(m));return false});})
dimensionTBody.parent().treeTable();}});}},{});PromptWizardManager.register(new MdxWizard());var SqlWizard=AcePromptWizard.extend({wizardId:"SQL_WIZARD",title:"Sql Wizard",hasOlap:false,mode:'sql',constructor:function(){this.base();this.logger=new Logger("SqlWizard");this.functions=WizardFunctionsManager.getWizardFunctions("SqlWizard").getFunctions();},getParameterValue:function(parameterProperties){return parameterProperties[0].value;},getFunctionValue:function(_function){return _function.value;}},{});PromptWizardManager.register(new SqlWizard());var CdaWizard=AcePromptWizard.extend({wizardId:"CDA_WIZARD",title:"CDA Wizard",hasOlap:false,mode:'xml',constructor:function(){this.base();this.logger=new Logger("CdaWizard");this.functions=WizardFunctionsManager.getWizardFunctions("CdaWizard").getFunctions();},getParameterValue:function(parameterProperties){return parameterProperties[0].value;},getFunctionValue:function(_function){return _function.value;}},{});PromptWizardManager.register(new CdaWizard());var FilterBlockModel=BaseModel.extend({},{MODEL:'FilterBlock',getStub:function(){var _stub={id:TableManager.generateGUID(),type:FilterBlockModel.MODEL,typeDesc:"Filter Block",parent:IndexManager.ROOTID,properties:[]};_stub.properties.push(PropertiesManager.getProperty("name"));return _stub;}});BaseModel.registerModel(FilterBlockModel);var FilterRowModel=BaseModel.extend({},{MODEL:'FilterRow',getStub:function(){var _stub={id:TableManager.generateGUID(),type:FilterRowModel.MODEL,typeDesc:"Filter Row",parent:IndexManager.ROOTID,properties:[]};_stub.properties.push(PropertiesManager.getProperty("name"));_stub.properties.push(PropertiesManager.getProperty("label"));return _stub;}});BaseModel.registerModel(FilterRowModel);var FilterHeaderModel=BaseModel.extend({},{MODEL:'FilterHeader',getStub:function(){var _stub={id:TableManager.generateGUID(),type:FilterHeaderModel.MODEL,typeDesc:"Filter Header",parent:IndexManager.ROOTID,properties:[]};_stub.properties.push(PropertiesManager.getProperty("name"));_stub.properties.push(PropertiesManager.getProperty("title"));return _stub;}});BaseModel.registerModel(FilterHeaderModel);var LayoutAddFilterBlockOperation=AddRowOperation.extend({id:"LAYOUT_ADD_FILTER_BLOCK_MODEL",types:[],name:"Add a Filter Block",description:"Add a block in which to add your filters",icon:"getResource?resource=/images/NAV/FILTERPAGE.png",hoverIcon:"getResource?resource=/images/NAV/FILTERPAGE_mouseover.png",clickIcon:"getResource?resource=/images/NAV/FILTERPAGE_onclick.png",constructor:function(){this.logger=new Logger("LayoutAddFilterBlockOperation");},execute:function(tableManager){var _stub=FilterBlockModel.getStub();var indexManager=tableManager.getTableModel().getIndexManager();var insertAtIdx=0;tableManager.insertAtIdx(_stub,insertAtIdx);if(typeof tableManager.getLinkedTableManager()!='undefined'){$("table#"+tableManager.getLinkedTableManager().getTableId()+" > tbody > tr:first > td:eq(1)").trigger('click');}}});CellOperations.registerOperation(new LayoutAddFilterBlockOperation());var LayoutAddFilterRowOperation=AddRowOperation.extend({id:"LAYOUT_ADD_PARAMETER_ROW",types:[FilterBlockModel.MODEL,FilterHeaderModel.MODEL,FilterRowModel.MODEL],name:"Add Filter Row",description:"Add a new row for a parameter selector",icon:"getResource?resource=/images/NAV/FILTERLINE.png",hoverIcon:"getResource?resource=/images/NAV/FILTERLINE_mouseover.png",clickIcon:"getResource?resource=/images/NAV/FILTERLINE_onclick.png",constructor:function(){this.logger=new Logger("LayoutAddFilterRowOperation");},execute:function(tableManager){var insertAtIdx;if(tableManager.isSelectedCell){var indexManager=tableManager.getTableModel().getIndexManager();var rowIdx,colIdx,rowId,rowType;rowIdx=tableManager.getSelectedCell()[0];colIdx=tableManager.getSelectedCell()[1];rowId=tableManager.getTableModel().getEvaluatedId(rowIdx);rowType=tableManager.getTableModel().getEvaluatedRowType(rowIdx),_stub=FilterRowModel.getStub();var nextSibling=indexManager.getNextSibling(rowId);if(typeof nextSibling=='undefined'){insertAtIdx=indexManager.getLastChild(rowId).index+1;}else{insertAtIdx=nextSibling.index;}
if(rowType==FilterHeaderModel.MODEL||rowType==FilterRowModel.MODEL){_stub.parent=indexManager.getIndex()[rowId].parent;}
else if(rowType==FilterBlockModel.MODEL){_stub.parent=rowId;}
else{insertAtIdx=-1;}}else{insertAtIdx=tableManager.getTableModel().getData().length;}
this.logger.debug("Inserting row at "+insertAtIdx);tableManager.insertAtIdx(_stub,insertAtIdx);if(typeof tableManager.getLinkedTableManager()!='undefined'){$("table#"+tableManager.getLinkedTableManager().getTableId()+" > tbody > tr:first > td:eq(1)").trigger('click');}}});CellOperations.registerOperation(new LayoutAddFilterRowOperation());var LayoutAddFilterHeaderOperation=AddRowOperation.extend({id:"LAYOUT_ADD_FILTER_HEADER",types:[FilterBlockModel.MODEL,FilterHeaderModel.MODEL,FilterRowModel.MODEL],name:"Add Filter Header",description:"Add a new group header for the filters panel",icon:"getResource?resource=/images/NAV/FILTERGROUPHEADER.png",hoverIcon:"getResource?resource=/images/NAV/FILTERGROUPHEADER_mouseover.png",clickIcon:"getResource?resource=/images/NAV/FILTERGROUPHEADER_onclick.png",constructor:function(){this.logger=new Logger("LayoutAddFilterHeaderOperation");},execute:function(tableManager){var insertAtIdx;if(tableManager.isSelectedCell){var indexManager=tableManager.getTableModel().getIndexManager();var rowIdx,colIdx,rowId,rowType;rowIdx=tableManager.getSelectedCell()[0];colIdx=tableManager.getSelectedCell()[1];rowId=tableManager.getTableModel().getEvaluatedId(rowIdx);rowType=tableManager.getTableModel().getEvaluatedRowType(rowIdx),_stub=FilterHeaderModel.getStub();var nextSibling=indexManager.getNextSibling(rowId);if(typeof nextSibling=='undefined'){insertAtIdx=indexManager.getLastChild(rowId).index+1;}else{insertAtIdx=nextSibling.index;}
if(rowType==FilterHeaderModel.MODEL||rowType==FilterRowModel.MODEL){_stub.parent=indexManager.getIndex()[rowId].parent;}
else if(rowType==FilterBlockModel.MODEL){_stub.parent=rowId;}
else{insertAtIdx=-1;}}else{insertAtIdx=tableManager.getTableModel().getData().length;}
this.logger.debug("Inserting row at "+insertAtIdx);tableManager.insertAtIdx(_stub,insertAtIdx);if(typeof tableManager.getLinkedTableManager()!='undefined'){$("table#"+tableManager.getLinkedTableManager().getTableId()+" > tbody > tr:first > td:eq(1)").trigger('click');}}});CellOperations.registerOperation(new LayoutAddFilterHeaderOperation());var LayoutCarouselModel=BaseModel.extend({},{MODEL:'LayoutCarousel',getStub:function(){var _stub={id:TableManager.generateGUID(),type:LayoutCarouselModel.MODEL,typeDesc:"Carousel",parent:IndexManager.ROOTID,properties:[]};_stub.properties.push(PropertiesManager.getProperty("name"));_stub.properties.push(PropertiesManager.getProperty("showTitle"));return _stub;}});BaseModel.registerModel(LayoutCarouselModel);var LayoutAddCarouselOperation=AddRowOperation.extend({id:"LAYOUT_ADD_CAROUSEL",types:[],name:"Add Carousel",description:"Add a new carousel that cycles between components",icon:"getResource?resource=/images/NAV/ADDCAROUSEL.png",hoverIcon:"getResource?resource=/images/NAV/ADDCAROUSEL_mouseover.png",clickIcon:"getResource?resource=/images/NAV/ADDCAROUSEL_onclick.png",constructor:function(){this.logger=new Logger("LayoutAddCarouselOperation");},execute:function(tableManager){var insertAtIdx;if(tableManager.isSelectedCell){var indexManager=tableManager.getTableModel().getIndexManager();var rowIdx,colIdx,rowId,rowType;rowIdx=tableManager.getSelectedCell()[0];colIdx=tableManager.getSelectedCell()[1];rowId=tableManager.getTableModel().getEvaluatedId(rowIdx);rowType=tableManager.getTableModel().getEvaluatedRowType(rowIdx);var nextSibling=indexManager.getNextSibling(rowId);if(typeof nextSibling=='undefined'){insertAtIdx=indexManager.getLastChild(rowId).index+1;}else{insertAtIdx=nextSibling.index;}}else{insertAtIdx=tableManager.getTableModel().getData().length;}
var _stub=LayoutCarouselModel.getStub();this.logger.debug("Inserting row at "+insertAtIdx);tableManager.insertAtIdx(_stub,insertAtIdx);if(typeof tableManager.getLinkedTableManager()!='undefined'){$("table#"+tableManager.getLinkedTableManager().getTableId()+" > tbody > tr:first > td:eq(1)").trigger('click');}}});CellOperations.registerOperation(new LayoutAddCarouselOperation());var LayoutCarouselItemModel=BaseModel.extend({},{MODEL:'LayoutCarouselItem',getStub:function(){var _stub={id:TableManager.generateGUID(),type:LayoutCarouselItemModel.MODEL,typeDesc:"Carousel Item",parent:IndexManager.ROOTID,properties:[]};_stub.properties.push(PropertiesManager.getProperty("name"));_stub.properties.push(PropertiesManager.getProperty("title"));return _stub;}});BaseModel.registerModel(LayoutCarouselItemModel);var LayoutAddCarouselItemOperation=AddRowOperation.extend({id:"LAYOUT_ADD_CAROUSEL_ITEM",types:[LayoutCarouselModel.MODEL],name:"Add Carousel Item",description:"Add a new item to a carousel",icon:"getResource?resource=/images/NAV/ADDCAROUSEL_ITEM.png",hoverIcon:"getResource?resource=/images/NAV/ADDCAROUSEL_ITEM_mouseover.png",clickIcon:"getResource?resource=/images/NAV/ADDCAROUSEL_ITEM_onclick.png",constructor:function(){this.logger=new Logger("LayoutAddCarouselItemOperation");},execute:function(tableManager){var insertAtIdx;if(tableManager.isSelectedCell){var indexManager=tableManager.getTableModel().getIndexManager();var rowIdx,colIdx,rowId,rowType;rowIdx=tableManager.getSelectedCell()[0];colIdx=tableManager.getSelectedCell()[1];rowId=tableManager.getTableModel().getEvaluatedId(rowIdx);rowType=tableManager.getTableModel().getEvaluatedRowType(rowIdx),_stub=LayoutCarouselItemModel.getStub();var nextSibling=indexManager.getNextSibling(rowId);if(typeof nextSibling=='undefined'){insertAtIdx=indexManager.getLastChild(rowId).index+1;}else{insertAtIdx=nextSibling.index;}
if(rowType==LayoutCarouselItemModel.MODEL){_stub.parent=indexManager.getIndex()[rowId].parent;}
else if(rowType==LayoutCarouselModel.MODEL){_stub.parent=rowId;}
else{insertAtIdx=-1;}}else{insertAtIdx=tableManager.getTableModel().getData().length;}
this.logger.debug("Inserting row at "+insertAtIdx);tableManager.insertAtIdx(_stub,insertAtIdx);if(typeof tableManager.getLinkedTableManager()!='undefined'){$("table#"+tableManager.getLinkedTableManager().getTableId()+" > tbody > tr:first > td:eq(1)").trigger('click');}}});CellOperations.registerOperation(new LayoutAddCarouselItemOperation());var LayoutPanel=Panel.extend({id:"layout",name:"Layout Panel",treeTable:{},treeTableModel:{},propertiesTable:{},propertiesTableModel:{},constructor:function(id){this.base(id);this.logger=new Logger("Layout");Panel.register(this);},init:function(){operationSets={blueprint:[new LayoutSaveAsTemplateOperation(),new LayoutApplyTemplateOperation(),new LayoutAddResourceOperation(),new LayoutAddRowOperation()],mobile:[new LayoutSaveAsTemplateOperation(),new LayoutApplyTemplateOperation(),new LayoutAddResourceOperation(),new LayoutAddCarouselOperation(),new LayoutAddRowOperation(),new LayoutAddFilterBlockOperation()]};this.base();this.logger.debug("Specific init");this.treeTable=new TableManager(LayoutPanel.TREE);this.treeTable.setTitle("Layout Structure");var dashboardType=cdfdd.dashboardWcdf.rendererType||"blueprint";this.treeTable.setInitialOperations(operationSets[dashboardType]);var treeTableModel=new TableModel('layoutTreeTableModel');treeTableModel.setColumnNames(['Type','Name']);treeTableModel.setColumnGetExpressions([function(row){return row.typeDesc},function(row){return row.properties[0].value}]);treeTableModel.setColumnTypes(['String','String']);treeTableModel.setRowId(function(row){return row.id});treeTableModel.setRowType(function(row){return row.type});treeTableModel.setParentId(function(row){return row.parent});treeTableModel.setData(cdfdd.getDashboardData().layout.rows);this.treeTable.setTableModel(treeTableModel);this.treeTable.init();this.propertiesTable=new TableManager(LayoutPanel.PROPERTIES);this.propertiesTable.setTitle("Properties");var propertiesTableModel=new PropertiesTableModel('layoutPropertiesTableModel');propertiesTableModel.setColumnSetExpressions([undefined,function(row,value){row.value=value
if(row.name=='name'){var _tableManager=TableManager.getTableManager("table-"+LayoutPanel.TREE);this.logger.debug("Changing the name - applying to previous row in "+_tableManager+" in row "+_tableManager.getSelectedCell()[0]);var _cell=_tableManager.getSelectedCell();$("#"+_tableManager.getTableId()+" > tbody > tr:eq("+_cell[0]+") > td:eq(1)").text(value);}}]);this.propertiesTable.setTableModel(propertiesTableModel);this.propertiesTable.init();this.treeTable.setLinkedTableManager(this.propertiesTable);this.treeTable.setLinkedTableManagerOperation(function(row){var arr=[];for(p in row.properties){arr.push(row.properties[p]);}
return arr;});},getContent:function(){return' \n'+'   <div id="'+LayoutPanel.TREE+'" class="span-12">Tree</div>\n'+'   <div id="'+LayoutPanel.PROPERTIES+'" class="span-12 last">Properties</div>\n'+'   ';},getHtmlObjects:function(){var data=this.treeTable.getTableModel().getData();var output=[];var myself=this;$.each(data,function(i,row){if(row.type==LayoutRowModel.MODEL||row.type==LayoutColumnModel.MODEL){if(myself.treeTable.getTableModel().getIndexManager().getIndex()[row.id].children.length==0){output.push(row);}}});return output;}},{MAIN_PANEL:"layout_panel",TREE:"cdfdd-layout-tree",PROPERTIES:"cdfdd-layout-properties"});var LayoutRowModel=BaseModel.extend({},{MODEL:'LayoutRow',getStub:function(){var _stub={id:TableManager.generateGUID(),type:LayoutRowModel.MODEL,typeDesc:"Row",parent:IndexManager.ROOTID,properties:[]};_stub.properties.push(PropertiesManager.getProperty("name"));_stub.properties.push(PropertiesManager.getProperty("height"));_stub.properties.push(PropertiesManager.getProperty("backgroundColor"));_stub.properties.push(PropertiesManager.getProperty("roundCorners"));_stub.properties.push(PropertiesManager.getProperty("cssClass"));_stub.properties.push(PropertiesManager.getProperty("textAlign"));return _stub;}});BaseModel.registerModel(LayoutRowModel);var LayoutAddRowOperation=AddRowOperation.extend({id:"LAYOUT_ADD_ROW",types:[],name:"Add Row",description:"Add a new row",icon:"getResource?resource=/images/NAV/addrow.png",hoverIcon:"getResource?resource=/images/NAV/addrow_mouseover.png",clickIcon:"getResource?resource=/images/NAV/addrow_onclick.png",constructor:function(){this.logger=new Logger("LayoutAddRowOperation");},execute:function(tableManager){var _stub=LayoutRowModel.getStub();var rowIdx;var colIdx=0;var rowId;var rowType;var insertAtIdx=-1;var indexManager=tableManager.getTableModel().getIndexManager();if(tableManager.isSelectedCell){rowIdx=tableManager.getSelectedCell()[0];colIdx=tableManager.getSelectedCell()[1];rowId=tableManager.getTableModel().getEvaluatedId(rowIdx);rowType=tableManager.getTableModel().getEvaluatedRowType(rowIdx);var nextSibling=indexManager.getNextSibling(rowId);if(typeof nextSibling=='undefined'){insertAtIdx=indexManager.getLastChild(rowId).index+1;}
else{insertAtIdx=nextSibling.index;}
if(rowType==LayoutRowModel.MODEL||rowType==LayoutSpaceModel.MODEL){_stub.parent=indexManager.getIndex()[rowId].parent;}
else if(rowType==LayoutColumnModel.MODEL){_stub.parent=rowId;}
else{insertAtIdx=tableManager.getTableModel().getData().length;}}
else{insertAtIdx=tableManager.getTableModel().getData().length;}
this.logger.debug("Inserting row after "+rowType+" at "+insertAtIdx);tableManager.insertAtIdx(_stub,insertAtIdx);if(typeof tableManager.getLinkedTableManager()!='undefined'){$("table#"+tableManager.getLinkedTableManager().getTableId()+" > tbody > tr:first > td:eq(1)").trigger('click');}}});CellOperations.registerOperation(new LayoutAddRowOperation());var LayoutColumnModel=BaseModel.extend({},{MODEL:'LayoutColumn',getStub:function(){var _stub={id:TableManager.generateGUID(),type:LayoutColumnModel.MODEL,typeDesc:"Column",parent:IndexManager.ROOTID,properties:[]};_stub.properties.push(PropertiesManager.getProperty("name"));_stub.properties.push(PropertiesManager.getProperty("columnSpan"));_stub.properties.push(PropertiesManager.getProperty("columnPrepend"));_stub.properties.push(PropertiesManager.getProperty("columnAppend"));_stub.properties.push(PropertiesManager.getProperty("columnPrependTop"));_stub.properties.push(PropertiesManager.getProperty("columnAppendBottom"));_stub.properties.push(PropertiesManager.getProperty("columnBorder"));_stub.properties.push(PropertiesManager.getProperty("columnBigBorder"));_stub.properties.push(PropertiesManager.getProperty("backgroundColor"));_stub.properties.push(PropertiesManager.getProperty("roundCorners"));_stub.properties.push(PropertiesManager.getProperty("height"));_stub.properties.push(PropertiesManager.getProperty("cssClass"));_stub.properties.push(PropertiesManager.getProperty("textAlign"));return _stub;}});BaseModel.registerModel(LayoutColumnModel);var LayoutAddColumnsOperation=AddRowOperation.extend({id:"LAYOUT_ADD_COLUMN",types:[LayoutRowModel.MODEL,LayoutColumnModel.MODEL],name:"Add Columns",description:"Add a new column",icon:"getResource?resource=/images/NAV/addcolumn.png",hoverIcon:"getResource?resource=/images/NAV/addcolumn_mouseover.png",clickIcon:"getResource?resource=/images/NAV/addcolumn_onclick.png",constructor:function(){this.logger=new Logger("LayoutAddColumnsOperation");},execute:function(tableManager){var _stub=LayoutColumnModel.getStub();var rowIdx;var colIdx=0;var rowId;var rowType;var insertAtIdx=-1;var indexManager=tableManager.getTableModel().getIndexManager();if(tableManager.isSelectedCell){rowIdx=tableManager.getSelectedCell()[0];colIdx=tableManager.getSelectedCell()[1];rowId=tableManager.getTableModel().getEvaluatedId(rowIdx);rowType=tableManager.getTableModel().getEvaluatedRowType(rowIdx);var nextSibling=indexManager.getNextSibling(rowId);if(typeof nextSibling=='undefined'){insertAtIdx=indexManager.getLastChild(rowId).index+1;}
else{insertAtIdx=nextSibling.index;}
if(rowType==LayoutColumnModel.MODEL){_stub.parent=indexManager.getIndex()[rowId].parent;}
else if(rowType==LayoutRowModel.MODEL){_stub.parent=rowId;}
else{insertAtIdx=-1;}}
else{insertAtIdx=tableManager.getTableModel().getData().length;}
this.logger.debug("Inserting column after "+rowType+" at "+insertAtIdx);tableManager.insertAtIdx(_stub,insertAtIdx);if(typeof tableManager.getLinkedTableManager()!='undefined'){$("table#"+tableManager.getLinkedTableManager().getTableId()+" > tbody > tr:first > td:eq(1)").trigger('click');}}});CellOperations.registerOperation(new LayoutAddColumnsOperation());var LayoutSpaceModel=BaseModel.extend({},{MODEL:'LayoutSpace',getStub:function(){var _stub={id:TableManager.generateGUID(),type:LayoutSpaceModel.MODEL,typeDesc:"Space",parent:IndexManager.ROOTID,properties:[]};_stub.properties.push(PropertiesManager.getProperty("height"));_stub.properties.push(PropertiesManager.getProperty("backgroundColor"));_stub.properties.push(PropertiesManager.getProperty("cssClass"));return _stub;}});BaseModel.registerModel(LayoutSpaceModel);var LayoutAddSpaceOperation=AddRowOperation.extend({id:"LAYOUT_ADD_SPACE",types:[LayoutRowModel.MODEL],name:"Add Space",description:"Adds a horizontal rule",icon:"getResource?resource=/images/NAV/spacer.png",hoverIcon:"getResource?resource=/images/NAV/spacer_mouseover.png",clickIcon:"getResource?resource=/images/NAV/spacer_onclick.png",constructor:function(){this.logger=new Logger("LayoutAddSpaceOperation");},execute:function(tableManager){var _stub=LayoutSpaceModel.getStub();var indexManager=tableManager.getTableModel().getIndexManager();var rowIdx=tableManager.getSelectedCell()[0];var colIdx=tableManager.getSelectedCell()[1];var rowId=tableManager.getTableModel().getEvaluatedId(rowIdx);var insertAtIdx;var nextSibling=indexManager.getNextSibling(rowId);if(typeof nextSibling=='undefined'){insertAtIdx=indexManager.getLastChild(rowId).index+1;}
else{insertAtIdx=nextSibling.index;}
_stub.parent=indexManager.getIndex()[rowId].parent;this.logger.debug("Inserting space after at "+insertAtIdx);tableManager.insertAtIdx(_stub,insertAtIdx);}});CellOperations.registerOperation(new LayoutAddSpaceOperation());var LayoutImageModel=BaseModel.extend({},{MODEL:'LayoutImage',getStub:function(){var _stub={id:TableManager.generateGUID(),type:LayoutImageModel.MODEL,typeDesc:"Image",parent:IndexManager.ROOTID,properties:[]};_stub.properties.push(PropertiesManager.getProperty("url"));_stub.properties.push(PropertiesManager.getProperty("cssClass"));return _stub;}});BaseModel.registerModel(LayoutImageModel);var LayoutAddImageOperation=AddRowOperation.extend({id:"LAYOUT_ADD_IMAGE",types:[LayoutRowModel.MODEL,LayoutColumnModel.MODEL],name:"Add Image",description:"Adds an image",icon:"getResource?resource=/images/NAV/image.png",hoverIcon:"getResource?resource=/images/NAV/image_mouseover.png",clickIcon:"getResource?resource=/images/NAV/image_onclick.png",constructor:function(){this.logger=new Logger("LayoutAddImageOperation");},execute:function(tableManager){var _stub=LayoutImageModel.getStub();var indexManager=tableManager.getTableModel().getIndexManager();var rowIdx=tableManager.getSelectedCell()[0];var colIdx=tableManager.getSelectedCell()[1];var rowId=tableManager.getTableModel().getEvaluatedId(rowIdx);var insertAtIdx;var nextSibling=indexManager.getNextSibling(rowId);if(typeof nextSibling=='undefined'){insertAtIdx=indexManager.getLastChild(rowId).index+1;}
else{insertAtIdx=nextSibling.index;}
_stub.parent=rowId;this.logger.debug("Inserting space after at "+insertAtIdx);tableManager.insertAtIdx(_stub,insertAtIdx);if(typeof tableManager.getLinkedTableManager()!='undefined'){$("table#"+tableManager.getLinkedTableManager().getTableId()+" > tbody > tr:first > td:eq(1)").trigger('click');}}});CellOperations.registerOperation(new LayoutAddImageOperation());var LayoutHtmlModel=BaseModel.extend({},{MODEL:'LayoutHtml',getStub:function(){var _stub={id:TableManager.generateGUID(),type:LayoutHtmlModel.MODEL,typeDesc:"Html",parent:IndexManager.ROOTID,properties:[]};_stub.properties.push(PropertiesManager.getProperty("name"));_stub.properties.push(PropertiesManager.getProperty("html"));_stub.properties.push(PropertiesManager.getProperty("color"));_stub.properties.push(PropertiesManager.getProperty("fontSize"));_stub.properties.push(PropertiesManager.getProperty("cssClass"));return _stub;}});BaseModel.registerModel(LayoutHtmlModel);var LayoutAddHtmlOperation=AddRowOperation.extend({id:"LAYOUT_ADD_HTML",types:[LayoutRowModel.MODEL,LayoutColumnModel.MODEL],name:"Add Html",description:"Adds plain Html code to the template",icon:"getResource?resource=/images/NAV/html.png",hoverIcon:"getResource?resource=/images/NAV/html_mouseover.png",clickIcon:"getResource?resource=/images/NAV/html_onclick.png",constructor:function(){this.logger=new Logger("LayoutAddHtmlOperation");},execute:function(tableManager){var _stub=LayoutHtmlModel.getStub();var indexManager=tableManager.getTableModel().getIndexManager();var rowIdx=tableManager.getSelectedCell()[0];var colIdx=tableManager.getSelectedCell()[1];var rowId=tableManager.getTableModel().getEvaluatedId(rowIdx);var insertAtIdx;var nextSibling=indexManager.getNextSibling(rowId);if(typeof nextSibling=='undefined'){insertAtIdx=indexManager.getLastChild(rowId).index+1;}
else{insertAtIdx=nextSibling.index;}
_stub.parent=rowId;this.logger.debug("Inserting space after at "+insertAtIdx);tableManager.insertAtIdx(_stub,insertAtIdx);if(typeof tableManager.getLinkedTableManager()!='undefined'){$("table#"+tableManager.getLinkedTableManager().getTableId()+" > tbody > tr:first > td:eq(1)").trigger('click');}}});CellOperations.registerOperation(new LayoutAddHtmlOperation());var LayoutResourceModel=BaseModel.extend({},{MODEL:'LayoutResource',getStub:function(){var _stub={id:TableManager.generateGUID(),type:LayoutResourceModel.MODEL,typeDesc:"Resource",parent:IndexManager.ROOTID,properties:[]};_stub.properties.push(PropertiesManager.getProperty("name"));_stub.properties.push(PropertiesManager.getProperty("resourceType"));_stub.properties.push(PropertiesManager.getProperty("resourceFile"));_stub.properties.push(PropertiesManager.getProperty("resourceCode"));return _stub;}});BaseModel.registerModel(LayoutResourceModel);var LayoutResourceCodeModel=LayoutResourceModel.extend({},{MODEL:'LayoutResourceCode',getStub:function(){var _stub=LayoutResourceModel.getStub();_stub.type=this.MODEL;_stub.properties=[];_stub.properties.push(PropertiesManager.getProperty("name"));_stub.properties.push(PropertiesManager.getProperty("resourceType"));_stub.properties.push(PropertiesManager.getProperty("resourceCode"));return _stub;}});BaseModel.registerModel(LayoutResourceCodeModel);var LayoutResourceFileModel=LayoutResourceModel.extend({},{MODEL:'LayoutResourceFile',getStub:function(){var _stub=LayoutResourceModel.getStub();_stub.type=this.MODEL;_stub.properties=[];_stub.properties.push(PropertiesManager.getProperty("name"));_stub.properties.push(PropertiesManager.getProperty("resourceType"));_stub.properties.push(PropertiesManager.getProperty("resourceFile"));return _stub;}});BaseModel.registerModel(LayoutResourceFileModel);var LayoutAddResourceOperation=AddRowOperation.extend({id:"LAYOUT_ADD_RESOURCE",types:[],name:"Add Resource",description:"Adds a resource external file or code to the dashboard",icon:"getResource?resource=/images/NAV/addcomponent.png",hoverIcon:"getResource?resource=/images/NAV/addcomponent_mouseover.png",clickIcon:"getResource?resource=/images/NAV/addcomponent_onclick.png",constructor:function(){this.logger=new Logger("LayoutAddResourceOperation");},execute:function(tableManager){$.prompt('Resource Type:&nbsp;&nbsp;<select id="resourceType"><option value="Css">Css</option><option value="Javascript">Javascript</option></select>\n'+'        <select id="resourceSource"><option value="file">External File</option><option value="code">Code Snippet</option></select>',{buttons:{Ok:true,Cancel:false},submit:function(v){if(v){var resourceType=$("#resourceType").val();var resourceSource=$("#resourceSource").val();var _stub=(resourceSource=='file')?LayoutResourceFileModel.getStub():LayoutResourceCodeModel.getStub();_stub.properties[1].value=resourceType;var indexManager=tableManager.getTableModel().getIndexManager();var insertAtIdx=0;tableManager.insertAtIdx(_stub,insertAtIdx);if(typeof tableManager.getLinkedTableManager()!='undefined'){$("table#"+tableManager.getLinkedTableManager().getTableId()+" > tbody > tr:first > td:eq(1)").trigger('click');}}}});}});CellOperations.registerOperation(new LayoutAddResourceOperation());var LayoutMoveUpOperation=MoveUpOperation.extend({id:"LAYOUT_MOVE_UP",types:[LayoutRowModel.MODEL,LayoutColumnModel.MODEL,LayoutSpaceModel.MODEL,LayoutImageModel.MODEL,LayoutHtmlModel.MODEL,LayoutCarouselModel.MODEL,FilterBlockModel.MODEL,FilterRowModel.MODEL,FilterHeaderModel.MODEL],constructor:function(){this.logger=new Logger("LayoutMoveUpOperation");}});CellOperations.registerOperation(new LayoutMoveUpOperation);var LayoutMoveDownOperation=MoveDownOperation.extend({id:"LAYOUT_MOVE_DOWN",types:[LayoutRowModel.MODEL,LayoutColumnModel.MODEL,LayoutSpaceModel.MODEL,LayoutImageModel.MODEL,LayoutHtmlModel.MODEL,LayoutCarouselModel.MODEL,FilterBlockModel.MODEL,FilterRowModel.MODEL,FilterHeaderModel.MODEL],constructor:function(){this.logger=new Logger("LayoutMoveDownOperation");}});CellOperations.registerOperation(new LayoutMoveDownOperation);var LayoutDeleteOperation=DeleteOperation.extend({id:"LAYOUT_DELETE",types:[LayoutRowModel.MODEL,LayoutColumnModel.MODEL,LayoutSpaceModel.MODEL,LayoutImageModel.MODEL,LayoutHtmlModel.MODEL,LayoutResourceModel.MODEL,LayoutCarouselModel.MODEL,FilterBlockModel.MODEL,FilterRowModel.MODEL,FilterHeaderModel.MODEL],constructor:function(){this.logger=new Logger("LayoutDeleteOperation");}});CellOperations.registerOperation(new LayoutDeleteOperation);var LayoutApplyTemplateOperation=ApplyTemplateOperation.extend({id:"LAYOUT_ADD_TEMPLATE",constructor:function(){this.logger=new Logger("LayoutApplyTemplateOperation");},execute:function(tableManager){this.logger.info("Loading templates...");var loadParams={operation:"load"}
$.getJSON(CDFDDDataUrl.replace("Syncronize","SyncTemplates"),loadParams,function(json){if(json.status){templates=json.result;var selectTemplate=undefined;var myTemplatesCount=0;var _templates='<div class="templates"><a class="prev disabled"></a><div class="scrollable"><div id="thumbs" class="thumbs">';var _myTemplates='<div class="templates"><a class="prev disabled"></a><div class="scrollable"><div id="thumbs" class="thumbs">';for(v in templates){if(templates[v].type=="default")
_templates+='<div><img id="'+v+'" src="'+templates[v].img+'"/><p>'+templates[v].structure.layout.title+'</p></div>';else if(templates[v].type=="custom"){_myTemplates+='<div><img id="'+v+'" src="'+templates[v].img+'"/><p>'+templates[v].structure.layout.title+'</p></div>';myTemplatesCount++;}}
_templates+='</div></div><a class="next"></a></div>';_myTemplates+='</div></div><a class="next"></a></div>';var loaded=function(){selectTemplate=undefined;$("div.scrollable").scrollable({size:3,items:'#thumbs',hoverClass:'hover'});$(function(){$("div.scrollable:eq(0) div.thumbs div").bind('click',function(){selectTemplate=templates[$(this).find("img").attr("id")];});});};var callback=function(v,m,f){if(v==1&&selectTemplate!=undefined){$.prompt('Are you sure you want to load the template? ',{buttons:{Ok:true,Cancel:false},callback:function(v,m,f){if(v){cdfdd.dashboardData.layout=selectTemplate.structure.layout;cdfdd.layout.init();}}});}};var promptTemplates={loaded:loaded,buttons:myTemplatesCount>0?{MyTemplates:2,Ok:1,Cancel:0}:{Ok:1,Cancel:0},opacity:0.2,prefix:'greyJqi',callback:callback,submit:function(v,m,f){if(v!=2)return true;$.prompt.close();$.prompt(_myTemplates,promptMyTemplates);}};var promptMyTemplates={loaded:loaded,buttons:{Back:2,Ok:1,Cancel:0},opacity:0.2,prefix:'greyJqi',callback:callback,submit:function(v,m,f){if(v!=2)return true;$.prompt.close();$.prompt(_templates,promptTemplates);}};$.prompt(_templates,promptTemplates);}
else
$.notifyBar({html:"Error loading templates: "+json.result});});}});var LayoutSaveAsTemplateOperation=SaveAsTemplateOperation.extend({id:"LAYOUT_SAVEAS_TEMPLATE",constructor:function(){this.logger=new Logger("LayoutSaveAsTemplateOperation");},execute:function(tableManager){var file="";var title="Custom Template";var includeComponents=true;var includeDataSources=true;var myself=this;var content='\n'+'    <span><b>Template:</b></span><br/><hr/>\n'+'    <span id="fileLabel" >File Name:</span><br/><input class="cdf_settings_input" id="fileInput" type="text" value=""></input><br/>\n'+'    <span>Title:</span><br/><input class="cdf_settings_input" id="titleInput" type="text" value=""></input>\n'+'    <span>Include Components:</span><input type="checkbox" checked="yes" id="includeComponentsInput" value="true" />\n'+'    &nbsp&nbsp<span>Include Datasources:</span><input type="checkbox" checked="yes" id="includeDataSourcesInput" value="true" />';$.prompt(content,{buttons:{Save:true,Cancel:false},submit:function(v){title=$("#titleInput").val();file=$("#fileInput").val();includeComponents=$("#includeComponentsInput").attr("checked");includeDataSources=$("#includeDataSourcesInput").attr("checked");var validate=true
if(file.length==0){$("#fileLabel").css("color","red");$("#fileLabel").text("* File Name: (required)");validate=false;}
if(file.indexOf(".")!=-1&&(file.length<6||file.lastIndexOf(".cdfde")!=file.length-6)){$("#fileLabel").css("color","red");$("#fileLabel").text("* File Name: (Invalid file extension. Must be .cdfde)");validate=false;}
if(file.indexOf(".")==-1)
file+=".cdfde";return!v||validate;},callback:function(v,m,f){if(v){myself.logger.info("Saving template...");var template=Util.clone(cdfdd.getDashboardData());template.layout.title=title;if(!includeComponents)template.components.rows=[];if(!includeDataSources)template.datasources.rows=[];var templateParams={operation:"save",file:file,cdfstructure:JSON.stringify(template)};$.post(CDFDDDataUrl.replace("Syncronize","SyncTemplates"),templateParams,function(result){var json=Util.parseJsonResult(result);if(json.status=="true"){$.notifyBar({html:"Template saved successfully",delay:1000});}
else{$.notifyBar({html:"Errors saving template: "+json.result});}});}}});}});var CDFDDComponentsArray=[];var ComponentsPanel=Panel.extend({name:"Components Panel",componentsPallete:{},componentsTable:{},componentsTableModel:{},propertiesTable:{},propertiesTableModel:{},componentsArray:[],constructor:function(id){this.base(id);this.logger=new Logger("Components");Panel.register(this);},init:function(){this.base();this.logger.debug("Specific init");this.componentsPallete=new PalleteManager(ComponentsPanel.PALLETE);this.addPalleteEntries();this.componentsPallete.init();this.componentsTable=new TableManager(ComponentsPanel.COMPONENTS);this.componentsTable.setTitle("Components");this.componentsPallete.setLinkedTableManager(this.componentsTable);var componentsTableModel=new TableModel('componentsTreeTableModel');componentsTableModel.setColumnNames(['Type','Name']);componentsTableModel.setColumnGetExpressions([function(row){return row.typeDesc},function(row){return row.properties[0].value}]);componentsTableModel.setColumnTypes(['String','String']);componentsTableModel.setRowId(function(row){return row.id});componentsTableModel.setRowType(function(row){return row.type});componentsTableModel.setParentId(function(row){return row.parent});componentsTableModel.setData(cdfdd.getDashboardData().components.rows);this.componentsTable.setTableModel(componentsTableModel);this.componentsTable.init();this.propertiesTable=new TableManager(ComponentsPanel.PROPERTIES);this.propertiesTable.setTitle("Properties");var propertiesTableModel=new PropertiesTableModel('componentsPropertiesTableModel');propertiesTableModel.setColumnSetExpressions([undefined,function(row,value){row.value=value
if(row.name=='name'){var _tableManager=TableManager.getTableManager("table-"+ComponentsPanel.COMPONENTS);this.logger.debug("Changing the name - applying to previous row in "+_tableManager+" in row "+_tableManager.getSelectedCell()[0]);var _cell=_tableManager.getSelectedCell();$("#"+_tableManager.getTableId()+" > tbody > tr:eq("+_cell[0]+") > td:eq(1)").text(value);}}]);this.propertiesTable.setTableModel(propertiesTableModel);this.propertiesTable.hasAdvancedProperties=true;this.propertiesTable.init();this.componentsTable.setLinkedTableManager(this.propertiesTable);this.componentsTable.setLinkedTableManagerOperation(function(row,classType){var arr=[];for(p in row.properties){if(row.properties[p].classType==undefined||row.properties[p].classType==classType)
arr.push(row.properties[p]);}
return arr;});},getContent:function(){return' \n'+'   <div id="'+ComponentsPanel.PALLETE+'" class="span-6 accordion"></div>\n'+'   <div id="'+ComponentsPanel.COMPONENTS+'" class="span-8">Components</div>\n'+'   <div id="'+ComponentsPanel.PROPERTIES+'" class="span-10 last">Properties</div>\n'+'   ';},addPalleteEntries:function(){$.each(CDFDDComponentsArray,function(i,component){Panel.getPanel(ComponentsPanel.MAIN_PANEL).getComponentsPallete().addEntry(component);});},getParameters:function(){var data=this.componentsTable.getTableModel().getData();var output=[];$.each(data,function(i,row){if(row.type.match("Parameter")){output.push(row);}});return output;},getComponents:function(){return this.componentsTable.getTableModel().getData();},setComponentsPallete:function(componentsPallete){this.componentsPallete=componentsPallete;},getComponentsPallete:function(){return this.componentsPallete;},setComponentsArray:function(componentsArray){this.componentsArray=componentsArray;},getComponentsArray:function(){return this.componentsArray;}},{MAIN_PANEL:"componentens_panel",PALLETE:"cdfdd-components-pallete",PALLETE_ID:"cdfdd-components-palletePallete",COMPONENTS:"cdfdd-components-components",PROPERTIES:"cdfdd-components-properties"});var ComponentsDuplicateOperation=BaseOperation.extend({id:"COMPONENTS_DUPLICATE",types:["Components"],name:"Duplicate component",description:"Insert a clone of this component",icon:"getResource?resource=/images/NAV/addcomponent.png",hoverIcon:"getResource?resource=/images/NAV/addcomponent_mouseover.png",clickIcon:"getResource?resource=/images/NAV/addcomponent_onclick.png",constructor:function(){this.logger=new Logger("ComponentsDuplicateOperation");},canExecute:function(tableManager){return tableManager.isSelectedCell;},execute:function(tableManager){if(tableManager.isSelectedCell){var rowIdx=tableManager.getSelectedCell()[0];var originalRow=tableManager.getTableModel().getData()[rowIdx];var clonedRow=$.extend(true,{},originalRow);clonedRow.id=TableManager.generateGUID();tableManager.insertAtIdx(clonedRow,rowIdx);}}});CellOperations.registerOperation(new ComponentsDuplicateOperation);var ComponentsMoveUpOperation=MoveUpOperation.extend({id:"COMPONENTS_MOVE_UP",types:["Components"],constructor:function(){this.logger=new Logger("ComponentsMoveUpOperation");}});CellOperations.registerOperation(new ComponentsMoveUpOperation);var ComponentsMoveDownOperation=MoveDownOperation.extend({id:"COMPONENTS_MOVE_DOWN",types:["Components"],constructor:function(){this.logger=new Logger("ComponentsMoveDownOperation");}});CellOperations.registerOperation(new ComponentsMoveDownOperation);var ComponentsDeleteOperation=DeleteOperation.extend({id:"COMPONENTS_DELETE",types:["Components"],constructor:function(){this.logger=new Logger("ComponentsDeleteOperation");}});CellOperations.registerOperation(new ComponentsDeleteOperation);var ComponentValidations={};ComponentValidations.NAME_PROP_IDX=0;ComponentValidations.STATUS_ERROR='error';ComponentValidations.STATUS_OK='ok';ComponentValidations.STATUS_WARN='warn';ComponentValidations.aggregateStatus=function(overallStatus,validationStatus){if(validationStatus==null)return overallStatus;switch(overallStatus){case ComponentValidations.STATUS_OK:overallStatus=validationStatus;break;case ComponentValidations.STATUS_WARN:if(validationStatus==ComponentValidations.STATUS_ERROR){overallStatus=validationStatus;}
break;}
return overallStatus;};ComponentValidations.validateComponentNames=function(components){if(components==null)components=Panel.getPanel(ComponentsPanel.MAIN_PANEL).getComponents();var validations=[];var names={};for(var i=0;i<components.length;i++){var comp=components[i];if(comp.type!='Label'&&comp.properties!=undefined){var name=comp.properties[this.NAME_PROP_IDX].value;if(name==null||name==''){var msg='A Component of type "'+comp.typeDesc+'" doesn\'t have a name.';validations.push([ComponentValidations.STATUS_ERROR,msg]);}
else{if(names[name]!=undefined){var msg='A component of type "'+comp.typeDesc+'" has the same name "'+name+'" as a component of type "'+names[name]+'"';validations.push([ComponentValidations.STATUS_ERROR,msg]);}
names[name]=comp.typeDesc;}}}
if(validations.length>0){return{status:this.STATUS_ERROR,validations:validations};}
else{return{status:this.STATUS_OK,validations:[]};}};ComponentValidations.validateHtmlObjects=function(components){var statusMultipleHtmlObjRef=this.STATUS_ERROR;var statusNoHtmlObjRef=this.STATUS_WARN;var statusNoSuchHtmlObj=this.STATUS_WARN;if(components==null)components=Panel.getPanel(ComponentsPanel.MAIN_PANEL).getComponents();var htmlObjRefs={};var htmlObjects=Panel.getPanel(LayoutPanel.MAIN_PANEL).getHtmlObjects();for(var i=0;i<htmlObjects.length;i++){var htmlObj=htmlObjects[i];var objName=htmlObj.properties[this.NAME_PROP_IDX].value;if(objName!=null){htmlObjRefs[objName]=[];}}
var validations=[];var status=this.STATUS_OK;for(var i=0;i<components.length;i++){var comp=components[i];var compName=comp.properties[this.NAME_PROP_IDX].value;if(compName!='')for(p in comp.properties){if(comp.properties[p].name=='htmlObject'){var htmlObj=comp.properties[p].value;if(htmlObj==''||htmlObj==null){var msg='Component "'+compName+'" has no html object';validations.push([statusNoHtmlObjRef,msg]);status=this.aggregateStatus(status,statusNoHtmlObjRef);}
else{var objRefs=htmlObjRefs[htmlObj];if(objRefs==null){var msg='Component "'+compName+'" references inexistent html object "'+htmlObj+'"';validations.push([statusNoSuchHtmlObj,msg]);status=this.aggregateStatus(status,statusNoSuchHtmlObj);}
else{if(objRefs.length>0){var msg='Components "'+compName+'" and "'+objRefs[0]+'" have the same html object "'+htmlObj+'"';validations.push([statusMultipleHtmlObjRef,msg]);status=this.aggregateStatus(status,statusMultipleHtmlObjRef);}
objRefs.push(compName);}}}}}
return{status:status,validations:validations};};ComponentValidations.validateComponents=function(){var status=this.STATUS_OK;var validations=[];var nameValidations=this.validateComponentNames();status=this.aggregateStatus(status,nameValidations.status);validations=nameValidations.validations;var htmlObjValidations=this.validateHtmlObjects();status=this.aggregateStatus(status,htmlObjValidations.status);validations=validations.concat(htmlObjValidations.validations);var msg='Validations: <br/>';if(status==this.STATUS_OK){msg+='No obvious problems detected.';}
else{for(var i=0;i<validations.length;i++){msg+='<br/>';msg+='['+validations[i][0]+'] '+validations[i][1];}}
$.prompt(msg);};var ParameterEntry=PalleteEntry.extend({id:"PARAMETER_ENTRY",name:"Simple parameter",description:"Simple parameter",category:"GENERIC",categoryDesc:"Generic",getStub:function(){return ComponentsParameterModel.getStub();}});var ComponentsParameterModel=BaseModel.extend({},{MODEL:'ComponentsParameter',getStub:function(){var _stub={id:TableManager.generateGUID(),type:ComponentsParameterModel.MODEL,typeDesc:"Parameter",parent:IndexManager.ROOTID,properties:[]};_stub.properties.push(PropertiesManager.getProperty("name"));_stub.properties.push(PropertiesManager.getProperty("propertyValue"));_stub.properties.push(PropertiesManager.getProperty("bookmarkable"));return _stub;}});BaseModel.registerModel(ComponentsParameterModel);CDFDDComponentsArray.push(new ParameterEntry());var ComponentsOlapParameterModel=ComponentsParameterModel.extend({},{MODEL:'ComponentsOlapParameter',getStub:function(){var _stub=ComponentsParameterModel.getStub();_stub.dimension="";return _stub;}});BaseModel.registerModel(ComponentsOlapParameterModel);var JavascriptParameterEntry=PalleteEntry.extend({id:"JAVASCRIPT_PARAMETER_ENTRY",name:"Custom parameter",description:"Custom parameter with javascript code",category:"GENERIC",categoryDesc:"Generic",getStub:function(){return ComponentsJavascriptParameterModel.getStub();}});var PromptRenderer=CellRenderer.extend({callback:null,editArea:null,value:null,constructor:function(tableManager){this.base(tableManager);this.logger=new Logger("PromptRenderer");this.logger.debug("Creating new PromptRenderer");this.wizard="PROMPT_WIZARD";},render:function(placeholder,value,callback){var _editArea=$('<td><div style="float:left"><code></code></div><div class="edit" style="float:right"></div></td>');_editArea.find("code").text(this.getFormattedValue(value));var myself=this;var _prompt=$('<button class="cdfddInput">...</button>').bind("click",function(){var wizard=PromptWizardManager.getWizard(myself.wizard);wizard.setInvoker(myself);myself.callback=callback;myself.editArea=_editArea;myself.value=value;wizard.render();}).appendTo($("div.edit",_editArea));_editArea.appendTo(placeholder);},validate:function(settings,original){return true;},getFormattedValue:function(_value){if(_value.length>30){_value=_value.substring(0,20)+" (...)";}
return _value;},getValue:function(){return this.value;},getPropertyValue:function(id){return this.getTableManager().getTableModel().getRowByName(id).value;},promptCallback:function(value){this.callback(value)
this.value=value;this.editArea.find("code").text(value.length>30?value.substring(0,20)+" (...)":value);}});var JavaScriptRenderer=PromptRenderer.extend({constructor:function(tableManager){this.base(tableManager);this.logger=new Logger("JavascriptRenderer");this.logger.debug("Creating new JascriptRenderer");this.wizard="JAVASCRIPT_WIZARD";}});var MdxQueryRenderer=PromptRenderer.extend({constructor:function(tableManager){this.base(tableManager);this.logger=new Logger("MdxQueryRenderer");this.logger.debug("Creating new MdxQueryRenderer");this.wizard="MDX_WIZARD";}});var SqlQueryRenderer=PromptRenderer.extend({constructor:function(tableManager){this.base(tableManager);this.logger=new Logger("SqlQueryRenderer");this.logger.debug("Creating new SqlQueryRenderer");this.wizard="SQL_WIZARD";}});var ValuesArrayRenderer=CellRenderer.extend({multiDimensionArray:true,cssPrefix:"StringList",hasTypedValues:false,typesArray:[],argTitle:'Arg',valTitle:'Value',constructor:function(tableManager){this.base(tableManager);this.logger=new Logger("ValuesArrayRenderer");this.logger.debug("Creating new ValuesArrayRenderer");},render:function(placeholder,value,callback){var _editArea=$("<td>"+(value.length>30?(value.substring(0,20)+" (...)"):value)+"</td>");var myself=this;_editArea.click(function(){var arrayValue=value;var content=$('\n'+'            <div id="'+myself.cssPrefix+'" class="'+myself.cssPrefix+'Container">\n'+'              <div class="'+myself.cssPrefix+'"></div>\n'+'              <input class="'+myself.cssPrefix+'AddButton" type="button" value="Add"></input>\n'+'            </div>');vals=JSON.parse(arrayValue);for(var i=0;i<vals.length;i++){myself.addParameter(i,vals[i],content);}
var index=vals.length;var wrapper=$("<div>",{id:myself.cssPrefix,'class':myself.cssPrefix+'Container'});wrapper.append(content);$.prompt(wrapper.html(),{buttons:{Ok:true,Cancel:false},prefix:'jqi'+myself.cssPrefix,callback:function(v,m,f){if(v){arrayValue=arrayValue.replace(/"null"/g,"null");callback(arrayValue);_editArea.text(arrayValue);}},loaded:function(){$('.'+myself.cssPrefix+'AddButton').bind('click',function(){if(myself.multiDimensionArray){myself.addParameter(index,["","",""],$("#"+myself.cssPrefix));}
else{myself.addParameter(index,"",$("#"+myself.cssPrefix));}
$("#remove_button_"+index).bind('click',myself.removeParameter);$("#parameter_button_"+index).bind('click',myself.addParamterValue);index++;});$('.'+myself.cssPrefix+'Remove').bind('click',myself.removeParameter);$('.'+myself.cssPrefix+'Parameter').bind('click',myself.addParamterValue);},submit:function(v,m,f){var array=[];for(var i=0;i<index;i++){var paramVal=myself.getParameterValues(i);if(paramVal!=null&&paramVal.length>0&&paramVal[0]!=null)array.push(paramVal);}
arrayValue=array.length>0?JSON.stringify(array):"[]";}});});_editArea.appendTo(placeholder);},validate:function(settings,original){return true;},addParameter:function(i,values,container){if(this.multiDimensionArray){if(this.hasTypedValues){var val=values[1]===undefined?"":values[1]===null?"null":values[1];var type=values.length>=3?values[2]:null;this.addTypedParameters(i,values[0],val,type,container);}
else{this.addParameters(i,values[0],(values[1]===undefined?"":values[1]===null?"null":values[1]),container);}}
else{this.addParameters(i,values,"null",container);}},addParameters:function(i,arg,val,container){if(val){val=val.replace(/["]/g,'&quot;');}
var parameterButton=this.getParameterButton(i);var removeButton=this.getRemoveButton(i);var argInput=this.getTextInput(this.argTitle,arg,this.cssPrefix+'Args','arg_'+i);var valInput=this.getTextInput(this.valTitle,val,this.cssPrefix+'Val','val_'+i);var row='<did id="parameters_'+i+'" >\n'+
argInput+
(this.multiDimensionArray?('<div class="'+this.cssPrefix+'Values">'+valInput+parameterButton+removeButton+'</div><br />'):removeButton)+'</div>\n';container.find('.'+this.cssPrefix).append(row);},addTypedParameters:function(i,arg,val,type,container){if(val){val=val.replace(/["]/g,'&quot;');}
var parameterButton=this.getParameterButton(i);var removeButton=this.getRemoveButton(i);var argInput=this.getTextInput(this.argTitle,arg,this.cssPrefix+'Args','arg_'+i);var valInput=this.getTextInput(this.valTitle,val,this.cssPrefix+'Val','val_'+i);var typeSelect=this.getTypeSelector('Type',type,'type_'+i);var row='<did id="parameters_'+i+'" >\n'+
argInput+'<div class="'+this.cssPrefix+'Values">'+valInput+'</div>'+'<div class="'+this.cssPrefix+'Types">'+typeSelect+parameterButton+removeButton+'<br /></div>\n';container.find('.'+this.cssPrefix).append(row);},getParameterValues:function(i){if(!this.multiDimensionArray){return $('#arg_'+i).val();}else{var result=[]
result.push($('#arg_'+i).val());result.push($('#val_'+i).val());if(this.hasTypedValues){result.push($('#type_'+i).val());}
return result;}},getParameterButton:function(i){return'<input id="parameter_button_'+i+'" class="'+this.cssPrefix+'Parameter" type="button" value="..."></input>\n';},getRemoveButton:function(i){return'<input id="remove_button_'+i+'" class="'+this.cssPrefix+'Remove" type="button" value="-" ></input>\n';},getTextInput:function(title,value,cssClass,id){return'<div class="'+cssClass+'">'+
(title!=null?('<span class="'+this.cssPrefix+'TextLabel">'+title+'</span>'):'')+'<input  id="'+id+'" class="'+this.cssPrefix+'Text" type="text" value="'+value+'"></input></div>\n';},getTypeSelector:function(title,type,id){var typeOptions="";for(var j=0;j<this.typesArray.length;j++){typeOptions+=(this.typesArray[j]==type)?'<option selected>':'<option>';typeOptions+=this.typesArray[j]+'</option>';}
return'<div class="'+this.cssPrefix+'Type">'+
(title!=null?('<span class="'+this.cssPrefix+'TextLabel">'+title+':</span>'):'')+'<select  id="'+id+'" class="'+this.cssPrefix+'Text">'+typeOptions+'</select></div>\n';},getAccessCheckbox:function(access,cssClass,id){var checked=(access=='private');return'<div class="'+cssClass+'"> <input id="'+id+'" type="checkbox" value="private" '+(checked?'checked="checked"':'')+' /></div>';},removeParameter:function(){$("#"+this.id.replace("remove_button_","parameters_")).remove();},addParamterValue:function(){var id=this.id;var content='<div id="parameterList" class="StringListParameterContainer">';var filters=Panel.getPanel(ComponentsPanel.MAIN_PANEL).getParameters();if(filters.length==0)
content+="<p>No Parameters!</p>";else{content+='<p>Choose Parameter:</p><ul class="StringListParameter">';$.each(filters,function(i,filter){content+='<li><div onClick="ValuesArrayRenderer.setParameterValue(\''+id+'\',\''+filter.properties[0].value+'\')">'+filter.properties[0].value+'</div></li>';});content+='</ul>';}
$.prompt(content+'</div>',{buttons:{Cancel:false},prefix:'jqiStringListParameters',focus:1});}},{setParameterValue:function(id,value){$("#"+id.replace("parameter_button_","val_")).val(value);$.prompt.close();}});var ArrayRenderer=ValuesArrayRenderer.extend({multiDimensionArray:false,cssPrefix:"StringArray",constructor:function(tableManager){this.base(tableManager);this.logger=new Logger("ArrayRenderer");this.logger.debug("Creating new ArrayRenderer");}});var IndexArrayRenderer=ArrayRenderer.extend({argTitle:'Index'});var ListArgValNoParamRenderer=ValuesArrayRenderer.extend({getParameterButton:function(i){return'';}});var SortByArrayRenderer=ListArgValNoParamRenderer.extend({argTitle:'Index',valTitle:'Order'});var OptionArrayRenderer=ListArgValNoParamRenderer.extend({argTitle:'Option'});var CdaParametersRenderer=ValuesArrayRenderer.extend({cssPrefix:"ParameterList",argTitle:'Name',valTitle:'Value',hasTypedValues:true,typesArray:['String','Integer','Numeric','Date','StringArray','IntegerArray','NumericArray','DateArray'],getParameterValues:function(i){var name=$("#arg_"+i).val();var value=$("#val_"+i).val();var type=$("#type_"+i).val();var access=$("#access_"+i).attr('checked')?'private':'';return[name,value,type,access];},addParameter:function(i,values,container){var arg=values[0];var val=values[1];var type=values[2];var access=values[3];if(val===undefined){val="";}
else if(val===null){val="null";}
else if(val){val=val.replace(/["]/g,'&quot;');}
var parameterButton=this.getParameterButton(i);var removeButton=this.getRemoveButton(i);var argInput=this.getTextInput(null,arg,this.cssPrefix+'Args','arg_'+i);var valInput=this.getTextInput(null,val,this.cssPrefix+'Val','val_'+i);var typeSelect=this.getTypeSelector(null,type,'type_'+i);var accessCb=this.getAccessCheckbox(access,this.cssPrefix+'Access','access_'+i);var row='<tr id="parameters_'+i+'" >';row+='<td>'+argInput+'</td>';row+='<td>'+valInput+'</td>';row+='<td>'+typeSelect+'</td>';row+='<td>'+accessCb+'</td>';row+='<td>'+removeButton+'</td>';row+='</tr>';if(i==0){container.find('.'+this.cssPrefix).append('<table> </table>');var hdr='<tr>';hdr+='<th><span class="'+this.cssPrefix+'TextLabel">'+this.argTitle+'</span></th>'
hdr+='<th><span class="'+this.cssPrefix+'TextLabel">'+this.valTitle+'</span></th>'
hdr+='<th><span class="'+this.cssPrefix+'TextLabel">Type</span></th>'
hdr+='<th><span class="'+this.cssPrefix+'TextLabel">Private?</span></th>'
hdr+='<th><span class="'+this.cssPrefix+'TextLabel"></span></th>'
hdr+='</tr>';row=hdr+row;}
container.find('.'+this.cssPrefix+' table').append(row);}});var CdaColumnsArrayRenderer=ValuesArrayRenderer.extend({argTitle:'Index',valTitle:'Name'});var CdaCalculatedColumnsArrayRenderer=ValuesArrayRenderer.extend({argTitle:'Name',valTitle:'Form.'});var ComponentsJavascriptParameterModel=BaseModel.extend({},{MODEL:'ComponentsJavascriptParameter',getStub:function(){var _stub={id:TableManager.generateGUID(),type:ComponentsJavascriptParameterModel.MODEL,typeDesc:"Custom Parameter",parent:IndexManager.ROOTID,properties:[]};_stub.properties.push(PropertiesManager.getProperty("name"));_stub.properties.push(PropertiesManager.getProperty("javaScript"));_stub.properties.push(PropertiesManager.getProperty("bookmarkable"));return _stub;}});BaseModel.registerModel(ComponentsJavascriptParameterModel);CDFDDComponentsArray.push(new JavascriptParameterEntry());var DateParameterEntry=PalleteEntry.extend({id:"DATE_PARAMETER_ENTRY",name:"Date parameter",description:"Date parameter",category:"GENERIC",categoryDesc:"Generic",getStub:function(){return ComponentsDateParameterModel.getStub();}});var ComponentsDateParameterModel=BaseModel.extend({},{MODEL:'ComponentsDateParameter',getStub:function(){var _stub={id:TableManager.generateGUID(),type:ComponentsDateParameterModel.MODEL,typeDesc:"DateParameter",parent:IndexManager.ROOTID,properties:[]};_stub.properties.push(PropertiesManager.getProperty("name"));_stub.properties.push(PropertiesManager.getProperty("propertyDateValue"));_stub.properties.push(PropertiesManager.getProperty("bookmarkable"));return _stub;}});BaseModel.registerModel(ComponentsDateParameterModel);CDFDDComponentsArray.push(new DateParameterEntry());var FunctionEntry=PalleteEntry.extend({id:"FUNCTION_ENTRY",name:"JavaScript Function",description:"JavaScript function",category:"SCRIPT",categoryDesc:"Scripts",getStub:function(){return ComponentsFunctionModel.getStub();}});var ComponentsFunctionModel=BaseModel.extend({},{MODEL:'ComponentsFunction',getStub:function(){var _stub={id:TableManager.generateGUID(),type:ComponentsFunctionModel.MODEL,typeDesc:"Function",parent:IndexManager.ROOTID,properties:[]};_stub.properties.push(PropertiesManager.getProperty("name"));_stub.properties.push(PropertiesManager.getProperty("javaScript"));return _stub;}});BaseModel.registerModel(ComponentsFunctionModel);CDFDDComponentsArray.push(new FunctionEntry());var CdaQueryRenderer=PromptRenderer.extend({constructor:function(tableManager){this.base(tableManager);this.logger=new Logger("CdaQueryRenderer");this.logger.debug("Creating new CdaQueryRenderer");this.wizard="CDA_WIZARD";}});var MondrianCatalogRenderer=SelectRenderer.extend({logger:null,selectData:{'':''},catalogs:[],getDataInit:function(){var myself=this;$.getJSON(CDFDDServerUrl+"OlapUtils",{operation:"GetOlapCubes"},function(json){if(json.status=="true"){var catalogs=json.result.catalogs;myself.catalogs=catalogs;$.each(catalogs,function(i,catalog){myself.selectData[catalog.schema.replace("solution:","")]=catalog.name;});}});},postChange:function(value){var jndi,cube,seen=false;$.each(this.catalogs,function(i,c){if(c.schema=="solution:"+value){seen=true;cube=c.cubes[0].name;jndi=c.jndi;return false;}});if(seen){Dashboards.log("Found: "+jndi);var jndiRow=this.getTableManager().getTableModel().getRowByName("jndi");if(jndiRow!=undefined){jndiRow.value=jndi;this.getTableManager().renderColumnByRow(jndiRow);}
var queryRow=this.getTableManager().getTableModel().getRowByName("query");if(queryRow!=undefined&&queryRow.value==""){queryRow.value="select {} on ROWS, {} on COLUMNS from ["+cube+"]";this.getTableManager().renderColumnByRow(queryRow);}}}});var JndiRenderer=SelectRenderer.extend({logger:null,selectData:[''],catalogs:[],getDataInit:function(){var myself=this;$.getJSON(CDFDDServerUrl+"OlapUtils",{operation:"GetOlapCubes"},function(json){if(json.status=="true"){var catalogs=json.result.catalogs;var hash={};$.each(catalogs,function(i,catalog){hash[catalog.jndi]=1;});for(jndi in hash){myself.selectData.push(jndi);}}});}});var ArraySelectRenderer=ValuesArrayRenderer.extend({cssPrefix:"GenericSelect",getParameterValues:function(i){var value=$("#val_"+i).val();return value;},addParameter:function(i,val,container){var table;if(i==0){table=$('<table> </table>').appendTo(container.find('.'+this.cssPrefix));var hdr='<tr>';hdr+='<th><span class="'+this.cssPrefix+'TextLabel">'+this.argTitle+'</span></th>'
hdr+='<th><span class="'+this.cssPrefix+'TextLabel">'+this.valTitle+'</span></th>'
hdr+='<th><span class="'+this.cssPrefix+'TextLabel"></span></th>'
hdr+='</tr>';$(hdr).appendTo(table);}else{table=container.find('.'+this.cssPrefix+' table')}
if(val===undefined){val="";}
else if(val===null){val="null";}
else if(val instanceof Array){val=val[0];}
val.replace(/["]/g,'&quot;');var valInput="<input id='val_"+i+"' type='text' value='"+val+"' />";var removeButton=this.getRemoveButton(i);var row='<tr id="parameters_'+i+'" >';row+='<td>'+this.argType+" "+i+"</td>";row+='<td>'+valInput+'</td>';row+='<td>'+removeButton+'</td>';row+='</tr>';table.append(row);var myself=this;setTimeout(function(){$("#val_"+i).autocomplete({source:function(req,add){myself.autoCompleteRequest(req,add);},minLength:0,delay:myself.getDelay(),select:function(evt,ui){$("#val_"+i).find("input").val(ui.item.value);},focus:function(evt,data){if(data!=undefined)$('#val_'+i).val(data.item.value);},onsubmit:function(settings,original){return myself.validate($('input',this).val());},height:12});},10);},autoCompleteRequest:function(req,add){var results=this.selectData.map(function(e){return{label:e[1],value:e[0]};})
add(jQuery.grep(results,function(elt,i){return elt.value.indexOf(req.term)>=0;}));},validate:function(settings,original){return true;},getData:function(){return this.selectData;},getDelay:function(){return 300;}});var ParameterRenderer=SelectRenderer.extend({getData:function(){return Panel.getPanel(ComponentsPanel.MAIN_PANEL).getParameters().map(function(o){return o.properties[0].value;});}});var ListenersRenderer=SelectMultiRenderer.extend({getData:function(){var data=Panel.getPanel(ComponentsPanel.MAIN_PANEL).getParameters();var _str="{";$.each(data,function(i,val){_str+="'"+val.properties[0].value+"': '"+val.properties[0].value+"',";});_str+=" 'selected':"+(this.value)+"}";return _str;},getFormattedValue:function(value){var v=value.replace(/','/g,"', '");if(v.length>20)v=v.substring(0,20)+" (...)";return v;}});var ArrayParameterRenderer=ListenersRenderer.extend({});var DataSourceProperty=BasePropertyType.extend({type:"dataSource",stub:{name:"dataSource",description:"Datasource",tooltip:"DataSource to be used in this selector",type:"Datasource",value:"",order:43}});PropertiesManager.register(new DataSourceProperty());var JFreeChartDataSourceProperty=DataSourceProperty.extend({type:"jFreeChartDataSource",stub:{name:"jFreeChartDataSource",description:"Datasource",tooltip:"DataSource to be used in this selector",type:"Datasource",value:"",order:43}});PropertiesManager.register(new JFreeChartDataSourceProperty());var DatasourceRenderer=SelectRenderer.extend({getData:function(){return Panel.getPanel(DatasourcesPanel.MAIN_PANEL).getDatasources().map(function(o){return o.properties[0].value;});}});var HtmlObjectRenderer=SelectRenderer.extend({getData:function(){return Panel.getPanel(LayoutPanel.MAIN_PANEL).getHtmlObjects().map(function(o){return o.properties[0].value;});}});var MatchTypeRenderer=SelectRenderer.extend({isAutoComplete:false,selectData:{'fromStart':'From Start','all':'All'}});var ChartTypeRenderer=SelectRenderer.extend({selectData:{'BarChart':'Bar Chart','PieChart':'Pie Chart','LineChart':'Line Chart','AreaChart':'Area Chart'}});var DomainPeriodTypeRenderer=SelectRenderer.extend({selectData:{'Year':'Year','Quarter':'Quarter','Month':'Month','Week':'Week','Day':'Day','Hour':'Hour','Minute':'Minute','Second':'Second','Millisecond':'Millisecond'}});var OrientationRenderer=SelectRenderer.extend({selectData:{'vertical':'Vertical','horizontal':'Horizontal'}});var DomainLabelRotationRenderer=SelectRenderer.extend({selectData:{'up':'Clockwise','down':'CounterClockWise'}});var DatasetTypeRenderer=SelectRenderer.extend({selectData:{'CategoryDataset':'Category Dataset','TimeSeriesCollection':'TimeSeries Collection'}});var TopCountAxisRenderer=SelectRenderer.extend({selectData:{'rows':'Rows','columns ':'Columns '}});var UrlTemplateRenderer=CellRenderer.extend({constructor:function(){this.base();this.logger=new Logger("StringRenderer");this.logger.debug("Creating new StringRenderer");},render:function(placeholder,value,callback){var _editArea=$('<td><div style="float:left"><code></code></div><div class="edit" style="float:right"></div></td>');this.editArea=_editArea;_editArea.find("code").text(value);var myself=this;var selectedFile="";var data=Panel.getPanel(ComponentsPanel.MAIN_PANEL).getParameters();var strData="{";var chooseParameterSelector='<select id="fireChange_parameters_container">';$.each(data,function(i,val){var parameter=val.properties[0].value;strData+="'"+parameter+"': '"+parameter+"',";chooseParameterSelector+='<option value="'+parameter+'">'+parameter+'</option>';});strData+=" 'selected':"+"''"+"}";chooseParameterSelector+='</select>';var _prompt=$('<button class="cdfddInput">...</button>').bind("click",function(){var urlTemplateWizard={chooseClickBehaviour:{html:'Choose Click Behaviour:&nbsp;&nbsp;<select id="clickBehaviour">\n'+'     <option value="linkToAnotherDashboard">Link to Another Dashboard</option>\n'+'     <option value="fireChange">Fire Change</option>\n'+'     <option value="jumpToUrl">Jump to Url</option></select>',buttons:{Cancel:0,Next:1,Skip:2},focus:1,submit:function(v,m,f){if(v==0)return true;if(v==2)$.prompt.goToState('skip');else{var clickBehaviour=$("#clickBehaviour").val();$.prompt.goToState(clickBehaviour);if(clickBehaviour=="linkToAnotherDashboard"){selectedFile="";$('#container_id').fileTree({root:'/',script:CDFDDDataUrl.replace("Syncronize","ExploreFolder?fileExtensions=.wcdf&access=execute"),expandSpeed:1000,collapseSpeed:1000,multiFolder:false,folderClick:function(obj,folder){if($(".selectedFolder").length>0)$(".selectedFolder").attr("class","");$(obj).attr("class","selectedFolder");}},function(file){selectedFile=file;$(".selectedFile").attr("class","");$("a[rel='"+file+"']").attr("class","selectedFile");});}}
return false;}},linkToAnotherDashboard:{html:'Link to Another Dashaboard<hr/>\n'+'      Choose Dashboard:\n'+'      <div id="container_id" class="urltargetfolderexplorer">&nbsp;</div>\n'+'      <span class="linkToAnotherDashboardlabel">Store parameters at var:&nbsp;</span><input class="linkToAnotherDashboardinput1" type="text" id="parameterName" value=""/><br/>\n'+'      <span class="linkToAnotherDashboardlabel">Store series at var:&nbsp;</span><input class="linkToAnotherDashboardinput2" type="text" id="seriesName" value="" />',buttons:{Back:-1,Ok:1,Cancel:0},focus:1,submit:function(v,m,f){if(v==0)return true;if(v==1&&selectedFile.length==0)
$.prompt("Please select a dashboard file!");else if(v==-1)
$.prompt.goToState('chooseClickBehaviour');else{if(v==1){myself.callback(callback,'linkToAnotherDashboard',selectedFile,$("#parameterName").val(),$("#seriesName").val());}
$.prompt.close();}
return false;}},fireChange:{html:'Fire Change<hr/>Choose Parameter:&nbsp;&nbsp;'+chooseParameterSelector,buttons:{Back:-1,Ok:1,Cancel:0},focus:1,submit:function(v,m,f){if(v==0)return true;if(v==-1)
$.prompt.goToState('chooseClickBehaviour');else if(v==1){myself.callback(callback,'fireChange',$("#fireChange_parameters_container").val());$.prompt.close();}
return false;}},jumpToUrl:{html:'Jump to Url:<hr/>\n'+'     <span>Url:&nbsp;&nbsp;</span><input class="utlTemplateTargetInput" type="text" id="urlTarget" value="'+value+'"/>',buttons:{Back:-1,Ok:1,Cancel:0},focus:1,submit:function(v,m,f){if(v==0)return true;if(v==-1)
$.prompt.goToState('chooseClickBehaviour');else if(v==1){myself.callback(callback,'jumpToUrl',$("#urlTarget").val());$.prompt.close();}
return false;}},skip:{html:'Url Template:<hr/>\n'+'     <textarea class="urlTemplateInput" type="text" id="urlTemplate" >'+value+'</textarea>',buttons:{Back:-1,Ok:1,Cancel:0},focus:1,submit:function(v,m,f){if(v==0)return true;if(v==-1)
$.prompt.goToState('chooseClickBehaviour');else if(v==1){myself.callback(callback,'jumpToUrl',$("#urlTarget").val());$.prompt.close();myself.callback(callback,'skip',$("#urlTemplate").val());}
return false;}}};$.prompt(urlTemplateWizard);}).appendTo($("div.edit",_editArea));_editArea.appendTo(placeholder);},callback:function(callback,clickBehaviour,param1,param2,param3){var value="";if(clickBehaviour=="linkToAnotherDashboard"){var solutionPath=param1.split("/");var solution=solutionPath[1];var file=solutionPath[solutionPath.length-1];var path="/";if(solutionPath.length>3)
path+=solutionPath.slice(2,solutionPath.length-1).join("/")
value=CDFDDServerUrl+"Render?solution="+solution+"&path="+path+"&file="+file;if(param2.length>0){value+="&param"+param2+"={PARAM}";}
if(param3.length>0){value+="&param"+param3+"={SERIE}";}}
else if(clickBehaviour=="fireChange"){value="javascript:Dashboards.fireChange('"+param1+"','{PARAM}')";}
else{value=param1;}
this.value=value;this.editArea.find("code").text(value);callback(value);},validate:function(settings,original){return true;}});var ResultRenderer=ParameterRenderer.extend({});var PaginationTypeRenderer=SelectRenderer.extend({selectData:{'two_button':'Two buttons','full_numbers':'Full numbers'}});var AccessRenderer=SelectRenderer.extend({selectData:{'public':'Public','private':'Private'}});var GravityRenderer=SelectRenderer.extend({selectData:{'N':'Top','S':'Bottom','W':'Left','E':'Right'}});var OutputModeRenderer=SelectRenderer.extend({selectData:{'include':'Include','exclude':'Exclude'}});var BandedModeRenderer=SelectRenderer.extend({selectData:{'compact':'Compact','classic':'Classic'}});var TableStyleRenderer=SelectRenderer.extend({selectData:{'themeroller':'New','classic':'Classic'}});var MenuModeRenderer=SelectRenderer.extend({selectData:{'horizontal':'Horizontal','vertical':'Vertical'}});var AnchorRenderer=SelectRenderer.extend({selectData:{'top':'Top','bottom':'Bottom','left':'Left','right':'Right'}});var AnchorCenterRenderer=SelectRenderer.extend({selectData:{'center':'Center','top':'Top','bottom':'Bottom','left':'Left','right':'Right'}});var SquareAlignRenderer=SelectRenderer.extend({selectData:{'left':'Left','center':'Center','right':'Right','top':'Top','middle':'Middle','bottom':'Bottom'}});var LeftRightRenderer=SelectRenderer.extend({selectData:{'left':'Left','right':'Right'}});var TopBottomRenderer=SelectRenderer.extend({selectData:{'top':'Top','bottom':'Bottom'}});var Util={logger:new Logger("CDE.Util")};Util.clone=function clone(obj){var c=obj instanceof Array?[]:{};for(var i in obj)if(obj.hasOwnProperty(i)){var prop=obj[i];if(typeof prop=='object'){if(prop instanceof Array){c[i]=[];for(var j=0;j<prop.length;j++){if(typeof prop[j]!='object'){c[i].push(prop[j]);}else{c[i].push(Util.clone(prop[j]));}}}else{c[i]=Util.clone(prop);}}else{c[i]=prop;}}
return c;}
Util.parseJsonResult=function(jsonStr){var json={status:false,result:'Could not parse result.'}
if(jsonStr){try{json=eval("("+jsonStr+")");}
catch(e){this.logger.error('Could not parse json result '+jsonStr+', '+e);}}
return json;}